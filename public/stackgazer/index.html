<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stackgazer</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E🔍%3C/text%3E%3C/svg%3E">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
    </style>
  <script type="module">function Mt(c){const t=c.indexOf("/");return t===-1?!c.startsWith("main"):!c.substring(0,t).includes(".")}function Tt(c,t){if(c.startsWith(t))return!0;if(t.includes("(")||t.includes("[")||t.includes("*")||t.includes("+")||t.includes("?")||t.includes("\\"))try{return new RegExp(t).test(c)}catch{return!1}return!1}function Vt(c,t){if(c.length===0)return"empty";let e="",n=0;for(;n<c.length;){const o=c[n].func;let s=!1;for(const d of t)if("skip"in d&&o.startsWith(d.skip)){n++,s=!0;break}if(s)continue;let a=!1;for(const d of t)if("fold"in d&&Tt(o,d.fold)){if(e.startsWith(d.to)||(e=d.to+(e?" → "+e:"")),n++,d.while)for(;n<c.length;){const m=c[n];let p=!1;for(const f of t)if("skip"in f&&m.func.startsWith(f.skip)){p=!0;break}if(p){n++;continue}let g=!1;if(d.while==="stdlib"&&Mt(m.func))g=!0;else if(d.while!=="stdlib")try{g=new RegExp(d.while).test(m.func)}catch{g=m.func.startsWith(d.while)}if(g)n++;else break}a=!0;break}if(a)continue;let l=o;for(const d of t)if("trim"in d)if(d.trim.startsWith("s/")){const m=d.trim.match(/^s\/(.+)\/(.*)\/$/);if(m)try{const[,p,g]=m,f=new RegExp(p);l=l.replace(f,g)}catch{}}else if(d.trim.startsWith("s|")){const m=d.trim.match(/^s\|(.*)\|([^|]*)\|([gimuy]*)$/);if(m)try{const[,p,g,f]=m,w=new RegExp(p,f||"");l=l.replace(w,g)}catch{}}else l.startsWith(d.trim)&&(l=l.slice(d.trim.length));e.startsWith(l)||(e=l+(e?" → "+e:""));let r=null,u=-1;for(let d=n+1;d<c.length;d++){const m=c[d];for(const p of t)"find"in p&&Tt(m.func,p.find)&&d>u&&(r=p,u=d)}if(r){if(e.startsWith(r.to)||(e=r.to+(e?" → "+e:"")),n=u+1,r.while)for(;n<c.length;){const d=c[n];let m=!1;for(const g of t)if("skip"in g&&d.func.startsWith(g.skip)){m=!0;break}if(m){n++;continue}let p=!1;if(r.while==="stdlib"&&Mt(d.func))p=!0;else if(r.while!=="stdlib")try{p=new RegExp(r.while).test(d.func)}catch{p=d.func.startsWith(r.while)}if(p)n++;else break}continue}return e||(c.length>0?c[c.length-1].func:"")}return e||(c.length>0?c[c.length-1].func:"")}function Ht(c,t){const e=t.indexOf(" --"),n=e!==-1?t.substring(0,e).trim():t,i=n.lastIndexOf("#");let o,s;if(i!==-1){o=n.substring(0,i);const a=n.substring(i+1);s=parseInt(a,10),isNaN(s)&&(s=0)}else o=n,s=1;try{const a=new RegExp(o),l=c.match(a);if(l)return l[s]||l[0]||""}catch(a){console.warn("Invalid match rule pattern:",o,a)}return null}function It(c){const t=c.indexOf("/");return t===-1?c:c.substring(0,t)}function Zt(c,t){if(c.length===0)return"<frameless stack>";for(let n=c.length-1;n>=0;n--){const o=c[n].func;if(!t.some(a=>"skip"in a&&o.startsWith(a.skip))){for(const a of t)if("match"in a){const l=Ht(o,a.match);if(l)return l}return It(o)}}const e=c[0];return It(e.func)}function Yt(c){const t=[];for(const e of c)t.push(e.func),t.push("".concat(e.file,":").concat(e.line));return t.join(" ").toLowerCase()}class Xt{constructor(t){this.categories=[],this.stackForTraceId=new Map,this.parsedFiles=new Map,this.currentFilter="",this.nextGroupId=1,this.nextFileId=1,this.nextCategoryId=1,this.goroutinesByID=new Map,this.goroutineToCategory=new Map,this.settings=t}generateStackName(t){return Vt(t,this.settings.titleManipulationRules)}generateCategoryName(t){return Zt(t,this.settings.categoryRules)}processFrame(t){const e={...t};for(const n of this.settings.functionPrefixesToTrim){const i=e.func.match(n);i&&(e.func=e.func.substring(i[0].length))}for(const n of this.settings.filePrefixesToTrim){const i=e.file.match(n);i&&(e.file=e.file.substring(i[0].length))}return e}processFrames(t){return t.map(e=>this.processFrame(e))}importParsedFile(t,e,n){const i="f".concat(this.nextFileId++);for(const o of t.groups){const s="s".concat(o.traceId);let{category:a,stack:l}=this.stackForTraceId.get(o.traceId)||{};if(!l){const d=this.processFrames(o.trace);l={id:s,name:this.generateStackName(d),trace:d,searchableText:Yt(d),pinned:!1,counts:{total:0,matches:0,visibilityChanged:!1,filterMatches:0,pinned:0,minWait:1/0,maxWait:-1/0,minMatchingWait:1/0,maxMatchingWait:-1/0,states:new Map,matchingStates:new Map},files:[]}}if(!a){const d=this.generateCategoryName(l.trace);a=this.categories.find(m=>m.name===d),a||(a={id:"cat".concat(this.nextCategoryId++),name:d,stacks:[],pinned:!1,counts:{total:0,matches:0,visibilityChanged:!1,filterMatches:0,pinned:0,minWait:1/0,maxWait:-1/0,minMatchingWait:1/0,maxMatchingWait:-1/0,states:new Map,matchingStates:new Map}},this.categories.push(a)),a.stacks.push(l),this.stackForTraceId.set(o.traceId,{category:a,stack:l})}const r={id:"g".concat(this.nextGroupId++),labels:o.labels,pinned:!1,counts:{total:o.count,matches:o.count,visibilityChanged:!1,filterMatches:o.count,pinned:0,minWait:1/0,maxWait:-1/0,minMatchingWait:1/0,maxMatchingWait:-1/0,states:new Map,matchingStates:new Map},goroutines:o.goroutines.map(d=>{const m=o.labels.find(g=>g.startsWith("state=")),p=m?m.split("=")[1]:o.labels[0]||"unknown";return{...d,matches:!0,pinned:!1,stack:l,state:p}})};if(r.goroutines.length===0&&r.counts.total>0){const d=this.extractStateFromGroupLabels(r);r.counts.states.set(d,r.counts.total),r.counts.matchingStates.set(d,r.counts.total)}for(const d of r.goroutines)n&&(d.id="".concat(e,".").concat(d.id),d.creator!==""&&(d.creator="".concat(e,".").concat(d.creator)),d.created=d.created.map(m=>"".concat(e,".").concat(m))),this.goroutinesByID.set(d.id,d),this.goroutineToCategory.set(d.id,a);for(const d of r.goroutines){d.waitMinutes<r.counts.minWait&&(r.counts.minWait=d.waitMinutes),d.waitMinutes>r.counts.maxWait&&(r.counts.maxWait=d.waitMinutes),d.waitMinutes<r.counts.minMatchingWait&&(r.counts.minMatchingWait=d.waitMinutes),d.waitMinutes>r.counts.maxMatchingWait&&(r.counts.maxMatchingWait=d.waitMinutes);const m=r.counts.states.get(d.state)||0;r.counts.states.set(d.state,m+1);const p=r.counts.matchingStates.get(d.state)||0;r.counts.matchingStates.set(d.state,p+1)}let u=l.files.find(d=>d.fileId===i);if(!u)u={id:"s".concat(l.id,"-").concat(i),fileId:i,fileName:e,groups:[r],pinned:!1,counts:{total:r.counts.total,matches:r.counts.matches,visibilityChanged:!1,filterMatches:r.counts.filterMatches,pinned:0,minWait:r.counts.minWait,maxWait:r.counts.maxWait,minMatchingWait:r.counts.minMatchingWait,maxMatchingWait:r.counts.maxMatchingWait,states:new Map(r.counts.states),matchingStates:new Map(r.counts.matchingStates)}},l.files.push(u);else{u.groups.push(r),u.counts.total+=r.counts.total,u.counts.matches+=r.counts.matches,u.counts.filterMatches+=r.counts.filterMatches,r.counts.minWait<u.counts.minWait&&(u.counts.minWait=r.counts.minWait),r.counts.maxWait>u.counts.maxWait&&(u.counts.maxWait=r.counts.maxWait),r.counts.minMatchingWait<u.counts.minMatchingWait&&(u.counts.minMatchingWait=r.counts.minMatchingWait),r.counts.maxMatchingWait>u.counts.maxMatchingWait&&(u.counts.maxMatchingWait=r.counts.maxMatchingWait);for(const[d,m]of r.counts.states){const p=u.counts.states.get(d)||0;u.counts.states.set(d,p+m)}for(const[d,m]of r.counts.matchingStates){const p=u.counts.matchingStates.get(d)||0;u.counts.matchingStates.set(d,p+m)}}l.counts.total+=r.counts.total,l.counts.matches+=r.counts.matches,l.counts.filterMatches+=r.counts.filterMatches,r.counts.minWait<l.counts.minWait&&(l.counts.minWait=r.counts.minWait),r.counts.maxWait>l.counts.maxWait&&(l.counts.maxWait=r.counts.maxWait),r.counts.minMatchingWait<l.counts.minMatchingWait&&(l.counts.minMatchingWait=r.counts.minMatchingWait),r.counts.maxMatchingWait>l.counts.maxMatchingWait&&(l.counts.maxMatchingWait=r.counts.maxMatchingWait);for(const[d,m]of r.counts.states){const p=l.counts.states.get(d)||0;l.counts.states.set(d,p+m)}for(const[d,m]of r.counts.matchingStates){const p=l.counts.matchingStates.get(d)||0;l.counts.matchingStates.set(d,p+m)}a.counts.total+=r.counts.total,a.counts.matches+=r.counts.matches,a.counts.filterMatches+=r.counts.filterMatches,r.counts.minWait<a.counts.minWait&&(a.counts.minWait=r.counts.minWait),r.counts.maxWait>a.counts.maxWait&&(a.counts.maxWait=r.counts.maxWait),r.counts.minMatchingWait<a.counts.minMatchingWait&&(a.counts.minMatchingWait=r.counts.minMatchingWait),r.counts.maxMatchingWait>a.counts.maxMatchingWait&&(a.counts.maxMatchingWait=r.counts.maxMatchingWait);for(const[d,m]of r.counts.states){const p=a.counts.states.get(d)||0;a.counts.states.set(d,p+m)}for(const[d,m]of r.counts.matchingStates){const p=a.counts.matchingStates.get(d)||0;a.counts.matchingStates.set(d,p+m)}}this.categories.sort((o,s)=>o.name.localeCompare(s.name));for(const o of this.categories){o.stacks.sort((s,a)=>s.name.localeCompare(a.name));for(const s of o.stacks)s.files.sort((a,l)=>a.fileName.localeCompare(l.fileName))}}getCategories(){return this.categories}getGoroutineByID(t){return this.goroutinesByID.get(t)}getFileNames(){return Array.from(this.parsedFiles.keys()).sort()}lookupGoroutine(t){const e=this.goroutinesByID.get(t);return e?{...e}:void 0}addFile(t,e){if(this.parsedFiles.size==1){const i=this.parsedFiles.keys().next().value;this.renameFile(i,i,!0)}const n=e||t.extractedName||t.originalName;this.parsedFiles.set(n,t),this.importParsedFile(t,n,this.parsedFiles.size>1)}removeFile(t){if(!this.parsedFiles.has(t))return!1;if(this.parsedFiles.delete(t),this.categories=this.categories.filter(e=>(e.stacks=e.stacks.filter(n=>(n.files=n.files.filter(i=>i.fileName===t?(i.groups.forEach(o=>{o.goroutines.forEach(s=>{this.goroutinesByID.delete(s.id),this.goroutineToCategory.delete(s.id)})}),!1):!0),n.files.length===0?!1:(n.counts.matches=n.files.reduce((i,o)=>i+o.counts.matches,0),n.counts.total=n.files.reduce((i,o)=>i+o.counts.total,0),n.counts.filterMatches=n.files.reduce((i,o)=>i+o.counts.filterMatches,0),!0))),e.stacks.length===0?!1:(e.counts.matches=e.stacks.reduce((n,i)=>n+i.counts.matches,0),e.counts.total=e.stacks.reduce((n,i)=>n+i.counts.total,0),e.counts.filterMatches=e.stacks.reduce((n,i)=>n+i.counts.filterMatches,0),!0))),this.rebuildStackForTraceIdMap(),this.parsedFiles.size===1){const e=this.getFileNames()[0];this.renameFile(e,e,!1)}return!0}rebuildStackForTraceIdMap(){this.stackForTraceId.clear();for(const t of this.categories)for(const e of t.stacks){const n=e.id.substring(1);this.stackForTraceId.set(n,{category:t,stack:e})}}renameFile(t,e,n){const i=this.parsedFiles.get(t);i&&(this.removeFile(t),this.parsedFiles.set(e,i),this.importParsedFile(i,e,n))}updateTitleRules(t){this.settings.titleManipulationRules=t,this.updateSettings(this.settings)}updateSettings(t){this.settings=t;const e=[];for(const[n,i]of this.parsedFiles)e.push({name:n,data:i});this.categories=[],this.parsedFiles.clear(),this.goroutinesByID.clear(),this.goroutineToCategory.clear(),this.stackForTraceId.clear(),this.nextGroupId=1,this.nextFileId=1,this.nextCategoryId=1;for(const n of e)this.addFile(n.data,n.name)}setFilter(t){this.currentFilter=t.filterString.trim().toLowerCase();const e=this.currentFilter===""?null:this.currentFilter;for(const n of this.categories){n.counts.minMatchingWait=1/0,n.counts.maxMatchingWait=-1/0,n.counts.matchingStates.clear();for(const i of n.stacks){if(i.counts.minMatchingWait=1/0,i.counts.maxMatchingWait=-1/0,i.counts.matchingStates.clear(),e==null||i.searchableText.includes(e)){if(t.minWait===void 0&&t.maxWait===void 0&&t.states===void 0){i.counts.matches=i.counts.total,i.counts.filterMatches=i.counts.total,i.counts.minMatchingWait=i.counts.minWait,i.counts.maxMatchingWait=i.counts.maxWait,i.counts.matchingStates=new Map(i.counts.states);for(const s of i.files){s.counts.matches=s.counts.total,s.counts.filterMatches=s.counts.total,s.counts.minMatchingWait=s.counts.minWait,s.counts.maxMatchingWait=s.counts.maxWait,s.counts.matchingStates=new Map(s.counts.states);for(const a of s.groups){a.counts.matches=a.counts.total,a.counts.filterMatches=a.counts.total,a.counts.minMatchingWait=a.counts.minWait,a.counts.maxMatchingWait=a.counts.maxWait,a.counts.matchingStates=new Map(a.counts.states);for(const l of a.goroutines)this.setGoroutineVisibility(l,!0,a,s,i,n)}}}else{i.counts.matches=0,i.counts.filterMatches=0,i.counts.minMatchingWait=1/0,i.counts.maxMatchingWait=-1/0,i.counts.matchingStates.clear();for(const s of i.files){s.counts.matches=0,s.counts.filterMatches=0,s.counts.minMatchingWait=1/0,s.counts.maxMatchingWait=-1/0,s.counts.matchingStates.clear();for(const a of s.groups){this.setGroupVisibility(a,0,s,i,n),a.counts.filterMatches=0,a.counts.minMatchingWait=1/0,a.counts.maxMatchingWait=-1/0,a.counts.matchingStates.clear();for(const l of a.goroutines){let r=(t.minWait===void 0||l.waitMinutes>=t.minWait)&&(t.maxWait===void 0||l.waitMinutes<=t.maxWait),u=t.states===void 0||t.states.has(l.state);this.setGoroutineVisibility(l,r&&u,a,s,i,n),l.matches&&(a.counts.matches++,a.counts.filterMatches++,[a.counts,s.counts,i.counts].forEach(d=>{l.waitMinutes<d.minMatchingWait&&(d.minMatchingWait=l.waitMinutes),l.waitMinutes>d.maxMatchingWait&&(d.maxMatchingWait=l.waitMinutes);const m=d.matchingStates.get(l.state)||0;d.matchingStates.set(l.state,m+1)}))}a.counts.matches===0&&(a.counts.minMatchingWait=1/0,a.counts.maxMatchingWait=-1/0)}s.counts.matches=s.groups.reduce((a,l)=>a+l.counts.matches,0),s.counts.filterMatches=s.groups.reduce((a,l)=>a+l.counts.filterMatches,0),s.counts.matches===0&&(s.counts.minMatchingWait=1/0,s.counts.maxMatchingWait=-1/0)}i.counts.matches=i.files.reduce((s,a)=>s+a.counts.matches,0),i.counts.filterMatches=i.files.reduce((s,a)=>s+a.counts.filterMatches,0),i.counts.matches===0&&(i.counts.minMatchingWait=1/0,i.counts.maxMatchingWait=-1/0)}if(i.pinned){i.counts.pinned=i.counts.total;for(const s of i.files){s.counts.pinned=s.counts.total;for(const a of s.groups)a.counts.pinned=a.counts.total}}else{i.counts.pinned=0;for(const s of i.files){if(s.pinned){s.counts.pinned=s.counts.total;for(const a of s.groups)a.counts.pinned=a.counts.total}else{s.counts.pinned=0;for(const a of s.groups)a.pinned?a.counts.pinned=a.counts.total:a.counts.pinned=a.goroutines.filter(l=>l.pinned).length,s.counts.pinned+=a.counts.pinned}i.counts.pinned+=s.counts.pinned}}}else{i.counts.matches=0,i.counts.filterMatches=0;for(const s of i.files){s.counts.matches=0,s.counts.filterMatches=0,s.counts.minMatchingWait=1/0,s.counts.maxMatchingWait=-1/0,s.counts.matchingStates.clear();for(const a of s.groups){if(a.labels.some(r=>r.toLowerCase().includes(e)))if(t.minWait===void 0&&t.maxWait===void 0&&t.states===void 0){a.counts.matches=a.counts.total,a.counts.filterMatches=a.counts.total,a.counts.minMatchingWait=a.counts.minWait,a.counts.maxMatchingWait=a.counts.maxWait,a.counts.matchingStates=new Map(a.counts.states);for(const r of a.goroutines)this.setGoroutineVisibility(r,!0,a,s,i,n)}else{this.setGroupVisibility(a,0,s,i,n),a.counts.filterMatches=0,a.counts.minMatchingWait=1/0,a.counts.maxMatchingWait=-1/0,a.counts.matchingStates.clear();for(const r of a.goroutines){let u=(t.minWait===void 0||r.waitMinutes>=t.minWait)&&(t.maxWait===void 0||r.waitMinutes<=t.maxWait),d=t.states===void 0||t.states.has(r.state);if(this.setGoroutineVisibility(r,u&&d,a,s,i,n),r.matches){a.counts.matches++,a.counts.filterMatches++,r.waitMinutes<a.counts.minMatchingWait&&(a.counts.minMatchingWait=r.waitMinutes),r.waitMinutes>a.counts.maxMatchingWait&&(a.counts.maxMatchingWait=r.waitMinutes);const m=a.counts.matchingStates.get(r.state)||0;a.counts.matchingStates.set(r.state,m+1)}}a.counts.matches===0&&(a.counts.minMatchingWait=1/0,a.counts.maxMatchingWait=-1/0)}else{const r=a.pinned||s.pinned||i.pinned||n.pinned;this.setGroupVisibility(a,0,s,i,n),a.counts.filterMatches=0,a.counts.minMatchingWait=1/0,a.counts.maxMatchingWait=-1/0,a.counts.matchingStates.clear();for(const u of a.goroutines){let d=e==null||u.id.includes(e),m=(t.minWait===void 0||u.waitMinutes>=t.minWait)&&(t.maxWait===void 0||u.waitMinutes<=t.maxWait),p=t.states===void 0||t.states.has(u.state);if(this.setGoroutineVisibility(u,d&&m&&p,a,s,i,n),u.matches?(a.counts.filterMatches++,a.counts.matches++):(r||u.pinned||t.forcedGoroutine&&u.id===t.forcedGoroutine)&&(this.setGoroutineVisibility(u,!0,a,s,i,n),a.counts.matches++),u.matches){u.waitMinutes<a.counts.minMatchingWait&&(a.counts.minMatchingWait=u.waitMinutes),u.waitMinutes>a.counts.maxMatchingWait&&(a.counts.maxMatchingWait=u.waitMinutes);const g=a.counts.matchingStates.get(u.state)||0;a.counts.matchingStates.set(u.state,g+1)}}a.counts.matches===0&&(a.counts.minMatchingWait=1/0,a.counts.maxMatchingWait=-1/0),a.goroutines.length===0&&r&&(this.setGroupVisibility(a,a.counts.total,s,i,n),a.counts.minMatchingWait=a.counts.minWait,a.counts.maxMatchingWait=a.counts.maxWait,a.counts.matchingStates=new Map(a.counts.states)),a.pinned?a.counts.pinned=a.counts.total:a.counts.pinned=a.goroutines.filter(u=>u.pinned).length}if(a.counts.matches>0){a.counts.minMatchingWait<s.counts.minMatchingWait&&(s.counts.minMatchingWait=a.counts.minMatchingWait),a.counts.maxMatchingWait>s.counts.maxMatchingWait&&(s.counts.maxMatchingWait=a.counts.maxMatchingWait);for(const[r,u]of a.counts.matchingStates){const d=s.counts.matchingStates.get(r)||0;s.counts.matchingStates.set(r,d+u)}}s.counts.matches+=a.counts.matches,s.counts.filterMatches+=a.counts.filterMatches}if(s.counts.matches>0){s.counts.minMatchingWait<i.counts.minMatchingWait&&(i.counts.minMatchingWait=s.counts.minMatchingWait),s.counts.maxMatchingWait>i.counts.maxMatchingWait&&(i.counts.maxMatchingWait=s.counts.maxMatchingWait);for(const[a,l]of s.counts.matchingStates){const r=i.counts.matchingStates.get(a)||0;i.counts.matchingStates.set(a,r+l)}}i.counts.matches+=s.counts.matches,i.counts.filterMatches+=s.counts.filterMatches}if(i.counts.matches===0&&(i.counts.minMatchingWait=1/0,i.counts.maxMatchingWait=-1/0),i.pinned&&i.counts.matches===0&&(i.counts.matches=i.counts.total,i.counts.minMatchingWait=i.counts.minWait,i.counts.maxMatchingWait=i.counts.maxWait,i.counts.matchingStates=new Map(i.counts.states)),i.pinned){i.counts.pinned=i.counts.total;for(const s of i.files){s.counts.pinned=s.counts.total;for(const a of s.groups)a.counts.pinned=a.counts.total}}else{i.counts.pinned=0;for(const s of i.files){if(s.pinned){s.counts.pinned=s.counts.total;for(const a of s.groups)a.counts.pinned=a.counts.total}else{s.counts.pinned=0;for(const a of s.groups)a.pinned?a.counts.pinned=a.counts.total:a.counts.pinned=a.goroutines.filter(l=>l.pinned).length,s.counts.pinned+=a.counts.pinned}i.counts.pinned+=s.counts.pinned}}}if(i.counts.matches>0){i.counts.minMatchingWait<n.counts.minMatchingWait&&(n.counts.minMatchingWait=i.counts.minMatchingWait),i.counts.maxMatchingWait>n.counts.maxMatchingWait&&(n.counts.maxMatchingWait=i.counts.maxMatchingWait);for(const[s,a]of i.counts.matchingStates){const l=n.counts.matchingStates.get(s)||0;n.counts.matchingStates.set(s,l+a)}}}if(n.stacks.every(i=>i.counts.matches===0)&&(n.counts.minMatchingWait=1/0,n.counts.maxMatchingWait=-1/0),n.counts.matches=n.stacks.reduce((i,o)=>i+o.counts.matches,0),n.counts.filterMatches=n.stacks.reduce((i,o)=>i+o.counts.filterMatches,0),n.pinned){n.counts.pinned=n.counts.total;for(const i of n.stacks){i.counts.pinned=i.counts.total;for(const o of i.files){o.counts.pinned=o.counts.total;for(const s of o.groups)s.counts.pinned=s.counts.total}}}else n.counts.pinned=n.stacks.reduce((i,o)=>i+o.counts.pinned,0)}}setGoroutineVisibility(t,e,n,i,o,s){const a=t.matches;t.matches=e,a!==e&&(n.counts.visibilityChanged=!0,i.counts.visibilityChanged=!0,o.counts.visibilityChanged=!0,s.counts.visibilityChanged=!0)}setGroupVisibility(t,e,n,i,o){const s=t.counts.matches;t.counts.matches=e;const a=s>0,l=e>0;a!==l&&(t.counts.visibilityChanged=!0,n.counts.visibilityChanged=!0,i.counts.visibilityChanged=!0,o.counts.visibilityChanged=!0)}clearFilter(){return this.setFilter({filterString:""})}toggleCategoryPin(t){const e=this.categories.find(n=>n.id===t);return e?(e.pinned=!e.pinned,e.pinned):!1}toggleStackPin(t){for(const e of this.categories){const n=e.stacks.find(i=>i.id===t);if(n)return n.pinned=!n.pinned,n.pinned}return!1}toggleGroupPin(t){for(const e of this.categories)for(const n of e.stacks)for(const i of n.files){const o=i.groups.find(s=>s.id===t);if(o)return o.pinned=!o.pinned,o.pinned}return!1}toggleGoroutinePin(t){const e=this.goroutinesByID.get(t);return e?(e.pinned=!e.pinned,e.pinned):!1}toggleStackPinWithChildren(t){return this.categories.forEach(e=>{const n=e?.stacks.find(i=>i.id===t);if(n){const i=!n.pinned;n.pinned=i;for(const o of n.files)for(const s of o.groups){s.pinned=i;for(const a of s.goroutines)a.pinned=i}}}),!1}toggleGroupPinWithChildren(t){for(const e of this.categories)for(const n of e.stacks)for(const i of n.files){const o=i.groups.find(s=>s.id===t);if(o){const s=!o.pinned;o.pinned=s;for(const a of o.goroutines)a.pinned=s;return s}}return!1}toggleCategoryPinWithChildren(t){const e=this.categories.find(n=>n.id===t);if(e){const n=!e.pinned;e.pinned=n;for(const i of e.stacks){i.pinned=n;for(const o of i.files)for(const s of o.groups){s.pinned=n;for(const a of s.goroutines)a.pinned=n}}return n}return!1}unpinAllItems(){for(const t of this.categories)t.pinned=!1;for(const t of this.categories)for(const e of t.stacks){e.pinned=!1;for(const n of e.files){n.pinned=!1;for(const i of n.groups){i.pinned=!1;for(const o of i.goroutines)o.pinned=!1}}}}hasAnyPinnedItems(){for(const t of this.categories){if(t.pinned)return!0;for(const e of t.stacks){if(e.pinned)return!0;for(const n of e.files){if(n.pinned)return!0;for(const i of n.groups){if(i.pinned)return!0;for(const o of i.goroutines)if(o.pinned)return!0}}}}return!1}getCurrentFilter(){return this.currentFilter}getStackStatistics(){let t=0,e=0,n=0,i=0,o=0;return this.categories.forEach(s=>{n+=s.counts.total,i+=s.counts.matches,t+=s.stacks.length,e+=s.stacks.filter(a=>a.counts.matches>0).length,o+=s.counts.pinned}),{total:t,visible:e,totalGoroutines:n,visibleGoroutines:i,pinnedGoroutines:o}}clear(){this.categories=[],this.parsedFiles.clear(),this.goroutinesByID.clear(),this.goroutineToCategory.clear(),this.stackForTraceId.clear(),this.currentFilter="",this.nextGroupId=1,this.nextFileId=1,this.nextCategoryId=1}getFileStatistics(){const t=new Map;for(const e of this.categories)for(const n of e.stacks)for(const i of n.files){t.has(i.fileName)||t.set(i.fileName,{visible:0,total:0});const o=t.get(i.fileName);o.total+=i.counts.total,o.visible+=i.counts.matches}return t}getStateStatistics(){const t=new Map;for(const e of this.categories)for(const[n,i]of e.counts.states){const o=t.get(n)||{visible:0,total:0};o.total+=i,t.set(n,o)}for(const e of this.categories)for(const[n,i]of e.counts.matchingStates){const o=t.get(n);o&&(o.visible+=i)}return t}extractStateFromGroupLabels(t){for(const e of t.labels)if(e.startsWith("state="))return e.substring(6);return"unspecified"}getCategoryForGoroutine(t){return this.goroutineToCategory.get(t)}}var q=function(c,t,e,n){if(e==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?c!==t||!n:!t.has(c))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?n:e==="a"?n.call(c):n?n.value:t.get(c)},$,j;/*!
 * Private helpers. These are only used by other helpers.
 */const Wt=2n**32n-1n,yt=2**32-1,At=yt+1,Kt=typeof Buffer>"u"?c=>new TextEncoder().encode(c):c=>Buffer.from(c,"utf8");function Pt(c){if(!c.length)return 0;let t=0;for(;t<c.length&&c[t++]>=128;);return t}function $t(c){if(!c.length)return BigInt(0);let t=BigInt(c[0]&127),e=0;for(;c[e++]>=128;)t|=BigInt(c[e]&127)<<BigInt(7*e);return t}function ht(c,t=0){return{value:c,offset:t}}function jt(c,t){switch(c){case te:for(let e=0;e<t.length;e++)if(!(t[e]&128))return ht(t.slice(0,e+1));return ht(t);case ee:{const e=Pt(t),n=T(t);return ht(t.slice(e,Number(n)+e),e)}default:throw new Error("Unrecognized value type: ".concat(c))}}function Jt(c){return typeof c!="bigint"?(c>>>0)%At:Number(c&Wt)}function Qt(c){return typeof c!="bigint"?c/At>>>0:Number(c>>32n&Wt)}function Dt(c){const t=c<0;t&&(c=-c);let e=Jt(c),n=Qt(c);return t&&(n=~n>>>0,e=~e>>>0,++e>yt&&(e=0,++n>yt&&(n=0))),[n,e]}const te=0,ee=2;function T(c){if(Pt(c)>4)return $t(c);if(!c.length)return 0;let e=c[0]&127,n=0;for(;c[n++]>=128;)e|=(c[n]&127)<<7*n;return e}function wt(c){const t=[];let e=0;for(let n=0;n<c.length;n++)(c[n]&128)===0&&(t.push(T(c.slice(e,n+1))),e=n+1);return t}function H(c,t){return t==null?[c]:(t.push(c),t)}function tt(c){if(c===0||c===0n)return 0;const[t,e]=Dt(c),n=e,i=(e>>>28|t<<4)>>>0,o=t>>>24;return o!==0?o<128?9:10:i!==0?i<16384?i<128?5:6:i<2097152?7:8:n<16384?n<128?1:2:n<2097152?3:4}function Rt(c){return typeof c>"u"?0:typeof c=="number"||typeof c=="bigint"?tt(c)||1:c.length}function St(c){let t=0;for(const e of c)t+=Rt(e);return t}function I(c){const t=tt(c);return t?1+t:0}function vt(c){let t=0;for(const e of c)t+=tt(e)||1;return t?1+tt(t)+t:0}function Gt(c){const t=Rt(c);return t?1+tt(t)+t:0}function Z(c){let t=0;for(const e of c)t+=Gt(e);return t}function C(c,t,e){if(e===0||e===0n)return c[t++]=0,t;let[n,i]=Dt(e);for(;n;)c[t++]=i&127|128,i=(i>>>7|n<<25)>>>0,n>>>=7;for(;i>127;)c[t++]=i&127|128,i=i>>>7;return c[t++]=i,t}const _t=Symbol();class Q{constructor(t){this.strings=new Array,$.set(this,new Array),j.set(this,new Map),t!==_t&&this.dedup("")}get encodedLength(){let t=0;for(const e of q(this,$,"f"))t+=e.length;return t}_encodeToBuffer(t,e){for(const n of q(this,$,"f"))t.set(n,e),e+=n.length;return e}encode(t=new Uint8Array(this.encodedLength)){return this._encodeToBuffer(t,0),t}static _encodeStringFromUtf8(t){const e=new Uint8Array(1+t.length+(tt(t.length)||1));let n=0;return e[n++]=50,n=C(e,n,t.length),t.length>0&&e.set(t,n++),e}static _encodeString(t){return Q._encodeStringFromUtf8(Kt(t))}dedup(t){if(typeof t=="number")return t;if(!q(this,j,"f").has(t)){const e=this.strings.push(t)-1;q(this,j,"f").set(t,e),q(this,$,"f").push(Q._encodeString(t))}return q(this,j,"f").get(t)}_decodeString(t){const e=new TextDecoder().decode(t);q(this,j,"f").set(e,this.strings.push(e)-1),q(this,$,"f").push(Q._encodeStringFromUtf8(t))}}$=new WeakMap,j=new WeakMap;function V(c,t){const e={};let n=0;for(;n<c.length;){const i=c[n]>>3,o=c[n]&7;n++;const{offset:s,value:a}=jt(o,c.slice(n));n+=a.length+s,t(e,i,a)}return e}class Y{static create(t){return t instanceof Y?t:new Y(t)}constructor(t){this.type=t.type||0,this.unit=t.unit||0}get length(){let t=0;return t+=I(this.type),t+=I(this.unit),t}_encodeToBuffer(t,e=0){return this.type&&(t[e++]=8,e=C(t,e,this.type)),this.unit&&(t[e++]=16,e=C(t,e,this.unit)),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.type=T(n);break;case 2:t.unit=T(n);break}}static decode(t){return new this(V(t,this.decodeValue))}}class et{static create(t){return t instanceof et?t:new et(t)}constructor(t){this.key=t.key||0,this.str=t.str||0,this.num=t.num||0,this.numUnit=t.numUnit||0}get length(){let t=0;return t+=I(this.key),t+=I(this.str),t+=I(this.num),t+=I(this.numUnit),t}_encodeToBuffer(t,e=0){return this.key&&(t[e++]=8,e=C(t,e,this.key)),this.str&&(t[e++]=16,e=C(t,e,this.str)),this.num&&(t[e++]=24,e=C(t,e,this.num)),this.numUnit&&(t[e++]=32,e=C(t,e,this.numUnit)),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.key=T(n);break;case 2:t.str=T(n);break;case 3:t.num=T(n);break;case 4:t.numUnit=T(n);break}}static decode(t){return new this(V(t,this.decodeValue))}}class nt{static create(t){return t instanceof nt?t:new nt(t)}constructor(t){this.locationId=t.locationId||[],this.value=t.value||[],this.label=(t.label||[]).map(et.create)}get length(){let t=0;return t+=vt(this.locationId),t+=vt(this.value),t+=Z(this.label),t}_encodeToBuffer(t,e=0){if(this.locationId.length){t[e++]=10,e=C(t,e,St(this.locationId));for(const n of this.locationId)e=C(t,e,n)}if(this.value.length){t[e++]=18,e=C(t,e,St(this.value));for(const n of this.value)e=C(t,e,n)}for(const n of this.label)t[e++]=26,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.locationId=wt(n);break;case 2:t.value=wt(n);break;case 3:t.label=H(et.decode(n),t.label);break}}static decode(t){return new this(V(t,this.decodeValue))}}class it{static create(t){return t instanceof it?t:new it(t)}constructor(t){this.id=t.id||0,this.memoryStart=t.memoryStart||0,this.memoryLimit=t.memoryLimit||0,this.fileOffset=t.fileOffset||0,this.filename=t.filename||0,this.buildId=t.buildId||0,this.hasFunctions=!!t.hasFunctions,this.hasFilenames=!!t.hasFilenames,this.hasLineNumbers=!!t.hasLineNumbers,this.hasInlineFrames=!!t.hasInlineFrames}get length(){let t=0;return t+=I(this.id),t+=I(this.memoryStart),t+=I(this.memoryLimit),t+=I(this.fileOffset),t+=I(this.filename),t+=I(this.buildId),t+=I(this.hasFunctions?1:0),t+=I(this.hasFilenames?1:0),t+=I(this.hasLineNumbers?1:0),t+=I(this.hasInlineFrames?1:0),t}_encodeToBuffer(t,e=0){return this.id&&(t[e++]=8,e=C(t,e,this.id)),this.memoryStart&&(t[e++]=16,e=C(t,e,this.memoryStart)),this.memoryLimit&&(t[e++]=24,e=C(t,e,this.memoryLimit)),this.fileOffset&&(t[e++]=32,e=C(t,e,this.fileOffset)),this.filename&&(t[e++]=40,e=C(t,e,this.filename)),this.buildId&&(t[e++]=48,e=C(t,e,this.buildId)),this.hasFunctions&&(t[e++]=56,e=C(t,e,1)),this.hasFilenames&&(t[e++]=64,e=C(t,e,1)),this.hasLineNumbers&&(t[e++]=72,e=C(t,e,1)),this.hasInlineFrames&&(t[e++]=80,e=C(t,e,1)),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.id=T(n);break;case 2:t.memoryStart=T(n);break;case 3:t.memoryLimit=T(n);break;case 4:t.fileOffset=T(n);break;case 5:t.filename=T(n);break;case 6:t.buildId=T(n);break;case 7:t.hasFunctions=!!T(n);break;case 8:t.hasFilenames=!!T(n);break;case 9:t.hasLineNumbers=!!T(n);break;case 10:t.hasInlineFrames=!!T(n);break}}static decode(t){return new this(V(t,this.decodeValue))}}class st{static create(t){return t instanceof st?t:new st(t)}constructor(t){this.functionId=t.functionId||0,this.line=t.line||0}get length(){let t=0;return t+=I(this.functionId),t+=I(this.line),t}_encodeToBuffer(t,e=0){return this.functionId&&(t[e++]=8,e=C(t,e,this.functionId)),this.line&&(t[e++]=16,e=C(t,e,this.line)),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.functionId=T(n);break;case 2:t.line=T(n);break}}static decode(t){return new this(V(t,this.decodeValue))}}class ot{static create(t){return t instanceof ot?t:new ot(t)}constructor(t){this.id=t.id||0,this.mappingId=t.mappingId||0,this.address=t.address||0,this.line=(t.line||[]).map(st.create),this.isFolded=!!t.isFolded}get length(){let t=0;return t+=I(this.id),t+=I(this.mappingId),t+=I(this.address),t+=Z(this.line),t+=I(this.isFolded?1:0),t}_encodeToBuffer(t,e=0){this.id&&(t[e++]=8,e=C(t,e,this.id)),this.mappingId&&(t[e++]=16,e=C(t,e,this.mappingId)),this.address&&(t[e++]=24,e=C(t,e,this.address));for(const n of this.line)t[e++]=34,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return this.isFolded&&(t[e++]=40,e=C(t,e,1)),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.id=T(n);break;case 2:t.mappingId=T(n);break;case 3:t.address=T(n);break;case 4:t.line=H(st.decode(n),t.line);break;case 5:t.isFolded=!!T(n);break}}static decode(t){return new this(V(t,this.decodeValue))}}class at{static create(t){return t instanceof at?t:new at(t)}constructor(t){this.id=t.id||0,this.name=t.name||0,this.systemName=t.systemName||0,this.filename=t.filename||0,this.startLine=t.startLine||0}get length(){let t=0;return t+=I(this.id),t+=I(this.name),t+=I(this.systemName),t+=I(this.filename),t+=I(this.startLine),t}_encodeToBuffer(t,e=0){return this.id&&(t[e++]=8,e=C(t,e,this.id)),this.name&&(t[e++]=16,e=C(t,e,this.name)),this.systemName&&(t[e++]=24,e=C(t,e,this.systemName)),this.filename&&(t[e++]=32,e=C(t,e,this.filename)),this.startLine&&(t[e++]=40,e=C(t,e,this.startLine)),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.id=T(n);break;case 2:t.name=T(n);break;case 3:t.systemName=T(n);break;case 4:t.filename=T(n);break;case 5:t.startLine=T(n);break}}static decode(t){return new this(V(t,this.decodeValue))}}class ne{constructor(t={}){this.sampleType=(t.sampleType||[]).map(Y.create),this.sample=(t.sample||[]).map(nt.create),this.mapping=(t.mapping||[]).map(it.create),this.location=(t.location||[]).map(ot.create),this.function=(t.function||[]).map(at.create),this.stringTable=t.stringTable||new Q,this.dropFrames=t.dropFrames||0,this.keepFrames=t.keepFrames||0,this.timeNanos=t.timeNanos||0,this.durationNanos=t.durationNanos||0,this.periodType=t.periodType?Y.create(t.periodType):void 0,this.period=t.period||0,this.comment=t.comment||[],this.defaultSampleType=t.defaultSampleType||0}get length(){let t=0;return t+=Z(this.sampleType),t+=Z(this.sample),t+=Z(this.mapping),t+=Z(this.location),t+=Z(this.function),t+=this.stringTable.encodedLength,t+=I(this.dropFrames),t+=I(this.keepFrames),t+=I(this.timeNanos),t+=I(this.durationNanos),t+=Gt(this.periodType),t+=I(this.period),t+=vt(this.comment),t+=I(this.defaultSampleType),t}_encodeSampleTypesToBuffer(t,e=0){for(const n of this.sampleType)t[e++]=10,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return e}_encodeSamplesToBuffer(t,e=0){for(const n of this.sample)t[e++]=18,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return e}_encodeMappingsToBuffer(t,e=0){for(const n of this.mapping)t[e++]=26,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return e}_encodeLocationsToBuffer(t,e=0){for(const n of this.location)t[e++]=34,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return e}_encodeFunctionsToBuffer(t,e=0){for(const n of this.function)t[e++]=42,e=C(t,e,n.length),e=n._encodeToBuffer(t,e);return e}_encodeBasicValuesToBuffer(t,e=0){if(this.dropFrames&&(t[e++]=56,e=C(t,e,this.dropFrames)),this.keepFrames&&(t[e++]=64,e=C(t,e,this.keepFrames)),this.timeNanos&&(t[e++]=72,e=C(t,e,this.timeNanos)),this.durationNanos&&(t[e++]=80,e=C(t,e,this.durationNanos)),typeof this.periodType<"u"&&(t[e++]=90,e=C(t,e,this.periodType.length),e=this.periodType._encodeToBuffer(t,e)),this.period&&(t[e++]=96,e=C(t,e,this.period)),this.comment.length){t[e++]=106,e=C(t,e,St(this.comment));for(const n of this.comment)e=C(t,e,n)}return this.defaultSampleType&&(t[e++]=112,e=C(t,e,this.defaultSampleType)),e}_encodeToBuffer(t,e=0){return e=this._encodeSampleTypesToBuffer(t,e),e=this._encodeSamplesToBuffer(t,e),e=this._encodeMappingsToBuffer(t,e),e=this._encodeLocationsToBuffer(t,e),e=this._encodeFunctionsToBuffer(t,e),e=this.stringTable._encodeToBuffer(t,e),e=this._encodeBasicValuesToBuffer(t,e),e}async _encodeToBufferAsync(t,e=0){return e=this._encodeSampleTypesToBuffer(t,e),await new Promise(setImmediate),e=this._encodeSamplesToBuffer(t,e),await new Promise(setImmediate),e=this._encodeMappingsToBuffer(t,e),await new Promise(setImmediate),e=this._encodeLocationsToBuffer(t,e),await new Promise(setImmediate),e=this._encodeFunctionsToBuffer(t,e),await new Promise(setImmediate),e=this.stringTable._encodeToBuffer(t,e),await new Promise(setImmediate),e=this._encodeBasicValuesToBuffer(t,e),e}encode(t=new Uint8Array(this.length)){return this._encodeToBuffer(t,0),t}async encodeAsync(t=new Uint8Array(this.length)){return await this._encodeToBufferAsync(t,0),t}static decodeValue(t,e,n){switch(e){case 1:t.sampleType=H(Y.decode(n),t.sampleType);break;case 2:t.sample=H(nt.decode(n),t.sample);break;case 3:t.mapping=H(it.decode(n),t.mapping);break;case 4:t.location=H(ot.decode(n),t.location);break;case 5:t.function=H(at.decode(n),t.function);break;case 6:{t.stringTable===void 0&&(t.stringTable=new Q(_t)),t.stringTable._decodeString(n);break}case 7:t.dropFrames=T(n);break;case 8:t.keepFrames=T(n);break;case 9:t.timeNanos=T(n);break;case 10:t.durationNanos=T(n);break;case 11:t.periodType=Y.decode(n);break;case 12:t.period=T(n);break;case 13:t.comment=wt(n);break;case 14:t.defaultSampleType=T(n);break}}static decode(t){return new this(V(t,this.decodeValue))}}function ie(c){let t=2166136261;for(let e=0;e<c.length;e++)t^=c.charCodeAt(e),t*=16777619,t=t>>>0;return t.toString(16).padStart(8,"0")}async function mt(c){const t=c.map(a=>"".concat(a.func," ").concat(a.file,":").concat(a.line)).join("\n");if(!globalThis.crypto?.subtle){const a=ie(t);return(a+a+a).slice(0,24)}const n=new TextEncoder().encode(t),i=await globalThis.crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(i)).map(a=>a.toString(16).padStart(2,"0")).join("").slice(-24)}class se{constructor(t){this.nameExtractionPatterns=t?.nameExtractionPatterns||[]}async parseFile(t,e){const n=await t.slice(0,2).arrayBuffer(),i=new Uint8Array(n),o=i.length>=2&&i[0]===31&&i[1]===139,s=e||"unknown";if(o)return await this.parseFormat0(t,s);{const a=await t.text();return this.parseString(a,s)}}async parseString(t,e){return t.trim()?this.detectFormat1(t)?await this.parseFormat1(t,e):this.detectFormat2(t)?await this.parseFormat2(t,e):{success:!0,data:{originalName:e,groups:[]}}:{success:!0,data:{originalName:e,groups:[]}}}extractNameFromLine(t){for(const e of this.nameExtractionPatterns)try{if(!e.startsWith("s|"))continue;const n=e.slice(2).split("|");if(n.length<2)continue;const i=n[0],o=n[1],s=new RegExp(i),a=t.match(s);if(a){let l=o;if(l.startsWith("hex:"))l=l.slice(4),l=l.replace("$1",parseInt(a[1],16).toString());else for(let r=0;r<a.length;r++)l=l.replace("$".concat(r),a[r]||"");return l}}catch{continue}return null}detectFormat1(t){return t.startsWith("goroutine profile:")}detectFormat2(t){const e=t.trim();return/^goroutine \d+ (\[|gp=)/.test(e)||/\ngoroutine \d+ (\[|gp=)/.test(t)}async parseFormat0(t,e){try{const n=t.stream().pipeThrough(new DecompressionStream("gzip")),o=await new Response(n).arrayBuffer(),s=new Uint8Array(o),a=ne.decode(s),l=[];for(const d of a.sample){const m=[],p=d.value||[],g=p.length>0?Number(p[0]):1,f=[],w=a.stringTable?.strings||[];if(d.label)for(const y of d.label){const v=w[Number(y.key)||0]||"",b=w[Number(y.str)||0]||"";v&&b?f.push("".concat(v,"=").concat(b)):v&&f.push(v)}let S=!0,x=null;for(const y of d.locationId||[]){const v=a.location.find(b=>b.id===y);if(v)for(const b of v.line||[]){const k=a.function.find(E=>E.id===b.functionId);if(k){const E=w[Number(k.name)||0]||"unknown",B=w[Number(k.filename)||0]||"unknown";if(S&&this.shouldSkipRuntimeFrame(E)){x=E;continue}S=!1,m.push({func:E,file:B,line:Number(b.line)||0})}}}if(x){const y=this.synthesizeRuntimeLabel(x);y&&f.push(y)}if(m.length>0){const y=await mt(m);l.push({traceId:y,count:g,labels:f,goroutines:[],trace:m})}}let r=null;for(const d of l){for(const m of d.labels){const p=this.extractNameFromLine(m);if(p){r=p;break}}if(r)break}return{success:!0,data:{originalName:r||e,groups:l}}}catch(n){return{success:!1,error:"Failed to parse pprof format: ".concat(n instanceof Error?n.message:String(n))}}}async parseFormat2(t,e){const n=t.split("\n"),i=new Map,o=new Map,s=[];let a=null,l=0;for(;l<n.length;){const m=n[l].trim();if(a||(a=this.extractNameFromLine(m)),!m.startsWith("goroutine ")){l++;continue}let p=m.match(/^goroutine (\d+) \[([^\]]+)\]:/);if(p||(p=m.match(/^goroutine (\d+) gp=\S+ m=\S+(?:\s+mp=\S+)? \[([^\]]+)\]:/)),!p){l++;continue}const[,g,f]=p,w=parseInt(g),S=f.split(",").map(N=>N.trim()),x=S[0];let y=0;const v=[];for(let N=1;N<S.length;N++){const D=S[N],_=D.match(/^(\d+(?:\.\d+)?)\s*minutes?$/);_?y=parseFloat(_[1]):D&&v.push(D)}l++;const b=[];let k="";for(;l<n.length&&n[l].trim();){const N=n[l].trim();if(a||(a=this.extractNameFromLine(N)),N.startsWith("created by ")){const D=N.match(/created by .+ in goroutine (\d+)/);k=D?D[1]:"",l++;break}if(N&&!N.startsWith("	")){const D=N.match(/^(.+)(\(.*\))$/);let _;if(D?_=D[1]:_=N,l++,l<n.length&&n[l].startsWith("	")){const M=n[l].trim().match(/^(.+?):(\d+)/);if(M){const[,R,A]=M,F=parseInt(A);b.push({func:_,file:R,line:F})}}}l++}const E=this.transformState(x),B=String(w),P={id:B,state:E,waitMinutes:y,creator:k,creatorExists:!1,created:[]};i.set(B,!0),(o.get(k)??o.set(k,[]).get(k)).push(B),s.push({goroutine:P,trace:b,labels:v})}const r=new Map;for(const{goroutine:m,trace:p,labels:g}of s){const f=await mt(p);r.has(f)||r.set(f,{trace:p,goroutines:[],allLabels:new Set});const w=r.get(f);w.goroutines.push(m),g.forEach(S=>w.allLabels.add(S))}const u=[];for(const[m,{trace:p,goroutines:g,allLabels:f}]of r){const w=new Map;for(const S of g)w.has(S.state)||w.set(S.state,[]),w.get(S.state).push(S);for(const[S,x]of w){const y=["state=".concat(S)];f.forEach(v=>y.push(v)),u.push({traceId:m,count:x.length,labels:y,goroutines:x,trace:p})}}u.forEach(m=>m.goroutines.forEach(p=>{p.creatorExists=p.creator?i.has(p.creator):!1,p.created=o.get(p.id)??[]}));const d={originalName:e,groups:u};return a&&(d.extractedName=a),{success:!0,data:d}}async parseFormat1(t,e){const n=t.split("\n"),i=[];let o=0,s=null;const l=n[0]?.trim()?.match(/goroutine profile: total (\d+)/);l&&(o=parseInt(l[1]));let r=0;for(;r<n.length;){const d=n[r].trim();s||(s=this.extractNameFromLine(d));const m=d.match(/^(\d+) @/)||d.match(/^(\d+) goroutines? in stack:/);if(!m){r++;continue}const p=parseInt(m[1]);r++;const g=[];for(;r<n.length;){const w=n[r].trim();if(s||(s=this.extractNameFromLine(w)),w.startsWith("# labels:")){const S=w.match(/# labels:\s*({.*})/);if(S)try{const x=JSON.parse(S[1]);g.push(...Object.entries(x).map(([y,v])=>"".concat(y,"=").concat(v)))}catch{return{success:!1,error:"Failed to parse labels: ".concat(S[1])}}r++;continue}break}const f=[];for(;r<n.length;){const w=n[r].trim();if(s||(s=this.extractNameFromLine(w)),!w.startsWith("#")||w==="#")break;const S=w.match(/^#\s*0x[0-9a-f]+\s+([^\s]+)\s+(.+?):(\d+)/);if(S){let[,x,y,v]=S;x=x.replace(/\+0x[0-9a-fA-F]+$/,"");const b=parseInt(v);f.push({func:x,file:y,line:b})}r++}i.push({traceId:await mt(f),count:p,labels:g,goroutines:[],trace:f})}const u={originalName:e,totalGoroutines:o,groups:i};return s&&(u.extractedName=s),{success:!0,data:u}}transformState(t){return t==="sync.WaitGroup.Wait"||t==="sync.Cond.Wait"?"wait":t==="sync.Mutex.Lock"?"semacquire":t}shouldSkipRuntimeFrame(t){return t==="runtime.gopark"||t==="runtime.goparkunlock"||t==="runtime.selectgo"||t==="runtime.chanrecv"||t==="runtime.chanrecv1"||t==="runtime.chanrecv2"||t==="runtime.chansend"||t==="runtime.semacquire"||t==="runtime.semacquire1"||t==="runtime.netpollblock"||t==="runtime.notetsleepg"}synthesizeRuntimeLabel(t){switch(t){case"runtime.chanrecv":case"runtime.chanrecv1":case"runtime.chanrecv2":return"state=chan receive";case"runtime.chansend":return"state=chan send";case"runtime.selectgo":return"state=select";case"runtime.gopark":case"runtime.goparkunlock":return"state=parked";case"runtime.semacquire":case"runtime.semacquire1":return"state=semacquire";case"runtime.netpollblock":return"state=netpoll";case"runtime.notetsleepg":return"state=sleep";default:return null}}}class Ft{static isZipFile(t){return t.name.toLowerCase().endsWith(".zip")||t.type==="application/zip"}static async readFileChunk(t,e,n){return await t.slice(e,e+n).arrayBuffer()}static async extractFiles(t,e=[/^(.*\/)?stacks\.txt$/]){if(typeof globalThis.DecompressionStream>"u")throw new Error("DecompressionStream is required by this app.");const n=t.size,i=Math.min(n,65558),o=await this.readFileChunk(t,n-i,i),s=new DataView(o),a=101010256,l=101075792,r=117853008,u=22;let d=-1;for(let M=o.byteLength-u;M>=0;M--)if(s.getUint32(M,!0)===a){d=M;break}if(d<0)throw new Error("ZIP: EOCD not found");const m=s.getUint16(d+4,!0),p=s.getUint16(d+6,!0);if(m!==0||p!==0)throw new Error("ZIP: multi-disk archives are not supported");let g=s.getUint16(d+10,!0),f=s.getUint32(d+12,!0),w=s.getUint32(d+16,!0);if(g===65535||f===4294967295||w===4294967295){let M=-1;for(let L=d-20;L>=Math.max(0,d-200);L--)if(s.getUint32(L,!0)===r){M=L;break}if(M<0)throw new Error("ZIP: ZIP64 EOCD Locator not found");const R=s.getUint32(M+8,!0)+s.getUint32(M+12,!0)*4294967296,A=await this.readFileChunk(t,R,56),F=new DataView(A);if(F.getUint32(0,!0)!==l)throw new Error("ZIP: Invalid ZIP64 EOCD signature");g=F.getUint32(32,!0),f=F.getUint32(40,!0)+F.getUint32(44,!0)*4294967296,w=F.getUint32(48,!0)+F.getUint32(52,!0)*4294967296}const x=await this.readFileChunk(t,w,f),y=new DataView(x),v=new Uint8Array(x),b=33639248,k=[];let E=0;const B=f,P=new TextDecoder("utf-8");for(;E<B&&k.length<g;){if(y.getUint32(E,!0)!==b)throw new Error("ZIP: bad central directory signature");const M=y.getUint16(E+8,!0),R=y.getUint16(E+10,!0);let A=y.getUint32(E+20,!0),F=y.getUint32(E+24,!0);const L=y.getUint16(E+28,!0),U=y.getUint16(E+30,!0),zt=y.getUint16(E+32,!0);let ut=y.getUint32(E+42,!0);const ct=E+46,Ct=v.subarray(ct,ct+L),Ut=(M&2048)!==0?P.decode(Ct):String.fromCharCode(...Ct);let Et=!1;const bt=ct+L;let O=bt;const Ot=bt+U;for(;O<Ot-4;){const qt=y.getUint16(O,!0),lt=y.getUint16(O+2,!0);if(qt===1){Et=!0;let G=O+4;F===4294967295&&G+8<=O+4+lt&&(F=y.getUint32(G,!0)+y.getUint32(G+4,!0)*4294967296,G+=8),A===4294967295&&G+8<=O+4+lt&&(A=y.getUint32(G,!0)+y.getUint32(G+4,!0)*4294967296,G+=8),ut===4294967295&&G+8<=O+4+lt&&(ut=y.getUint32(G,!0)+y.getUint32(G+4,!0)*4294967296,G+=8);break}O+=4+lt}k.push({filename:Ut,method:R,flags:M,compSize:A,uncompSize:F,lfhOffset:ut,hasZip64Extra:Et}),E=ct+L+U+zt}const N=67324752,D=async M=>{const R=await this.readFileChunk(t,M,30),A=new DataView(R);if(A.getUint32(0,!0)!==N)throw new Error("ZIP: bad local file header");const F=A.getUint16(26,!0),L=A.getUint16(28,!0);return M+30+F+L},_=[];let X=0;for(const M of k){if(!e.some(L=>L.test(M.filename)))continue;if(M.method!==0&&M.method!==8)throw new Error("ZIP: unsupported compression method ".concat(M.method," for ").concat(M.filename));const R=await D(M.lfhOffset),A=t.slice(R,R+M.compSize);let F;if(M.method===0)F=A;else{const L=new DecompressionStream("deflate-raw"),U=A.stream().pipeThrough(L);F=await new Response(U).blob()}_.push({path:M.filename,content:F}),X=X+M.uncompSize}return{files:_,totalSize:X}}}function h(c,t,...e){const n=document.createElement(c);if(t)for(const[i,o]of Object.entries(t))i==="className"?n.className=String(o):i==="contentEditable"?n.contentEditable=String(o):n.setAttribute(i,String(o));return e.forEach(i=>{typeof i=="string"?n.appendChild(document.createTextNode(i)):i instanceof HTMLElement&&n.appendChild(i)}),n}function W(c){return{content:{cloneNode:(t=!0)=>{const e=document.createDocumentFragment();return e.appendChild(c.cloneNode(!0)),e},firstElementChild:c}}}const oe=h("div",{className:"section expandable category-section"},h("div",{className:"header"},h("div",{className:"category-title"}),h("div",{className:"header-right"},h("div",{className:"category-count counts"}),h("div",{className:"category-stats"})),h("button",{className:"pin-button size-large"},"📌")),h("div",{className:"section-content category-content"})),ae=h("div",{className:"section expandable stack-section"},h("div",{className:"header"},h("div",{className:"stack-title"}),h("div",{className:"header-right"},h("div",{className:"stack-count counts"}),h("div",{className:"stack-stats"})),h("button",{className:"pin-button size-large"},"📌"),h("button",{className:"copy-button size-large"},"📋")),h("div",{className:"section-content stack-content"})),re=h("div",{className:"section expandable file-section"},h("div",{className:"header"},h("span",{className:"title"},h("span",{className:"expand-icon"}),h("span",{className:"file-name"})),h("span",{className:"counts"})),h("div",{className:"section-content"})),ce=h("div",{className:"section expandable group-section"},h("div",{className:"header"},h("span",{className:"title"},h("span",{className:"expand-icon"}),h("span",{className:"group-header-label"})),h("span",{className:"group-header-count counts"}),h("button",{className:"pin-button size-large"},"📌")),h("div",{className:"section-content"})),le=h("div",{className:"goroutine-entry"},h("button",{className:"pin-button size-small"},"📌"),h("div",{className:"goroutine-header"},h("div",{className:"goroutine-header-first-line"},h("span",{className:"goroutine-header-left"}),h("span",{className:"goroutine-created-by"})),h("div",{className:"goroutine-header-second-line"}))),de=h("div",{className:"unique-stack-content"}),ue=h("div",{className:"show-more-link"},h("span",{className:"show-more-text"},"Show ",h("span",{className:"show-more-link-clickable"})," more goroutines ▼")),he=h("div",{className:"file-item"},h("span",{className:"file-name-text",contentEditable:!1}),h("div",{className:"file-stats counts"}),h("button",{className:"file-remove-btn"},"×")),me=h("div",{className:"empty-state"},"Drop files here or click ",h("strong",null,"+")," to add"),pe=h("div",{className:"file-drop-area"},"Drop more files here"),ge=h("div",{className:"drop-message"},h("div",null,"📁 Drop Goroutine profiles here to get started"),h("div",{className:"demo-add-files"},"text and binary pprof profile formats auto-detected"),h("div",{className:"demo-add-files"},"traceback as file suffix (e.g. a crash log) also supported"),h("div",{className:"demo-add-files"},"all analysis done in-browser — nothing is uploaded anywhere"),h("div",{className:"demo-section-divider"},h("div",{className:"demo-try-demo"},"⚡️ Or try a quick demo with some example CockroachDB stack dumps:"),h("div",{className:"demo-buttons"},h("a",{id:"demoSingleBtn",href:"#",className:"demo-link"},"📄 single node goroutine dump →"),h("a",{id:"demoZipBtn",href:"#",className:"demo-link"},"📦 zip file of stacks from 4 nodes →")))),fe=h("div",{className:"container"},h("button",{className:"narrow-back-btn",id:"narrowBackBtn",style:"display: none;",disabled:!0,title:"Go back to previous goroutine (Alt+← or Backspace)"},"←"),h("div",{className:"sidebar-overlay",id:"sidebarOverlay"}),h("button",{className:"narrow-close-btn",id:"narrowCloseBtn",style:"display: none;",title:"Hide sidebar"},"‹"),h("div",{className:"sidebar",id:"sidebar"}),h("div",{className:"main-content",id:"mainContent"})),ye=h("div",{className:"sidebar"},h("div",{className:"filter-section file-section"},h("div",{className:"files-header"},h("div",{className:"files-title"},h("h3",null,"Files ",h("button",{className:"add-file-btn",id:"addFileBtn",title:"Add more files"},"+"))),h("button",{className:"clear-all-btn",id:"clearAllBtn",title:"Clear all files"},"×")),h("div",{className:"file-list-container",id:"fileListContainer"},h("div",{className:"file-list",id:"fileList"}))),h("div",{className:"filter-section"},h("div",{className:"filter-header"},h("h3",null,"Filter"),h("button",{className:"clear-all-btn",id:"clearFilterBtn",title:"Clear filter"},"×")),h("input",{type:"text",className:"filter-input",id:"filterInput",placeholder:"e.g. flush wait:>5"}),h("div",{className:"filter-error",id:"filterError",style:"display: none;"})),h("div",{className:"filter-section"},h("h3",null,"Statistics"),h("div",{className:"stats",id:"stats"},h("div",{className:"stats-item"},"Stacks: ",h("span",{id:"stackCounts"},"0 / 0")),h("div",{className:"stats-item"},"Goroutines: ",h("span",{id:"goroutineCounts"},"0 / 0")),h("div",{className:"state-stats",id:"stateStats"}))),h("h3",{className:"narrow-controls-header",style:"display: none;"},"Controls"),h("div",{className:"narrow-controls",style:"display: none;"},h("div",{className:"narrow-controls-row"},h("button",{id:"narrowExpandAllBtn",className:"control-btn"},"Expand All"),h("button",{id:"narrowCollapseAllBtn",className:"control-btn"},"Collapse All")),h("div",{className:"narrow-controls-row"},h("button",{id:"narrowUnpinAllBtn",className:"control-btn"},"Unpin All")),h("div",{className:"narrow-controls-row"},h("select",{id:"narrowStackDisplayModeSelect",className:"narrow-select",title:"Choose how to display stack traces"},h("option",{value:"combined"},"Combined View"),h("option",{value:"side-by-side"},"Side by Side"),h("option",{value:"functions"},"Functions Only"),h("option",{value:"locations"},"Locations Only")))),h("div",{className:"settings-container"},h("a",{href:"https://github.com/dt/stackgazer",target:"_blank",className:"github-btn",title:"View on GitHub",id:"githubBtn"}),h("button",{className:"theme-toggle-btn",id:"themeToggleBtn",title:"Toggle light/dark theme"},"🌙"),h("button",{className:"settings-btn",id:"settingsBtn",title:"Advanced Settings"},"⚙️"))),we=h("div",{className:"main-content"},h("div",{className:"view-controls-bar"},h("div",{className:"narrow-filter-container",style:"display: none;"},h("button",{className:"narrow-menu-btn",id:"narrowMenuBtn"},"☰"),h("input",{type:"text",className:"narrow-filter-input",id:"narrowFilterInput",placeholder:"Filter stacks (e.g. flush wait:>5)"})),h("div",{className:"left-controls"},h("button",{id:"backBtn",className:"control-btn",disabled:!0,title:"Go back to previous goroutine (Alt+← or Backspace)"},h("span",{className:"back-text"},"← Back"))),h("div",{className:"right-controls"},h("select",{id:"stackDisplayModeSelect",title:"Choose how to display stack traces"},h("option",{value:"combined"},"Combined View"),h("option",{value:"side-by-side"},"Side by Side"),h("option",{value:"functions"},"Functions Only"),h("option",{value:"locations"},"Locations Only")),h("button",{id:"unpinAllBtn",className:"control-btn"},"Unpin All"),h("button",{id:"expandAllBtn",className:"control-btn"},"Expand All"),h("button",{id:"collapseAllBtn",className:"control-btn"},"Collapse All"))),h("div",{className:"drop-zone",id:"dropZone"}),h("div",{className:"copy-notification",id:"copyNotification",style:"display: none;"},"📋 Copied to clipboard!")),Se=h("div",{id:"ancestryModal",className:"ancestry-modal modal-visible"},h("div",{className:"ancestry-modal-content"},h("button",{className:"ancestry-modal-close"},"×"),h("div",{className:"ancestry-tree-container"},h("div",{className:"ancestry-zoom-controls"},h("button",{className:"ancestry-zoom-in"},"+"),h("button",{className:"ancestry-zoom-out"},"−"),h("button",{className:"ancestry-fit-view"},"⌖"))))),ve=h("p",{className:"ancestry-empty-state"},"No ancestry data available"),ke=h("div",{className:"loading-overlay",id:"loadingOverlay",style:"display: none;"},h("div",{className:"loading-content"},h("div",{className:"loading-spinner"}),h("div",{className:"loading-message",id:"loadingMessage"},"Processing files..."),h("div",{className:"loading-details",id:"loadingDetails"}),h("div",{className:"loading-progress",id:"loadingProgressContainer",style:"display: none;"},h("div",{className:"loading-progress-indeterminate",id:"loadingProgressBar"}))));function xe(c){return h("div",{className:"setting-section"},h("div",{className:"setting-title"},h("span",{},c.title),h("button",{className:"setting-help-icon","data-tooltip":c.helpTooltip},"?")),h("div",{className:"setting-description"},c.description),h("div",{className:"default-rules-section settings-collapsed"},h("div",{className:"default-rules-header"},h("div",{className:"default-rules-title"},h("span",{className:"expand-icon"},"▼"),h("h5",{},"Default Rules")),h("label",{className:"toggle-switch"},h("input",{type:"checkbox",id:"useDefault".concat(c.id),checked:!0}),h("span",{className:"toggle-slider"}))),h("div",{className:"default-rules-content collapsed-settings"},h("textarea",{id:"default".concat(c.id),className:"setting-textarea default-rules-textarea",rows:c.defaultRows,readOnly:!0,placeholder:"Default rules will appear here..."}))),h("div",{className:"custom-rules-section settings-collapsed"},h("div",{className:"custom-rules-header"},h("div",{className:"custom-rules-title"},h("h5",{},"Custom Rules (0)"))),h("div",{className:"custom-rules-content collapsed-settings"},h("textarea",{id:"custom".concat(c.id),className:"setting-textarea",rows:c.customRows,placeholder:c.customPlaceholder||"Add your own rules here..."}))))}const Ce=h("div",{id:"settingsModal",className:"modal"},h("div",{className:"modal-content"},h("div",{className:"modal-header"},h("h3",null,"Advanced Settings"),h("button",{className:"modal-close",id:"settingsModalCloseBtn"},"×")),h("div",{className:"modal-body",id:"settingsModalBody"}),h("div",{className:"settings-actions"},h("button",{id:"resetSettingsBtn",className:"btn btn-danger settings-reset-btn"},"Reset to Defaults"),h("button",{id:"saveSettingsBtn",className:"btn settings-save-btn"},"Save Settings")))),K={Categorization:{"Skip Rules":{description:"Skip these patterns when categorizing stacks.",tooltip:"One pattern per line. Frames matching these patterns will be ignored when determining category.",settingKey:"categorySkipRules"},"Match Rules":{description:"Extract category names using these patterns.",tooltip:"One pattern per line. Format: s|pattern|replacement| where replacement can use $1, $2, etc. for capture groups.",settingKey:"categoryMatchRules"}},"Stack Naming":{"Skip Rules":{description:"Skip these patterns when naming stacks.",tooltip:"One pattern per line. Frames matching these patterns will be ignored when building stack names.",settingKey:"nameSkipRules"},"Trim Rules":{description:"Trim prefixes or apply regex replacements.",tooltip:"One pattern per line. Format: 'prefix' to remove prefix, or 's|pattern|replacement|' for regex replacement.",settingKey:"nameTrimRules"},"Fold Rules":{description:"Fold frame sequences into concise names.",tooltip:"One rule per line. Format: s|pattern,while-pattern|replacement| where 'while-pattern' specifies what frames to consume after the match.",settingKey:"nameFoldRules"},"Find Rules":{description:"Find patterns in remaining frames and prepend to stack name.",tooltip:"One rule per line. Format: s|pattern,while-pattern|replacement| to scan remaining frames and pull up matching information.",settingKey:"nameFindRules"}},"Fie Parsing":{"Function Trim Prefixes":{description:"Remove these prefixes from function names for cleaner display.",tooltip:"One prefix per line. Example: 'github.com/myorg/' would trim 'github.com/myorg/mypackage.Function' to 'mypackage.Function'",settingKey:"functionTrimPrefixes"},"File Trim Prefixes":{description:"Remove these prefixes from file paths for cleaner display.",tooltip:"One prefix per line. Example: '/go/src/' would trim '/go/src/myproject/main.go' to 'myproject/main.go'",settingKey:"fileTrimPrefixes"},"File Name Extraction":{description:"File name extraction allows automatic file naming during parsing based on content patterns or labels found in stack traces. When a pattern matches, the extracted name becomes the file name instead of the original filename.",tooltip:"Patterns to extract custom file names from stack trace content or labels during parsing. Format: regex pattern with replacement template. Examples: 'tags=([^,\\s]+)' with replacement '$1' extracts 'n1' from 'tags=n1'",settingKey:"nameExtractionPatterns"},"Zip File Path Patterns":{description:"Pattern to identify stack trace files in zip archives.",tooltip:"Regex pattern to match files inside zip archives that should be extracted and parsed as stack trace files. Examples: '^(.*\\/)?stacks\\.txt$', '^logs\\/.*\\.txt$', '^.*\\.log$'",settingKey:"zipFilePatterns"}}},Bt={category:W(oe),stack:W(ae),fileSection:W(re),group:W(ce),goroutine:W(le),stackTrace:W(de),showMore:W(ue),fileItem:W(he),fileEmptyState:W(me),fileDropArea:W(pe),dropZoneEmpty:W(ge),container:W(fe),sidebar:W(ye),mainContent:W(we),settingsModal:W(Ce),ancestryModal:W(Se),ancestryEmptyState:W(ve),loadingOverlay:W(ke)};function Ee(c){const t=document.createDocumentFragment();return c.forEach(([e,n])=>{const i=document.createElement("div"),o=document.createElement("span");o.textContent=e;const s=document.createElement("span");s.textContent="".concat(n.visible," / ").concat(n.total),i.appendChild(o),i.appendChild(s),t.appendChild(i)}),t}class be{constructor(){this.navigationHistory=[],this.expandedGroups=new Set,this.expandedFiles=new Set}addToNavigationHistory(t){return this.navigationHistory.length>0&&this.navigationHistory[this.navigationHistory.length-1]===t?{canGoBack:this.navigationHistory.length>0}:(this.navigationHistory.push(t),{canGoBack:this.navigationHistory.length>0})}navigateBack(){return this.navigationHistory.length===0?{targetGoroutineId:null,canGoBack:!1}:{targetGoroutineId:this.navigationHistory.pop(),canGoBack:this.navigationHistory.length>0}}canNavigateBack(){return this.navigationHistory.length>0}toggleGroupExpansion(t){const e=this.expandedGroups.has(t);return e?this.expandedGroups.delete(t):this.expandedGroups.add(t),{isExpanded:!e}}toggleFileExpansion(t){const e=this.expandedFiles.has(t);return e?this.expandedFiles.delete(t):this.expandedFiles.add(t),{isExpanded:!e}}isGroupExpanded(t){return this.expandedGroups.has(t)}isFileExpanded(t){return this.expandedFiles.has(t)}expandAllGroups(t){return t.forEach(e=>this.expandedGroups.add(e)),{expandedGroups:new Set(this.expandedGroups),expandedFiles:new Set(this.expandedFiles)}}collapseAllGroups(){return this.expandedGroups.clear(),{expandedGroups:new Set(this.expandedGroups),expandedFiles:new Set(this.expandedFiles)}}reset(){this.navigationHistory=[],this.expandedGroups.clear(),this.expandedFiles.clear()}}const Me=["running","runnable","syscall","IO wait","semacquire","select","chan receive","chan send","wait"];function Lt(c){const t=Me.indexOf(c);return t===-1?1/0:t}function pt(c){return c.sort(([t],[e])=>{const n=Lt(t),i=Lt(e);return n!==i?n-i:t.localeCompare(e)})}const Te={functionTrimPrefixes:[],fileTrimPrefixes:[],categorySkipRules:["runtime.goexit","sync.","internal/","golang.org/x/sync/errgroup","google.golang.org/grpc"],categoryMatchRules:["s|^((([^/.\\[]*\\.[^/\\[]*)*/)?[^/\\.\\[]+(/[^/.\\[]+)?)|$1|"],nameSkipRules:["runtime.gopark","runtime.selectgo","runtime.semacquire1","sync.runtime_notifyListWait","sync.runtime_Semacquire","golang.org/x/sync/errgroup.(*Group).Wait"],nameTrimRules:["s|\\[[^\\]]*\\]||","s|\\.func\\d+(\\.\\d+)?$||","util/","s|^server.\\(\\*Node\\).Batch$|batch|"],nameFoldRules:["s|sync.(*Cond).Wait,|condwait|","s|sync.(*WaitGroup).Wait,|waitgroup|","s|net/http,stdlib|net/http|","s|syscall.Syscall,stdlib|syscall|","s|internal/poll.runtime_pollWait,stdlib|netpoll|","s|google.golang.org/grpc/internal/transport.(*Stream).waitOnHeader,google.golang.org/grpc|grpc|","s|google.golang.org/grpc/internal/transport.(*recvBufferReader).read,(google.golang.org/grpc.*|io.Read)|recv|"],nameFindRules:[],zipFilePatterns:["^(.*/)?stacks.txt$"],nameExtractionPatterns:[]};function z(c,t){const e=[];return t?.ignoreDefault||e.push(...c),t?.custom&&e.push(...t.custom),e}function Nt(c,t){return{functionTrimPrefixes:z(c.functionTrimPrefixes,t.functionTrimPrefixes),fileTrimPrefixes:z(c.fileTrimPrefixes,t.fileTrimPrefixes),zipFilePatterns:z(c.zipFilePatterns,t.zipFilePatterns),categorySkipRules:z(c.categorySkipRules,t.categorySkipRules),categoryMatchRules:z(c.categoryMatchRules,t.categoryMatchRules),nameSkipRules:z(c.nameSkipRules,t.nameSkipRules),nameTrimRules:z(c.nameTrimRules,t.nameTrimRules),nameFoldRules:z(c.nameFoldRules,t.nameFoldRules),nameFindRules:z(c.nameFindRules,t.nameFindRules),nameExtractionPatterns:z(c.nameExtractionPatterns,t.nameExtractionPatterns)}}const J=class J{constructor(t,e){this.storedSettings={},this.changeCallback=null;const n=this.getBuiltinDefaults(),i=t?t(n):n;this.validateAppSettings(i,"customizer"),this.defaultSettings=i,this.settings={...this.defaultSettings},e||this.loadSettings()}getBuiltinDefaults(){return{...Te}}validateAppSettings(t,e){if(!t||typeof t!="object")throw new Error("".concat(e," must return an object, got ").concat(typeof t));const n=this.getBuiltinDefaults();for(const i in t){if(!(i in n))continue;const o=n[i],s=t[i];if(!this.typesMatch(o,s)){const a=this.getTypeDescription(o),l=this.getTypeDescription(s);let r="";throw a.includes("[]")&&l==="string"&&(r=' If you\'re migrating from the old string format, convert "rule1\\nrule2" to ["rule1", "rule2"]'),new Error("".concat(e,": '").concat(i,"' must be ").concat(a,", got ").concat(l).concat(r))}if(Array.isArray(o)&&Array.isArray(s)&&o.length>0&&typeof o[0]=="string"&&!s.every(a=>typeof a=="string"))throw new Error("".concat(e,": '").concat(i,"' must be string[], but contains non-string items"))}}typesMatch(t,e){if(t==null)return e==null;if(Array.isArray(t)!==Array.isArray(e))return!1;if(Array.isArray(t)&&Array.isArray(e)){if(t.length===0||e.length===0)return!0;const n=typeof t[0];return e.every(i=>typeof i===n)}return typeof t=="object"&&typeof e=="object"?!0:typeof t==typeof e}getTypeDescription(t){if(t===null)return"null";if(Array.isArray(t)){if(t.length===0)return"array (empty)";const e=typeof t[0];return t.every(n=>typeof n===e)?"".concat(e,"[]"):"mixed[]"}return typeof t}loadSettings(){try{const t=localStorage.getItem(J.STORAGE_KEY);t?this.storedSettings=JSON.parse(t):this.storedSettings={},this.settings=Nt(this.defaultSettings,this.storedSettings)}catch(t){console.warn("Failed to load settings from localStorage:",t),this.storedSettings={},this.settings={...this.defaultSettings}}}saveSettings(){try{localStorage.setItem(J.STORAGE_KEY,JSON.stringify(this.storedSettings))}catch(t){console.warn("Failed to save settings to localStorage:",t)}}getSettings(){return{...this.settings}}updateSetting(t,e){e.ignoreDefault||e.custom&&e.custom.length>0?this.storedSettings[t]=e:delete this.storedSettings[t],this.settings=Nt(this.defaultSettings,this.storedSettings),this.saveSettings(),this.notifyChange()}getStoredSettings(){return{...this.storedSettings}}resetToDefaults(){this.storedSettings={},this.settings={...this.defaultSettings},localStorage.removeItem(J.STORAGE_KEY),this.notifyChange()}onChange(t){this.changeCallback=t}notifyChange(){this.changeCallback&&this.changeCallback(this.getSettings())}importSettings(t){try{const e=JSON.parse(t),n=this.defaultSettings,i=Object.keys(n),o=Object.keys(e);for(const s of o)if(!i.includes(s))throw new Error("Unknown setting: ".concat(s));return this.settings={...n,...e},this.saveSettings(),this.notifyChange(),!0}catch(e){return console.error("Failed to import settings:",e),!1}}getFunctionTrimPrefixes(){return this.parseRegexPrefixes(this.settings.functionTrimPrefixes)}getZipFilePatterns(){return this.parseRegexPrefixes(this.settings.zipFilePatterns)}getFileTrimPrefixes(){return this.parseRegexPrefixes(this.settings.fileTrimPrefixes)}getCategorySkipRules(){return this.settings.categorySkipRules.map(t=>t.trim()).filter(t=>t.length>0)}getCategoryRules(){const t=[],e=this.getCategorySkipRules();for(const i of e)t.push({skip:i});const n=this.settings.categoryMatchRules.map(i=>i.trim()).filter(i=>i.length>0);for(const i of n)if(i.startsWith("s|")){const o=i.match(/^s\|([^|]+)\|([^|]*)\|$/);if(o){const[,s]=o;t.push({match:s})}}else t.push({match:i});return t}parseRegexPrefixes(t){return!t||!Array.isArray(t)?[]:t.map(e=>e.trim()).filter(e=>e.length>0).map(e=>{try{const n=e.startsWith("^")?e:"^".concat(e);return new RegExp(n)}catch(n){console.warn('Invalid regex pattern "'.concat(e,'":'),n);const i=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp("^".concat(i))}})}parseTextRules(t,e){if(!t||!Array.isArray(t))return[];const n=t.map(o=>o.trim()).filter(o=>o.length>0),i=[];for(const o of n)if(o.startsWith("s|")){const s=o.match(/^s\|(.*)\|([^|]*)\|$/);if(s){const[,a,l]=s,r=a.split(","),u=r[0],d=r[1]||void 0;e==="fold"?i.push({fold:u,to:l,while:d}):e==="find"?i.push({find:u,to:l,while:d}):e==="trim"&&i.push({trim:o})}}else e==="skip"?i.push({skip:o}):e==="trim"&&i.push({trim:o});return i}getTitleManipulationRules(){const t=[];return t.push(...this.parseTextRules(this.settings.nameSkipRules,"skip")),t.push(...this.parseTextRules(this.settings.nameTrimRules,"trim")),t.push(...this.parseTextRules(this.settings.nameFoldRules,"fold")),t.push(...this.parseTextRules(this.settings.nameFindRules,"find")),t}getZipFilePatternRegex(){const t=this.settings.zipFilePatterns;return!t||!Array.isArray(t)||t.length===0?[/^(.*\/)?stacks\.txt$/]:t.map(e=>{try{return new RegExp(e)}catch(n){return console.warn('Invalid zip file pattern regex "'.concat(e,'":'),n),/^(.*\/)?stacks\.txt$/}})}getDefaults(){return{...this.defaultSettings}}};J.STORAGE_KEY="stackgazer-settings";let kt=J;function Ie(c){var t=0,e=c.children,n=e&&e.length;if(!n)t=1;else for(;--n>=0;)t+=e[n].value;c.value=t}function Fe(){return this.eachAfter(Ie)}function Be(c,t){let e=-1;for(const n of this)c.call(t,n,++e,this);return this}function Le(c,t){for(var e=this,n=[e],i,o,s=-1;e=n.pop();)if(c.call(t,e,++s,this),i=e.children)for(o=i.length-1;o>=0;--o)n.push(i[o]);return this}function Ne(c,t){for(var e=this,n=[e],i=[],o,s,a,l=-1;e=n.pop();)if(i.push(e),o=e.children)for(s=0,a=o.length;s<a;++s)n.push(o[s]);for(;e=i.pop();)c.call(t,e,++l,this);return this}function We(c,t){let e=-1;for(const n of this)if(c.call(t,n,++e,this))return n}function Ae(c){return this.eachAfter(function(t){for(var e=+c(t.data)||0,n=t.children,i=n&&n.length;--i>=0;)e+=n[i].value;t.value=e})}function Pe(c){return this.eachBefore(function(t){t.children&&t.children.sort(c)})}function De(c){for(var t=this,e=Re(t,c),n=[t];t!==e;)t=t.parent,n.push(t);for(var i=n.length;c!==e;)n.splice(i,0,c),c=c.parent;return n}function Re(c,t){if(c===t)return c;var e=c.ancestors(),n=t.ancestors(),i=null;for(c=e.pop(),t=n.pop();c===t;)i=c,c=e.pop(),t=n.pop();return i}function Ge(){for(var c=this,t=[c];c=c.parent;)t.push(c);return t}function _e(){return Array.from(this)}function ze(){var c=[];return this.eachBefore(function(t){t.children||c.push(t)}),c}function Ue(){var c=this,t=[];return c.each(function(e){e!==c&&t.push({source:e.parent,target:e})}),t}function*Oe(){var c=this,t,e=[c],n,i,o;do for(t=e.reverse(),e=[];c=t.pop();)if(yield c,n=c.children)for(i=0,o=n.length;i<o;++i)e.push(n[i]);while(e.length)}function xt(c,t){c instanceof Map?(c=[void 0,c],t===void 0&&(t=He)):t===void 0&&(t=Ve);for(var e=new rt(c),n,i=[e],o,s,a,l;n=i.pop();)if((s=t(n.data))&&(l=(s=Array.from(s)).length))for(n.children=s,a=l-1;a>=0;--a)i.push(o=s[a]=new rt(s[a])),o.parent=n,o.depth=n.depth+1;return e.eachBefore(Ye)}function qe(){return xt(this).eachBefore(Ze)}function Ve(c){return c.children}function He(c){return Array.isArray(c)?c[1]:null}function Ze(c){c.data.value!==void 0&&(c.value=c.data.value),c.data=c.data.data}function Ye(c){var t=0;do c.height=t;while((c=c.parent)&&c.height<++t)}function rt(c){this.data=c,this.depth=this.height=0,this.parent=null}rt.prototype=xt.prototype={constructor:rt,count:Fe,each:Be,eachAfter:Ne,eachBefore:Le,find:We,sum:Ae,sort:Pe,path:De,ancestors:Ge,descendants:_e,leaves:ze,links:Ue,copy:qe,[Symbol.iterator]:Oe};function Xe(c,t){return c.parent===t.parent?1:2}function gt(c){var t=c.children;return t?t[0]:c.t}function ft(c){var t=c.children;return t?t[t.length-1]:c.t}function Ke(c,t,e){var n=e/(t.i-c.i);t.c-=n,t.s+=e,c.c+=n,t.z+=e,t.m+=e}function $e(c){for(var t=0,e=0,n=c.children,i=n.length,o;--i>=0;)o=n[i],o.z+=t,o.m+=t,t+=o.s+(e+=o.c)}function je(c,t,e){return c.a.parent===t.parent?c.a:e}function dt(c,t){this._=c,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}dt.prototype=Object.create(rt.prototype);function Je(c){for(var t=new dt(c,0),e,n=[t],i,o,s,a;e=n.pop();)if(o=e._.children)for(e.children=new Array(a=o.length),s=a-1;s>=0;--s)n.push(i=e.children[s]=new dt(o[s],s)),i.parent=e;return(t.parent=new dt(null,0)).children=[t],t}function Qe(){var c=Xe,t=1,e=1,n=null;function i(r){var u=Je(r);if(u.eachAfter(o),u.parent.m=-u.z,u.eachBefore(s),n)r.eachBefore(l);else{var d=r,m=r,p=r;r.eachBefore(function(x){x.x<d.x&&(d=x),x.x>m.x&&(m=x),x.depth>p.depth&&(p=x)});var g=d===m?1:c(d,m)/2,f=g-d.x,w=t/(m.x+g+f),S=e/(p.depth||1);r.eachBefore(function(x){x.x=(x.x+f)*w,x.y=x.depth*S})}return r}function o(r){var u=r.children,d=r.parent.children,m=r.i?d[r.i-1]:null;if(u){$e(r);var p=(u[0].z+u[u.length-1].z)/2;m?(r.z=m.z+c(r._,m._),r.m=r.z-p):r.z=p}else m&&(r.z=m.z+c(r._,m._));r.parent.A=a(r,m,r.parent.A||d[0])}function s(r){r._.x=r.z+r.parent.m,r.m+=r.parent.m}function a(r,u,d){if(u){for(var m=r,p=r,g=u,f=m.parent.children[0],w=m.m,S=p.m,x=g.m,y=f.m,v;g=ft(g),m=gt(m),g&&m;)f=gt(f),p=ft(p),p.a=r,v=g.z+x-m.z-w+c(g._,m._),v>0&&(Ke(je(g,r,d),r,v),w+=v,S+=v),x+=g.m,w+=m.m,y+=f.m,S+=p.m;g&&!ft(p)&&(p.t=g,p.m+=x-S),m&&!gt(f)&&(f.t=m,f.m+=w-y,d=r)}return d}function l(r){r.x*=t,r.y=r.depth*e}return i.separation=function(r){return arguments.length?(c=r,i):c},i.size=function(r){return arguments.length?(n=!1,t=+r[0],e=+r[1],i):n?null:[t,e]},i.nodeSize=function(r){return arguments.length?(n=!0,t=+r[0],e=+r[1],i):n?[t,e]:null},i}class tn{constructor(t,e){this.filterInputValue="",this.stackDisplayMode="combined",this.filterDebounceTimer=null,this.loadingDelayTimer=null,this.currentTheme="dark",this.initialTheme=void 0,this.settingsManager=new kt(e),this.appState=new be;const n=this.settingsManager.getSettings(),i=this.convertToProfileCollectionSettings(n);this.profileCollection=new Xt(i),this.parser=new se({nameExtractionPatterns:i.nameExtractionPatterns}),window.debugProfileCollection=this.profileCollection,window.debugApp=this,this.settingsManager.onChange(o=>{this.onSettingsChanged(o)}),this.initializeTemplates(),this.init(t)}init(t){if(this.container=document.getElementById(t),!this.container)throw new Error('Container element with ID "'.concat(t,'" not found'));this.createAppStructure(),this.initializeUI(),this.initializeTheme(),this.loadUIState(),this.updateUnpinButtonVisibility(),this.createTooltip()}initializeTemplates(){this.templates=Bt}createAppStructure(){if(!this.container)throw new Error("Container not initialized. Call init() first.");const e=this.templates.container.content.cloneNode(!0).firstElementChild,i=this.templates.sidebar.content.cloneNode(!0).firstElementChild,s=this.templates.mainContent.content.cloneNode(!0).firstElementChild,l=this.templates.settingsModal.content.cloneNode(!0).firstElementChild,u=this.templates.loadingOverlay.content.cloneNode(!0).firstElementChild,d=e.querySelector("#sidebar"),m=e.querySelector("#mainContent");d&&m&&(d.replaceWith(i),m.replaceWith(s)),this.container.appendChild(e),this.container.appendChild(l),this.container.appendChild(u)}initializeUI(){this.clearUrlAnchor(),this.setupEventListeners(),this.updateDropZone(),this.setupNavigationHistory();const t=document.querySelector(".main-content");t&&t.classList.add("filtered")}loadUIState(){const t=localStorage.getItem("stacktrace-filter");if(t){this.filterInputValue=t;const n=document.getElementById("filterInput"),i=document.getElementById("narrowFilterInput");n&&(n.value=t),i&&(i.value=t),this.setFilter({filterString:t})}const e=localStorage.getItem("stacktrace-display-mode");if(e&&["combined","side-by-side","functions","locations"].includes(e)){this.stackDisplayMode=e;const n=document.getElementById("stackDisplayModeSelect"),i=document.getElementById("narrowStackDisplayModeSelect");n&&(n.value=e),i&&(i.value=e),this.updateStackDisplayMode(this.stackDisplayMode)}}saveUIState(){localStorage.setItem("stacktrace-filter",this.filterInputValue),localStorage.setItem("stacktrace-display-mode",this.stackDisplayMode)}openFileDialog(){const t=document.createElement("input");t.type="file",t.accept=".txt,.log",t.multiple=!0,t.onchange=e=>{const n=e.target.files;n&&n.length>0&&this.handleFiles(Array.from(n))},t.click()}setupEventListeners(){const t=document.getElementById("filterInput");t&&t.addEventListener("input",v=>{const b=v.target.value;this.filterInputValue=b,this.debouncedSetFilter(b),this.syncFilterInputs()});const e=document.getElementById("clearFilterBtn");e&&e.addEventListener("click",()=>{this.clearFilter()});const n=document.getElementById("clearAllBtn");n&&n.addEventListener("click",()=>{this.clearAllFiles()});const i=document.getElementById("expandAllBtn");i&&i.addEventListener("click",()=>{this.expandAllStacks()});const o=document.getElementById("collapseAllBtn");o&&o.addEventListener("click",()=>{this.collapseAllStacks()});const s=document.getElementById("unpinAllBtn");s&&s.addEventListener("click",()=>{this.unpinAllItems()});const a=document.getElementById("addFileBtn");a&&a.addEventListener("click",()=>{this.openFileDialog()});const l=document.getElementById("stackDisplayModeSelect");l&&l.addEventListener("change",v=>{const b=v.target.value;this.stackDisplayMode=b,this.updateStackDisplayMode(b),this.saveUIState();const k=document.getElementById("narrowStackDisplayModeSelect");k&&(k.value=b)});const r=document.getElementById("themeToggleBtn");r&&r.addEventListener("click",()=>{this.toggleTheme()}),window.addEventListener("dragover",v=>{v.preventDefault(),v.stopPropagation()}),window.addEventListener("drop",v=>{v.preventDefault(),v.stopPropagation();const b=v.dataTransfer?.files;b&&b.length>0&&this.handleFiles(Array.from(b))}),window.addEventListener("paste",v=>{v.target.matches('input, textarea, [contenteditable="true"]')||(v.preventDefault(),this.handleClipboardPaste(v))});const u=document.getElementById("backBtn");u&&u.addEventListener("click",()=>{this.navigateBack()}),window.addEventListener("keydown",v=>{(v.altKey&&v.key==="ArrowLeft"||v.key==="Backspace"&&!v.target.matches('input, textarea, [contenteditable="true"]'))&&(v.preventDefault(),this.navigateBack())});const d=document.getElementById("narrowMenuBtn");d&&d.addEventListener("click",()=>{this.toggleNarrowSidebar()});const m=document.getElementById("sidebarOverlay");m&&m.addEventListener("click",()=>{this.closeNarrowSidebar()});const p=document.getElementById("narrowCloseBtn");p&&p.addEventListener("click",()=>{this.closeNarrowSidebar()});const g=document.getElementById("narrowFilterInput");g&&g.addEventListener("input",v=>{const b=v.target.value;this.filterInputValue=b,this.debouncedSetFilter(b),this.syncFilterInputs()});const f=document.getElementById("narrowExpandAllBtn");f&&f.addEventListener("click",()=>{this.expandAllStacks()});const w=document.getElementById("narrowCollapseAllBtn");w&&w.addEventListener("click",()=>{this.collapseAllStacks()});const S=document.getElementById("narrowUnpinAllBtn");S&&S.addEventListener("click",()=>{this.unpinAllItems()});const x=document.getElementById("narrowBackBtn");x&&x.addEventListener("click",()=>{this.navigateBack()});const y=document.getElementById("narrowStackDisplayModeSelect");y&&y.addEventListener("change",v=>{const b=v.target.value;this.stackDisplayMode=b,this.updateStackDisplayMode(b),this.saveUIState();const k=document.getElementById("stackDisplayModeSelect");k&&(k.value=b)}),window.addEventListener("resize",()=>{this.handleResizeForNarrowMode()}),this.setupSettingsModal()}handleCopyButtonClick(t){t.stopPropagation();const e=t.currentTarget,n=e.dataset.stackId,i=e.dataset.categoryId;if(!n||!i)return;const s=this.profileCollection.getCategories().find(l=>l.id===i);if(!s)return;const a=s.stacks.find(l=>l.id===n);a&&this.copyStackToClipboard(a,s)}handlePinButtonClick(t){t.stopPropagation();const e=t.currentTarget,n=e.closest("[data-pin-type]");if(!n)return;const i=n.dataset.pinType,o=n.dataset.pinId;if(!i||!o)return;let s=!1;switch(i){case"category":s=this.profileCollection.toggleCategoryPin(o);break;case"stack":s=this.profileCollection.toggleStackPin(o);break;case"group":s=this.profileCollection.toggleGroupPin(o);break;case"goroutine":s=this.profileCollection.toggleGoroutinePin(o);break;default:return}n.classList.toggle("pinned",s),e.classList.toggle("pinned",s),this.setFilter(this.buildCurrentFilter()),this.updateVisibility(),this.updateStats()}handlePinButtonDoubleClick(t){t.stopPropagation();const n=t.currentTarget.closest("[data-pin-type]");if(!n)return;const i=n.dataset.pinType,o=n.dataset.pinId;if(!(!i||!o)){switch(i){case"category":this.profileCollection.toggleCategoryPinWithChildren(o),this.refreshPinStates();break;case"stack":this.profileCollection.toggleStackPinWithChildren(o),this.refreshPinStates();break;case"group":this.profileCollection.toggleGroupPinWithChildren(o),this.refreshPinStates();break}this.setFilter(this.buildCurrentFilter()),this.updateVisibility(),this.updateStats()}}handleNavigationClick(t){t.preventDefault(),t.stopPropagation();const e=t.currentTarget,n=e.dataset.targetId,i=e.dataset.sourceId;n&&i&&this.navigateToGoroutine(n,i)}handleShowAllCreatedClick(t){t.preventDefault(),t.stopPropagation();const e=t.currentTarget,n=e.dataset.creatorId,i=e.dataset.secondLineId;if(n&&i){const o=this.profileCollection.getGoroutineByID(n);if(o){const s=document.getElementById(i);s&&this.showAllCreatedGoroutines(n,o.created,s)}}}handleTooltipMouseEnter(t){const n=t.currentTarget.dataset.tooltipGoroutineId;n&&this.showGoroutinePreviewTooltip(n,t)}handleTooltipMouseLeave(){this.hideTooltip()}handleTooltipMouseMove(t){this.tooltip.style.left="".concat(t.pageX-20,"px"),this.tooltip.style.top="".concat(t.pageY+10,"px")}handleShowMoreClick(t){t.stopPropagation();const e=t.currentTarget,n=e.dataset.groupId;if(!n)return;const i=e.parentElement;if(!i)return;const o=this.findGroupById(n);if(!o)return;const s=new Set(Array.from(i.querySelectorAll(".goroutine-entry")).map(a=>a.id.replace("goroutine-","")));o.goroutines.forEach(a=>{if(!s.has(a.id)){const l=this.createGoroutineElement(a);i.appendChild(l)}}),e.remove(),this.setFilter(this.buildCurrentFilter())}findGroupById(t){const e=this.profileCollection.getCategories();for(const n of e)for(const i of n.stacks)for(const o of i.files)for(const s of o.groups)if(s.id===t)return s;return null}handleFileRenameClick(t){t.stopPropagation();const e=t.currentTarget,n=e.dataset.fileName;n&&this.startFileRename(e,n)}handleFileRemoveClick(t){t.stopPropagation();const n=t.currentTarget.dataset.fileName;n&&(this.profileCollection.removeFile(n),this.render())}handleChainIconClick(t){t.stopPropagation();const n=t.currentTarget.dataset.goroutineId;n&&this.showAncestryTree(n)}toggleNarrowSidebar(){const t=document.querySelector(".sidebar"),e=document.getElementById("sidebarOverlay"),n=document.getElementById("narrowMenuBtn"),i=document.getElementById("narrowCloseBtn");t&&e&&n&&(t.classList.contains("narrow-open")?this.closeNarrowSidebar():(t.classList.add("narrow-open"),e.classList.add("active"),n.classList.add("active"),i&&i.classList.add("visible")))}closeNarrowSidebar(){const t=document.querySelector(".sidebar"),e=document.getElementById("sidebarOverlay"),n=document.getElementById("narrowMenuBtn"),i=document.getElementById("narrowCloseBtn");t&&e&&n&&(t.classList.remove("narrow-open"),e.classList.remove("active"),n.classList.remove("active"),i&&i.classList.remove("visible"))}handleResizeForNarrowMode(){window.innerWidth>900&&this.closeNarrowSidebar(),this.syncFilterInputs()}syncFilterInputs(){const t=document.getElementById("filterInput"),e=document.getElementById("narrowFilterInput");t&&e&&(t.value=this.filterInputValue,e.value=this.filterInputValue)}async handleClipboardPaste(t){const e=t.clipboardData;if(!e)return;const n=e.files;if(n&&n.length>0){await this.handleFiles(Array.from(n));return}const i=e.getData("text/plain");if(i&&i.trim()){const o=new Blob([i],{type:"text/plain"}),s=new File([o],"clipboard-paste.txt",{type:"text/plain"});await this.handleFiles([s])}}async handleFiles(t){const e=t.length,n=t.map(i=>i.name).join(", ");this.showLoadingOverlay(e===1?"Processing file...":"Processing ".concat(e," files..."),e===1?t[0].name:n);try{for(let i=0;i<t.length;i++){const o=t[i];if(e>1&&this.updateLoadingMessage("Processing file ".concat(i+1," of ").concat(e,"..."),o.name),o.name.toLowerCase().endsWith(".zip")||o.type==="application/zip")await this.handleZipFile(o);else{console.time("📄 File Import: ".concat(o.name));const s=await this.parser.parseFile(o);if(s.success)this.profileCollection.addFile(s.data),console.timeEnd("📄 File Import: ".concat(o.name));else{console.timeEnd("📄 File Import: ".concat(o.name)),console.error("Failed to parse ".concat(o.name,":"),s.error),this.hideLoadingOverlay(),alert("Failed to parse ".concat(o.name,": ").concat(s.error));return}}}this.updateLoadingMessage("Rendering results...","Organizing data and applying filters"),this.render(),this.setFilter(this.buildCurrentFilter()),this.hideLoadingOverlay()}catch(i){console.error("Error handling files:",i),this.hideLoadingOverlay(),alert("Error handling files: ".concat(i))}}async handleZipFile(t){try{console.time("🗜 Zip Import: ".concat(t.name)),this.updateLoadingMessage("Extracting ZIP file...","Reading ".concat(t.name));const e=this.settingsManager.getZipFilePatternRegex(),n=await Ft.extractFiles(t,e);if(n.files.length===0)throw console.warn("No stack trace files found in zip matching pattern: ".concat(e)),new Error("No stack trace files found in zip file. Looking for files matching: ".concat(e));for(let i=0;i<n.files.length;i++){const o=n.files[i],s=o.path.split("/").pop()||o.path;n.files.length>1?this.updateLoadingMessage("Processing ZIP entry ".concat(i+1," of ").concat(n.files.length,"..."),s):this.updateLoadingMessage("Processing ZIP entry...",s),console.time("  📄 Zip Entry: ".concat(s));const a=await this.parser.parseFile(o.content,s);if(a.success)this.profileCollection.addFile(a.data),console.timeEnd("  📄 Zip Entry: ".concat(s));else throw console.timeEnd("  📄 Zip Entry: ".concat(s)),console.error("Failed to parse ".concat(s," from zip:"),a.error),new Error("Failed to parse ".concat(s," from zip: ").concat(a.error))}console.timeEnd("🗜 Zip Import: ".concat(t.name))}catch(e){throw console.timeEnd("🗜 Zip Import: ".concat(t.name)),console.error("Error processing zip file ".concat(t.name,":"),e),e}}debouncedSetFilter(t){this.filterDebounceTimer!==null&&clearTimeout(this.filterDebounceTimer);const e=this.parseFilterString(t);this.showFilterError(e.error),e.error||(this.filterDebounceTimer=window.setTimeout(()=>{const n=this.parseFilterString(this.filterInputValue);n.error||this.setFilter({filterString:n.filterString,minWait:n.minWait,maxWait:n.maxWait}),this.saveUIState(),this.filterDebounceTimer=null},300))}showFilterError(t){const e=document.getElementById("filterInput"),n=document.getElementById("filterError");t?(e.classList.add("error"),n.textContent=t,n.style.display="block"):(e.classList.remove("error"),n.style.display="none")}setFilter(t){this.profileCollection.setFilter(t),this.updateVisibility(),this.updateStats()}parseWaitValue(t){if(!/^\d*\.?\d+$/.test(t.trim()))return null;const e=parseFloat(t);return isNaN(e)?null:e}parseFilterString(t){const e=t.split(" ").map(r=>r.trim()).filter(r=>r.length>0),n=[];let i,o,s=!1,a=!1,l=!1;for(const r of e)if(r.startsWith("wait:")){const u=r.substring(5);if(u.startsWith(">")){if(s)return{filterString:"",error:"Multiple minimum wait constraints not allowed (e.g., wait:>5 wait:>10)"};if(l)return{filterString:"",error:"Exact wait time cannot be combined with other wait constraints"};const d=this.parseWaitValue(u.substring(1));if(d===null)return{filterString:"",error:"Invalid wait filter: ".concat(r)};i=d+1,s=!0}else if(u.startsWith("<")){if(a)return{filterString:"",error:"Multiple maximum wait constraints not allowed (e.g., wait:<5 wait:<10)"};if(l)return{filterString:"",error:"Exact wait time cannot be combined with other wait constraints"};const d=this.parseWaitValue(u.substring(1));if(d===null)return{filterString:"",error:"Invalid wait filter: ".concat(r)};o=d-1,a=!0}else if(u.endsWith("+")){if(s)return{filterString:"",error:"Multiple minimum wait constraints not allowed (e.g., wait:5+ wait:>10)"};if(l)return{filterString:"",error:"Exact wait time cannot be combined with other wait constraints"};const d=this.parseWaitValue(u.slice(0,-1));if(d===null)return{filterString:"",error:"Invalid wait filter: ".concat(r)};i=d,s=!0}else if(u.includes("-")){if(s||a)return{filterString:"",error:"Range wait constraint cannot be combined with other wait constraints"};if(l)return{filterString:"",error:"Exact wait time cannot be combined with other wait constraints"};const d=u.split("-");if(d.length!==2)return{filterString:"",error:"Invalid range format: ".concat(r," (use wait:min-max)")};const m=this.parseWaitValue(d[0]),p=this.parseWaitValue(d[1]);if(m===null||p===null)return{filterString:"",error:"Invalid wait filter: ".concat(r)};if(m>p)return{filterString:"",error:"Invalid range: minimum (".concat(m,") cannot be greater than maximum (").concat(p,")")};i=m,o=p,s=!0,a=!0}else{if(l)return{filterString:"",error:"Multiple exact wait constraints not allowed (e.g., wait:5 wait:10)"};if(s||a)return{filterString:"",error:"Exact wait time cannot be combined with other wait constraints"};const d=this.parseWaitValue(u);if(d===null)return{filterString:"",error:"Invalid wait filter: ".concat(r)};i=d,o=d,l=!0}}else n.push(r);return n.length>1?{filterString:"",error:"Only one search term allowed (plus wait: filters)"}:i!==void 0&&i<0?{filterString:"",error:"Minimum wait time cannot be negative"}:o!==void 0&&o<0?{filterString:"",error:"Maximum wait time cannot be negative"}:i!==void 0&&o!==void 0&&i>o?{filterString:"",error:"Minimum wait time cannot be greater than maximum"}:{filterString:n.join(" "),minWait:i,maxWait:o}}buildCurrentFilter(t={}){const e=this.parseFilterString(this.filterInputValue);return{filterString:e.filterString,minWait:e.minWait,maxWait:e.maxWait,...t}}clearFilter(){this.filterDebounceTimer!==null&&(clearTimeout(this.filterDebounceTimer),this.filterDebounceTimer=null),this.filterInputValue="",this.syncFilterInputs(),this.showFilterError(),this.profileCollection.clearFilter(),this.updateVisibility(),this.updateStats(),this.saveUIState()}clearAllFiles(){this.profileCollection.clear(),this.updateDropZone(),this.renderFiles(),this.updateStats(),this.saveUIState()}initializeTheme(){const t=localStorage.getItem("stackgazer-theme");this.currentTheme=t||this.initialTheme||"dark",this.applyTheme(this.currentTheme)}toggleTheme(){this.currentTheme=this.currentTheme==="dark"?"light":"dark",this.applyTheme(this.currentTheme),localStorage.setItem("stackgazer-theme",this.currentTheme)}applyTheme(t){const e=document.body,n=document.getElementById("themeToggleBtn");t==="light"?(e.setAttribute("data-theme","light"),n&&(n.textContent="☀️",n.title="Switch to dark theme")):(e.removeAttribute("data-theme"),n&&(n.textContent="🌙",n.title="Switch to light theme"))}expandAllStacks(){const t=document.querySelectorAll(".category-section");Array.from(t).some(n=>n.classList.contains("container-collapsed"))?t.forEach(n=>{const i=n.querySelector(".section-content");i&&(i.style.display=""),n.classList.remove("container-collapsed")}):document.querySelectorAll(".stack-section").forEach(i=>{const o=i.querySelector(".section-content");o&&(o.style.display=""),i.classList.remove("container-collapsed")})}collapseAllStacks(){const t=document.querySelectorAll(".stack-section");Array.from(t).some(n=>!n.classList.contains("container-collapsed"))?t.forEach(n=>{const i=n.querySelector(".section-content");i&&(i.style.display="none"),n.classList.add("container-collapsed")}):document.querySelectorAll(".category-section").forEach(i=>{const o=i.querySelector(".section-content");o&&(o.style.display="none"),i.classList.add("container-collapsed")})}toggleContainerCollapse(t){if(t.classList.contains("category-section")||t.classList.contains("stack-section"))if(t.classList.contains("container-collapsed")){t.classList.remove("container-collapsed");const i=t.querySelector(".section-content");i&&(i.style.display="")}else{t.classList.add("container-collapsed");const i=t.querySelector(".section-content");i&&(i.style.display="none")}else t.classList.toggle("section-collapsed")}updateVisibility(t=!1){const e=this.profileCollection.getCategories();let n=!1;for(const i of e){for(const o of i.stacks){for(const s of o.files){for(const a of s.groups)if(a.counts.visibilityChanged){n=!0;break}if(n)break}if(n)break}if(n)break}if(n)for(const i of e){for(const o of i.stacks){for(const s of o.files)s.counts.visibilityChanged=s.groups.reduce((a,l)=>a||l.counts.visibilityChanged,!1);o.counts.visibilityChanged=o.files.reduce((s,a)=>s||a.counts.visibilityChanged,!1)}i.counts.visibilityChanged=i.stacks.reduce((o,s)=>o||s.counts.visibilityChanged,!1)}for(const i of e){if(!t&&!i.counts.visibilityChanged)continue;const o=document.getElementById(i.id);if(o)if(i.counts.matches==0)o.classList.add("filtered");else{o.classList.remove("filtered"),this.updateDisplayedCount(o,i.counts);for(const s of i.stacks){if(!t&&!s.counts.visibilityChanged)continue;const a=document.getElementById(s.id);if(a)if(s.counts.matches==0)a.classList.add("filtered");else{a.classList.remove("filtered"),this.updateDisplayedCount(a,s.counts);for(const l of s.files){if(!t&&!l.counts.visibilityChanged)continue;const r=document.getElementById(l.id);if(r)if(l.counts.matches===0)r.classList.add("filtered");else{r.classList.remove("filtered"),this.updateDisplayedCount(r,l.counts);for(const u of l.groups){if(!t&&!u.counts.visibilityChanged)continue;const d=document.getElementById(u.id);if(d){if(u.counts.matches===0)d.classList.add("filtered");else{d.classList.remove("filtered"),this.updateDisplayedCount(d,u.counts);for(const m of u.goroutines){const p=document.getElementById("goroutine-".concat(m.id));p&&p.classList.toggle("filtered",!m.matches)}}u.counts.visibilityChanged=!1}}l.counts.visibilityChanged=!1}}s.counts.visibilityChanged=!1}}i.counts.visibilityChanged=!1}}}updateDisplayedCount(t,e){const n=t.querySelector(".counts");n&&(e.total===e.filterMatches?n.textContent="".concat(e.total," goroutines"):n.textContent="".concat(e.filterMatches," (of ").concat(e.total,") goroutines"))}render(){this.renderFiles(),this.renderStacks(),this.updateDropZone(),this.profileCollection.setFilter(this.buildCurrentFilter()),this.updateVisibility(!0),this.updateStats()}addExpandCollapseHandler(t){const e=t.querySelector(".header");e&&(e.addEventListener("mousedown",this.handleHeaderMouseDown.bind(this)),e.addEventListener("mouseup",this.handleHeaderMouseUp.bind(this)))}handleHeaderMouseDown(t){const e=t.currentTarget,n=window.getSelection();e.__selectionAtMouseDown=n?n.toString():""}handleHeaderMouseUp(t){const e=t.currentTarget,n=e.closest(".section");if(!n)return;const i=t.target;if(i.tagName==="BUTTON"||i.closest("button"))return;const o=window.getSelection(),s=o?o.toString():"";if((e.__selectionAtMouseDown||"")!==s)return;t.stopPropagation(),t.preventDefault();const l=!n.classList.contains("container-collapsed")||n.classList.contains("section-collapsed");if(this.toggleContainerCollapse(n),l&&e.getBoundingClientRect().top<0&&(e.scrollIntoView({behavior:"instant",block:"start"}),n.classList.contains("stack-section"))){const u=n.closest(".category-section"),d=u?u.querySelector(".header"):null;if(d){const m=d.clientHeight,p=e.style.scrollMarginTop;e.style.scrollMarginTop="".concat(m-2,"px"),e.scrollIntoView({behavior:"instant",block:"start"}),e.style.scrollMarginTop=p}}}renderFiles(){const t=document.getElementById("fileList"),e=document.getElementById("fileListContainer");if(!t)return;const n=this.profileCollection.getFileNames();if(t.textContent="",n.length===0){const l=this.templates.fileEmptyState.content.cloneNode(!0).firstElementChild;l.classList.add("cursor-pointer"),l.addEventListener("click",()=>{this.openFileDialog()}),t.appendChild(l),e&&e.classList.add("has-files");return}e&&e.classList.add("has-files");const i=this.getFileStatistics();n.forEach(a=>{const r=this.templates.fileItem.content.cloneNode(!0).firstElementChild;r.dataset.fileName=a;const u=r.querySelector(".file-name-text");u.textContent=a,u.dataset.fileName=a,u.addEventListener("click",this.handleFileRenameClick.bind(this));const d=i.get(a)||{visible:0,total:0},m=r.querySelector(".file-stats");m.textContent="".concat(d.visible," / ").concat(d.total," goroutines");const p=r.querySelector(".file-remove-btn");p.dataset.fileName=a,p.addEventListener("click",this.handleFileRemoveClick.bind(this)),t.appendChild(r)});const s=this.templates.fileDropArea.content.cloneNode(!0).firstElementChild;t.appendChild(s)}renderStacks(){const t=document.getElementById("dropZone");if(!t)return;const e=this.profileCollection.getCategories();if(e.length===0){this.updateDropZone();return}t.className="drop-zone has-content";const n=document.createElement("div");n.className="stack-display",n.id="stackDisplay",e.forEach(i=>{const o=this.createCategoryElement(i);n.appendChild(o)}),t.textContent="",t.appendChild(n)}createCategoryElement(t){const n=this.templates.category.content.cloneNode(!0).firstElementChild;n.id=t.id,n.dataset.pinType="category",n.dataset.pinId=t.id;const i=n.querySelector(".category-title");i.textContent=t.name;const o=n.querySelector(".pin-button");o.title="Pin/unpin this category",o.addEventListener("click",this.handlePinButtonClick.bind(this)),o.addEventListener("dblclick",this.handlePinButtonDoubleClick.bind(this)),this.updateDisplayedCount(n,t.counts);const s=n.querySelector(".category-content");for(const a of t.stacks){const l=this.createStackElement(a,t);s.appendChild(l)}return this.addExpandCollapseHandler(n),n}createStackElement(t,e){const i=this.templates.stack.content.cloneNode(!0).firstElementChild;i.id=t.id,i.dataset.pinType="stack",i.dataset.pinId=t.id;const o=i.querySelector(".stack-title");o.textContent=t.name;const s=i.querySelector(".pin-button");s.title="Pin/unpin this stack",s.addEventListener("click",this.handlePinButtonClick.bind(this)),s.addEventListener("dblclick",this.handlePinButtonDoubleClick.bind(this));const a=i.querySelector(".copy-button");a.title="Copy stack name and trace to clipboard",a.dataset.stackId=t.id,a.dataset.categoryId=e.id,a.addEventListener("click",this.handleCopyButtonClick.bind(this)),this.updateDisplayedCount(i,t.counts);const l=i.querySelector(".stack-content"),r=this.createTraceElement(t.trace);l.appendChild(r);const u=t.files;for(const d of u){const m=this.createFileSection(d.id,d.fileName,d.groups);l.appendChild(m)}return this.addExpandCollapseHandler(i),i}createFileSection(t,e,n){const o=this.templates.fileSection.content.cloneNode(!0).firstElementChild;o.id=t,n.length===1&&o.classList.add("single-group");const s=o.querySelector(".file-name");s.textContent=e;const a=o.querySelector(".section-content");return n.forEach(l=>{const r=this.createGroupSection(l.id,l,e);a.appendChild(r)}),this.addExpandCollapseHandler(o),o}createGroupSection(t,e,n){const o=this.templates.group.content.cloneNode(!0).firstElementChild;o.id=t,o.dataset.pinType="group",o.dataset.pinId=e.id;const s=o.querySelector(".expand-icon");e.goroutines.length===0&&s.remove();const a=o.querySelector(".group-header-label");if(n){const p=e.labels.length>0?" [".concat(e.labels.join(", "),"]"):"";a.textContent="".concat(n).concat(p)}else e.labels.length>0?a.textContent="[".concat(e.labels.join(", "),"]"):a.textContent="Goroutines";const l=o.querySelector(".pin-button");l.title="Pin/unpin this group",l.addEventListener("click",this.handlePinButtonClick.bind(this)),l.addEventListener("dblclick",this.handlePinButtonDoubleClick.bind(this)),e.goroutines.length>0&&this.addExpandCollapseHandler(o);const r=o.querySelector(".section-content"),u=4,d=e.goroutines.slice(0,u),m=e.goroutines.slice(u);if(d.forEach(p=>{const g=this.createGoroutineElement(p);r.appendChild(g)}),m.length>0){const g=this.templates.showMore.content.cloneNode(!0).firstElementChild,f=g.querySelector(".show-more-link-clickable");f.textContent=m.length.toString(),g.dataset.groupId=e.id,g.addEventListener("click",this.handleShowMoreClick.bind(this)),r.appendChild(g)}return o}createTraceElement(t){const n=this.templates.stackTrace.content.cloneNode(!0).firstElementChild;return n.setAttribute("data-display-mode",this.stackDisplayMode),n.__traceData=t,this.updateTraceElementContent(n,t),n}updateTraceElementContent(t,e){const n=t.getAttribute("data-display-mode")||"combined";let i="";switch(n){case"combined":i=this.formatStackCombined(e);break;case"side-by-side":i=this.formatStackSideBySide(e);break;case"functions":i=this.formatStackFunctions(e);break;case"locations":i=this.formatStackLocations(e);break;default:i=this.formatStackCombined(e)}t.innerHTML=i}createGoroutineElement(t){const n=this.templates.goroutine.content.cloneNode(!0).firstElementChild;n.id="goroutine-".concat(t.id),n.dataset.pinType="goroutine",n.dataset.pinId=t.id;const i=n.querySelector(".pin-button");i.title="Pin/unpin this goroutine",i.addEventListener("click",this.handlePinButtonClick.bind(this));const o=t.waitMinutes>0?" (".concat(t.waitMinutes," minutes)"):"",s=n.querySelector(".goroutine-header-left");if(s.textContent="".concat(t.id).concat(o,":"),t.creator&&t.creator!==t.id||t.created.length>0){const u=document.createElement("span");u.className="chain-icon",u.textContent="🕸️",u.style.marginLeft="0.5em",u.style.cursor="pointer",u.title="View ancestry tree",u.dataset.goroutineId=t.id,u.addEventListener("click",this.handleChainIconClick.bind(this)),s.appendChild(u)}const l=n.querySelector(".goroutine-created-by");if(t.creator&&t.creator!==t.id)if(l.textContent="created by ",t.creatorExists){const u=document.createElement("span");u.className="creator-link",u.textContent=t.creator,u.dataset.targetId=t.creator,u.dataset.sourceId=t.id,u.addEventListener("click",this.handleNavigationClick.bind(this)),this.addTooltipToLink(u,t.creator),l.appendChild(u)}else{const u=document.createElement("span");u.className="creator-missing",u.textContent=t.creator,l.appendChild(u)}else l.remove();const r=n.querySelector(".goroutine-header-second-line");if(t.created.length>0){const u="second-line-".concat(t.id);r.id=u;const d=document.createElement("span");d.className="created-goroutines-label",d.textContent="created ".concat(t.created.length," goroutine").concat(t.created.length>1?"s":"",": "),r.appendChild(d);const m=5;if(t.created.slice(0,m).forEach((g,f)=>{if(f>0){const S=document.createElement("span");S.textContent=", ",r.appendChild(S)}const w=document.createElement("span");w.className="creator-link",w.textContent=g,w.dataset.targetId=g,w.dataset.sourceId=t.id,w.addEventListener("click",this.handleNavigationClick.bind(this)),this.addTooltipToLink(w,g),r.appendChild(w)}),t.created.length>m){const g=document.createElement("span");g.textContent=" and ";const f=document.createElement("span");f.textContent="".concat(t.created.length-m," more"),f.className="created-goroutines-more creator-link",f.classList.add("cursor-pointer"),f.dataset.creatorId=t.id,f.dataset.secondLineId=u,f.addEventListener("click",this.handleShowAllCreatedClick.bind(this)),r.appendChild(g),r.appendChild(f)}}else r.remove();return n}updateDropZone(){const t=document.getElementById("dropZone");if(!t)return;if(this.profileCollection.getCategories().length===0){t.classList.remove("has-content"),t.textContent="";const n=Bt.dropZoneEmpty.content.cloneNode(!0);t.appendChild(n),this.setupDemoButtons()}}updateStats(){const t=this.profileCollection.getStackStatistics(),e=document.getElementById("stackCounts"),n=document.getElementById("goroutineCounts");if(e){let i=0;this.profileCollection.getCategories().forEach(o=>{for(const s of o.stacks)s.counts.pinned>0&&i++}),i>0?e.textContent="".concat(t.visible," (").concat(i,"📌) / ").concat(t.total):e.textContent="".concat(t.visible," / ").concat(t.total)}n&&(t.pinnedGoroutines>0?n.textContent="".concat(t.visibleGoroutines," (").concat(t.pinnedGoroutines,"📌) / ").concat(t.totalGoroutines):n.textContent="".concat(t.visibleGoroutines," / ").concat(t.totalGoroutines)),this.updateStateStats(),this.updateSidebarStateStats(),this.updateFileStats(),this.updateUnpinButtonVisibility()}updateStateStats(){const t=this.profileCollection.getCategories();for(const e of t){this.updateCategoryStateStats(e);for(const n of e.stacks)this.updateStackStateStats(n)}}updateCategoryStateStats(t){const e=document.getElementById(t.id);if(!e)return;const n=e.querySelector(".category-stats");if(!n)return;const i=Array.from(t.counts.matchingStates.entries()),o=pt(i);if(o.length===0){n.textContent="";return}const s=o.map(([l,r])=>"".concat(r," ").concat(l)),a=this.formatWaitTime(t.counts.minMatchingWait,t.counts.maxMatchingWait);n.textContent=a?"".concat(s.join(", ")," • ").concat(a):s.join(", ")}updateStackStateStats(t){const e=document.getElementById(t.id);if(!e)return;const n=e.querySelector(".stack-stats");if(!n)return;const i=Array.from(t.counts.matchingStates.entries()),o=pt(i);if(o.length===0){n.textContent="";return}const s=o.map(([l,r])=>"".concat(r," ").concat(l)),a=this.formatWaitTime(t.counts.minMatchingWait,t.counts.maxMatchingWait);n.textContent=a?"".concat(s.join(", ")," • ").concat(a):s.join(", ")}formatWaitTime(t,e){return!isFinite(t)||!isFinite(e)||t===0&&e===0?"":t===e?"".concat(t,"mins"):"".concat(t,"-").concat(e,"mins")}updateSidebarStateStats(){const t=document.getElementById("stateStats");if(!t)return;const e=this.profileCollection.getStateStatistics();if(e.size===0){t.textContent="";return}const n=Array.from(e.entries()),i=pt(n);t.textContent="";const o=Ee(i);t.appendChild(o)}refreshPinStates(){const t=this.profileCollection.getCategories();for(const e of t){const n=document.getElementById(e.id),i=n?.querySelector(".pin-button");n&&i&&(n.classList.toggle("pinned",e.pinned),i.classList.toggle("pinned",e.pinned));for(const o of e.stacks){const s=document.getElementById(o.id),a=s?.querySelector(".pin-button");s&&a&&(s.classList.toggle("pinned",o.pinned),a.classList.toggle("pinned",o.pinned));for(const l of o.files)for(const r of l.groups){const u=document.getElementById(r.id),d=u?.querySelector(".pin-button");u&&d&&(u.classList.toggle("pinned",r.pinned),d.classList.toggle("pinned",r.pinned));for(const m of r.goroutines){const p=document.getElementById("goroutine-".concat(m.id)),g=p?.querySelector(".pin-button");p&&g&&(p.classList.toggle("pinned",m.pinned),g.classList.toggle("pinned",m.pinned))}}}}}updateFileStats(){const t=this.getFileStatistics();document.querySelectorAll(".file-item").forEach(n=>{const i=n.dataset.fileName;if(i){const o=n.querySelector(".file-stats");if(o){const s=t.get(i)||{visible:0,total:0};o.textContent="".concat(s.visible," / ").concat(s.total," goroutines")}}})}getFileStatistics(){return this.profileCollection.getFileStatistics()}updateUnpinButtonVisibility(){const t=document.getElementById("unpinAllBtn"),e=document.getElementById("narrowUnpinAllBtn"),n=this.profileCollection.hasAnyPinnedItems();t&&t.classList.toggle("hidden",!n),e&&e.classList.toggle("hidden",!n)}unpinAllItems(){this.profileCollection.unpinAllItems(),document.querySelectorAll(".pinned").forEach(t=>{t.classList.remove("pinned")}),this.setFilter({filterString:this.filterInputValue}),this.updateVisibility(),this.updateStats()}updateStackDisplayMode(t){document.querySelectorAll(".unique-stack-content").forEach(e=>{e.setAttribute("data-display-mode",t);const n=e.__traceData;n&&this.updateTraceElementContent(e,n)})}formatStackCombined(t){let e="";for(const n of t)e+='<div class="stack-line">',e+='<span class="function-name">'.concat(this.escapeHtml(n.func),"</span>"),e+="</div>",e+='<div class="stack-line">	<span class="file-path">'.concat(this.escapeHtml(n.file),'</span>:<span class="line-number">').concat(n.line,"</span></div>");return e}formatStackSideBySide(t){let e='<div class="side-by-side-container">';e+='<div class="side-by-side-headers">',e+='<div class="column-header">Functions</div>',e+='<div class="column-header">Locations</div>',e+="</div>";for(const n of t)e+='<div class="side-by-side-row">',e+='<div class="function-side">',e+='<span class="function-name">'.concat(this.escapeHtml(n.func),"</span>"),e+="</div>",e+='<div class="location-side">',e+='<span class="file-path">'.concat(this.escapeHtml(n.file),'</span>:<span class="line-number">').concat(n.line,"</span>"),e+="</div>",e+="</div>";return e+="</div>",e}formatStackFunctions(t){let e="";for(const n of t)e+='<div class="stack-line">',e+='<span class="function-name">'.concat(this.escapeHtml(n.func),"</span>"),e+="</div>";return e}formatStackLocations(t){let e="";for(const n of t)e+='<div class="stack-line">',e+='<span class="file-path">'.concat(this.escapeHtml(n.file),'</span>:<span class="line-number">').concat(n.line,"</span>"),e+="</div>";return e}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}startFileRename(t,e){if(t.getAttribute("contenteditable")==="true")return;const n=t.textContent||"";t.setAttribute("contenteditable","true"),t.classList.add("editing"),t.setAttribute("title","Press Enter to save, Escape to cancel"),t.focus();const i=document.createRange();i.selectNodeContents(t);const o=window.getSelection();o&&(o.removeAllRanges(),o.addRange(i));const s=()=>{const r=t.textContent?.trim()||"";if(t.setAttribute("contenteditable","false"),t.classList.remove("editing"),t.removeAttribute("title"),r&&r!==n){if(this.profileCollection.getFileNames().filter(d=>d!==e).includes(r)){alert('A file named "'.concat(r,'" already exists.')),t.textContent=n;return}this.profileCollection.renameFile(e,r,this.profileCollection.getFileNames().length>1),this.render()}else t.textContent=n},a=r=>{r.key==="Enter"?(r.preventDefault(),s(),t.removeEventListener("keydown",a),t.removeEventListener("blur",l)):r.key==="Escape"&&(r.preventDefault(),t.textContent=n,t.setAttribute("contenteditable","false"),t.classList.remove("editing"),t.removeAttribute("title"),t.removeEventListener("keydown",a),t.removeEventListener("blur",l))},l=()=>{s(),t.removeEventListener("keydown",a),t.removeEventListener("blur",l)};t.addEventListener("keydown",a),t.addEventListener("blur",l)}showLoadingOverlay(t,e){this.loadingDelayTimer!==null&&(clearTimeout(this.loadingDelayTimer),this.loadingDelayTimer=null),this.loadingDelayTimer=window.setTimeout(()=>{const n=document.getElementById("loadingOverlay"),i=document.getElementById("loadingMessage"),o=document.getElementById("loadingDetails");n&&i&&(i.textContent=t,o&&e?(o.textContent=e,o.style.display="block"):o&&(o.style.display="none"),n.style.display="flex"),this.loadingDelayTimer=null},300)}hideLoadingOverlay(){this.loadingDelayTimer!==null&&(clearTimeout(this.loadingDelayTimer),this.loadingDelayTimer=null);const t=document.getElementById("loadingOverlay");t&&(t.style.display="none")}updateLoadingMessage(t,e){if(this.loadingDelayTimer!==null){clearTimeout(this.loadingDelayTimer),this.loadingDelayTimer=null;const o=document.getElementById("loadingOverlay");o&&(o.style.display="flex")}const n=document.getElementById("loadingMessage"),i=document.getElementById("loadingDetails");n&&(n.textContent=t),i&&e?(i.textContent=e,i.style.display="block"):i&&(i.style.display="none")}setupDemoButtons(){const t=document.getElementById("demoSingleBtn"),e=document.getElementById("demoZipBtn");t&&t.addEventListener("click",async n=>{n.preventDefault(),this.showLoadingOverlay("Loading demo file...","Downloading single node goroutine dump");try{await this.loadFromUrl("https://raw.githubusercontent.com/dt/crdb-stacks-examples/refs/heads/main/stacks/files/1/stacks.txt","crdb-demo-single.txt")}catch(i){const o=i&&i.message?i.message:String(i);console.error("Demo file load error:",i),this.hideLoadingOverlay(),alert("Failed to load demo file. Please try again or check your internet connection (".concat(o,")."))}}),e&&e.addEventListener("click",async n=>{n.preventDefault(),this.showLoadingOverlay("Loading demo ZIP...","Downloading ZIP file with 4 node stack dumps");try{await this.loadFromUrl("https://raw.githubusercontent.com/dt/crdb-stacks-examples/refs/heads/main/stacks.zip","crdb-demo.zip")}catch(i){console.error("Demo zip load error:",i),this.hideLoadingOverlay(),alert("Failed to load demo zip file. Please try again or check your internet connection.")}})}async loadFromUrl(t,e){try{const n=await fetch(t);if(!n.ok)throw new Error("HTTP error! status: ".concat(n.status));if(e.endsWith(".zip")){console.time("🌐 URL Zip Import: ".concat(e));const i=await n.arrayBuffer(),o=new File([i],e,{type:"application/zip"}),s=this.settingsManager.getZipFilePatternRegex(),a=await Ft.extractFiles(o,s);for(const l of a.files){const r=l.path.split("/").pop()||l.path;console.time("  📄 URL Zip Entry: ".concat(r));const u=await this.parser.parseFile(l.content,r);u.success?(this.profileCollection.addFile(u.data),console.timeEnd("  📄 URL Zip Entry: ".concat(r))):(console.timeEnd("  📄 URL Zip Entry: ".concat(r)),console.error("URL zip - Failed to parse ".concat(r,":"),u.error))}a.files.length===0&&console.warn("URL zip - No stack trace files found matching pattern: ".concat(s)),console.timeEnd("🌐 URL Zip Import: ".concat(e))}else{console.time("🌐 URL File Import: ".concat(e));const i=await n.arrayBuffer(),o=new File([i],e),s=await this.parser.parseFile(o);if(s.success)this.profileCollection.addFile(s.data),console.timeEnd("🌐 URL File Import: ".concat(e));else throw console.timeEnd("🌐 URL File Import: ".concat(e)),console.error("Failed to parse ".concat(e,":"),s.error),new Error(s.error)}this.updateLoadingMessage("Rendering results...","Organizing data and applying filters"),this.render(),this.setFilter(this.buildCurrentFilter()),this.hideLoadingOverlay()}catch(n){throw e.endsWith(".zip")?console.timeEnd("🌐 URL Zip Import: ".concat(e)):console.timeEnd("🌐 URL File Import: ".concat(e)),console.error("URL load error:",n),n}}showAllCreatedGoroutines(t,e,n){n.textContent="";const i=document.createElement("span");i.className="created-goroutines-label",i.textContent="created ".concat(e.length," goroutine").concat(e.length>1?"s":"",": "),n.appendChild(i),e.forEach((o,s)=>{if(s>0){const l=document.createElement("span");l.textContent=", ",n.appendChild(l)}const a=document.createElement("span");a.className="creator-link",a.textContent=o,a.dataset.targetId=o,a.dataset.sourceId=t,a.addEventListener("click",this.handleNavigationClick.bind(this)),this.addTooltipToLink(a,o),n.appendChild(a)})}setupNavigationHistory(){window.addEventListener("popstate",t=>{t.state&&t.state.goroutineId&&this.navigateToGoroutineInternal(t.state.goroutineId,!1,void 0)})}navigateToGoroutine(t,e){this.navigateToGoroutineInternal(t,!0,e)}navigateToGoroutineInternal(t,e,n){e&&n&&(this.addToNavigationHistory(n),history.pushState({goroutineId:n},"Goroutine ".concat(n),"#goroutine-".concat(n)));const i=this.profileCollection.lookupGoroutine(t);if(!i){console.warn("Goroutine ".concat(t," not found in profile collection"));return}this.setFilter(this.buildCurrentFilter({forcedGoroutine:void 0})),i.matches||this.setFilter(this.buildCurrentFilter({forcedGoroutine:t}));let o=document.getElementById("goroutine-".concat(t));if(!o&&(console.warn("Goroutine ".concat(t," not found in DOM - might be filtered out")),this.expandGroupsContainingGoroutine(t),o=document.getElementById("goroutine-".concat(t)),!o)){alert("Goroutine ".concat(t," not found in DOM after expanding groups"));return}this.expandParentContainers(o),this.scrollToAndHighlightGoroutine(o,t,e)}expandGroupsContainingGoroutine(t){document.querySelectorAll(".show-more-link").forEach(n=>{n.click()})}expandParentContainers(t){let e=t;for(;e;){if(e.classList.contains("expandable")&&(e.classList.contains("container-collapsed")||e.classList.contains("section-collapsed"))){e.classList.remove("container-collapsed"),e.classList.remove("section-collapsed");const n=e.querySelector(".section-content");n&&(n.style.display="")}e=e.parentElement}}scrollToAndHighlightGoroutine(t,e,n){n&&history.pushState({goroutineId:e},"Goroutine ".concat(e),"#goroutine-".concat(e)),document.querySelectorAll(".goroutine-entry.highlighted").forEach(i=>{i.classList.remove("highlighted")}),t.classList.add("highlighted"),t.scrollIntoView({behavior:"instant",block:"center"}),this.updateBackButtonState(),setTimeout(()=>{t.classList.remove("highlighted")},3e3)}addToNavigationHistory(t){const e=this.appState.addToNavigationHistory(t);this.updateBackButtonState(e.canGoBack)}navigateBack(){const t=this.appState.navigateBack();t.targetGoroutineId&&(this.navigateToGoroutineInternal(t.targetGoroutineId,!1,void 0),history.pushState({goroutineId:t.targetGoroutineId},"Goroutine ".concat(t.targetGoroutineId),"#goroutine-".concat(t.targetGoroutineId))),this.updateBackButtonState(t.canGoBack)}updateBackButtonState(t){const e=document.getElementById("backBtn"),n=document.getElementById("narrowBackBtn"),i=t!==void 0?t:this.appState.canNavigateBack();e&&(e.disabled=!i),n&&(n.disabled=!i)}clearUrlAnchor(){window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}convertToProfileCollectionSettings(t){return{functionPrefixesToTrim:this.settingsManager.getFunctionTrimPrefixes(),filePrefixesToTrim:this.settingsManager.getFileTrimPrefixes(),titleManipulationRules:this.settingsManager.getTitleManipulationRules(),nameExtractionPatterns:t.nameExtractionPatterns,zipFilePatterns:this.settingsManager.getZipFilePatterns(),categoryRules:this.settingsManager.getCategoryRules()}}onSettingsChanged(t){const e=this.convertToProfileCollectionSettings(t);this.profileCollection.updateSettings(e),this.profileCollection.getCategories().length>0&&this.render()}setupSettingsModal(){const t=document.getElementById("settingsBtn"),e=document.getElementById("settingsModal"),n=document.getElementById("settingsModalCloseBtn"),i=document.getElementById("resetSettingsBtn"),o=document.getElementById("saveSettingsBtn");t&&e&&t.addEventListener("click",()=>{this.openSettingsModal()}),n&&e&&n.addEventListener("click",()=>{this.loadSettingsIntoModal(),e.classList.add("modal-hidden"),e.classList.remove("modal-visible")}),e&&e.addEventListener("click",s=>{s.target===e&&(this.loadSettingsIntoModal(),e.classList.add("modal-hidden"),e.classList.remove("modal-visible"))}),document.addEventListener("keydown",s=>{s.key==="Escape"&&e&&e.classList.contains("modal-visible")&&(this.loadSettingsIntoModal(),e.classList.add("modal-hidden"),e.classList.remove("modal-visible"))}),i&&i.addEventListener("click",()=>{this.resetSettings()}),o&&o.addEventListener("click",()=>{this.saveSettingsFromModal()})}openSettingsModal(){const t=document.getElementById("settingsModal");t&&(this.loadSettingsIntoModal(),t.classList.add("modal-visible"),t.classList.remove("modal-hidden"))}generateModalContent(){const t=document.getElementById("settingsModalBody");t&&(t.innerHTML="",Object.entries(K).forEach(([e,n])=>{const i=document.createElement("h4");if(i.textContent=e,t.appendChild(i),e==="Parsing Options"){const s=document.createElement("div");s.className="setting-description-prose";const a=document.createElement("p");a.innerHTML="<strong>Note:</strong> Parsing trim prefixes are applied first during file parsing. The trimmed function and file names are then used as input for all categorization and naming rules above.",s.appendChild(a),t.appendChild(s)}const o=document.createElement("div");o.className="setting-group",Object.entries(n).forEach(([s,a])=>{const l=xe({id:a.settingKey,title:s,description:a.description,helpTooltip:a.tooltip,defaultRows:3,customRows:2,customPlaceholder:"Add your own ".concat(s.toLowerCase()," here...")});o.appendChild(l)}),t.appendChild(o)}))}loadSettingsIntoModal(){this.generateModalContent();const t=this.settingsManager.getStoredSettings();Object.values(K).forEach(e=>{Object.values(e).forEach(n=>{const i=n.settingKey,o=t[i],s=document.getElementById("useDefault".concat(i));s&&(s.checked=!o?.ignoreDefault);const a=document.getElementById("custom".concat(i));a&&(a.value=o?.custom?o.custom.join("\n"):"")})}),this.populateDefaultRuleTextareas(),this.setupModalEventHandlers(),this.updateAllRuleCounts()}saveSettingsFromModal(){Object.values(K).forEach(e=>{Object.values(e).forEach(n=>{const i=n.settingKey,o=document.getElementById("useDefault".concat(i)),s=document.getElementById("custom".concat(i));if(o&&s){const a=o.checked,r=s.value.split("\n").filter(d=>d.trim()!==""),u={ignoreDefault:!a,custom:r};this.settingsManager.updateSetting(i,u)}})});const t=document.getElementById("settingsModal");t&&(t.classList.add("modal-hidden"),t.classList.remove("modal-visible"))}resetSettings(){this.settingsManager.resetToDefaults(),this.loadSettingsIntoModal()}createTooltip(){this.tooltip=document.createElement("div"),this.tooltip.className="goroutine-tooltip",this.tooltip.classList.add("hidden"),this.container.appendChild(this.tooltip)}showGoroutinePreviewTooltip(t,e){const n=this.profileCollection.getGoroutineByID(t);if(!n)return;const i=this.profileCollection.getCategoryForGoroutine(t),o=i?"".concat(i.name," → "):"",s=n.stack.name,a=n.waitMinutes>0?", ".concat(n.waitMinutes," mins"):"";this.tooltip.textContent="[".concat(n.state).concat(a,"] ").concat(o).concat(s),this.tooltip.style.left="-9999px",this.tooltip.style.top="-9999px",this.tooltip.style.transform="none",this.tooltip.classList.remove("hidden");const l=this.tooltip.getBoundingClientRect(),r=window.innerWidth,u=window.innerHeight;let d=-20,m=10;e.clientX-20+l.width>r&&(d=-l.width+15,e.clientX+d<0&&(d=-e.clientX+10)),e.clientY+10+l.height>u&&(m=-l.height-10,e.clientY+m<0&&(m=-e.clientY+10)),this.tooltip.style.left="".concat(e.pageX,"px"),this.tooltip.style.top="".concat(e.pageY,"px"),this.tooltip.style.transform="translate(".concat(d,"px, ").concat(m,"px)")}hideTooltip(){this.tooltip.classList.add("hidden")}addTooltipToLink(t,e){t.dataset.tooltipGoroutineId=e,t.addEventListener("mouseenter",this.handleTooltipMouseEnter.bind(this)),t.addEventListener("mouseleave",this.handleTooltipMouseLeave.bind(this)),t.addEventListener("mousemove",this.handleTooltipMouseMove.bind(this))}setupCollapsibleSections(){document.querySelectorAll(".collapsible-header").forEach(e=>{if(e.__collapsibleSetup)return;const n=()=>{const i=e.closest(".rules-editor");if(!i)return;i.classList.contains("collapsed-settings")?(i.classList.remove("collapsed-settings"),e.classList.remove("collapsed-settings")):(i.classList.add("collapsed-settings"),e.classList.add("collapsed-settings"))};e.addEventListener("click",n),e.__collapsibleSetup=!0})}populateDefaultRuleTextareas(){const t=this.settingsManager.getDefaults();Object.values(K).forEach(e=>{Object.values(e).forEach(n=>{const i=n.settingKey,o=document.getElementById("default".concat(i));if(o){const s=t[i]||[];o.value=s.join("\n")}})})}setupModalEventHandlers(){Object.values(K).forEach(t=>{Object.values(t).forEach(e=>{this.setupRuleSettingHandlers(e.settingKey)})}),this.setupCollapsibleSections(),this.updateAllRuleCounts()}setupRuleSettingHandlers(t){const e=document.getElementById("useDefault".concat(t));if(e&&!e.__ruleToggleSetup){const n=e.closest(".default-rules-section"),i=document.querySelector("#custom".concat(t))?.closest(".custom-rules-section");if(n){const o=n.querySelector(".default-rules-header"),s=n.querySelector(".default-rules-content");if(o&&s){this.updateDefaultRuleToggleState(e,o,s);const a=r=>{r.target!==e&&!e.contains(r.target)&&e.checked&&(s.classList.toggle("collapsed-settings"),n.classList.toggle("settings-collapsed",s.classList.contains("collapsed-settings")))};o.addEventListener("click",a);const l=()=>{this.updateDefaultRuleToggleState(e,o,s)};e.addEventListener("change",l)}}i&&this.setupCustomRulesSectionHandlers(i,t),e.__ruleToggleSetup=!0}}setupCustomRulesSectionHandlers(t,e){if(t.__customRulesSetup)return;const n=t.querySelector(".custom-rules-header"),i=t.querySelector(".custom-rules-content");if(n&&i){const o=()=>{i.classList.contains("collapsed-settings")?(i.classList.remove("collapsed-settings"),t.classList.remove("settings-collapsed")):(i.classList.add("collapsed-settings"),t.classList.add("settings-collapsed"))};n.addEventListener("click",o);const s=i.querySelector("textarea");if(s){const a=()=>{this.updateRuleCount(t,s)};s.addEventListener("input",a)}t.__customRulesSetup=!0}}updateDefaultRuleToggleState(t,e,n){const i=t.closest(".default-rules-section");t.checked?(e.classList.remove("disabled"),n.style.opacity="1"):(e.classList.add("disabled"),n.style.opacity="0.5",n.classList.add("collapsed-settings"),i&&i.classList.add("settings-collapsed"))}updateRuleCount(t,e){const n=t.querySelector(".custom-rules-title h5");if(n){const i=e.value.trim(),o=i?i.split("\n").filter(l=>l.trim()).length:0,s=n.textContent?.replace(/\s*\(\d+\)$/,"")||"Custom Rules";n.textContent="".concat(s," (").concat(o,")");const a=t.querySelector(".custom-rules-header");a&&(o===0?(a.style.opacity="0.5",a.style.color="#666"):(a.style.opacity="1",a.style.color=""))}}async copyStackToClipboard(t,e){try{const n="# ".concat(e.name," → ").concat(t.name);let i="";if(t.files.length>0){const l=[];for(const r of t.files){const u=new Map;for(const d of r.groups)for(const m of d.goroutines){const p=m.waitMinutes>0?", ".concat(m.waitMinutes,"m"):"",g="".concat(m.state).concat(p);u.has(g)||u.set(g,[]),u.get(g).push(m)}if(u.size>0){t.files.length>1&&l.push("# ".concat(r.fileName));const d=Array.from(u.entries()).sort(([,m],[,p])=>{const g=m[0].state,f=p[0].state,w=m[0].waitMinutes,S=p[0].waitMinutes;return g!==f?g.localeCompare(f):w-S});for(const[m,p]of d){const g=p.map(f=>f.id);if(g.length>12)for(let f=0;f<g.length;f+=12){const S=g.slice(f,f+12).join(",");l.push("goroutine ".concat(S," [").concat(m,"]:"))}else{const f=g.join(",");l.push("goroutine ".concat(f," [").concat(m,"]:"))}}}}i=l.join("\n")}const o=this.formatStackTraceForCopy(t.trace),s=[n];i&&s.push(i),s.push(o);const a=s.join("\n\n");await navigator.clipboard.writeText(a),this.showCopyFeedback()}catch(n){console.error("Failed to copy to clipboard:",n),this.fallbackCopyToClipboard(t)}}groupGoroutinesByStateAndWait(t){const e=new Map;for(const n of t.files)for(const i of n.groups)for(const o of i.goroutines){const s=o.waitMinutes>0?", ".concat(o.waitMinutes," minutes"):"",a="".concat(o.state).concat(s);e.has(a)||e.set(a,[]),e.get(a).push(o)}return e}formatStackTraceForCopy(t){return t.map(e=>"".concat(e.func,"\n	").concat(e.file,":").concat(e.line)).join("\n")}showCopyFeedback(){const t=document.getElementById("copyNotification");t&&(t.style.display="block",t.classList.add("show"),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>{t.style.display="none"},300)},2e3))}fallbackCopyToClipboard(t){const e="# ".concat(t.name);let n="";const i=this.groupGoroutinesByStateAndWait(t);if(i.size>0){const r=[],u=Array.from(i.entries()).sort(([,d],[,m])=>{const p=d[0].state,g=m[0].state,f=d[0].waitMinutes,w=m[0].waitMinutes;return p!==g?p.localeCompare(g):f-w});for(const[d,m]of u){const p=m.map(g=>g.id).join(",");r.push("goroutine ".concat(p," [").concat(d,"]:"))}n=r.join("\n")}const o=this.formatStackTraceForCopy(t.trace),s=[e];n&&s.push(n),s.push(o);const a=s.join("\n\n"),l=document.createElement("textarea");l.value=a,l.style.position="fixed",l.style.left="-9999px",this.container.appendChild(l);try{l.select(),document.execCommand("copy"),this.showCopyFeedback()}catch(r){console.error("Fallback copy failed:",r),alert("Copy failed. Please select and copy the text manually.")}finally{document.body.removeChild(l)}}updateAllRuleCounts(){Object.values(K).forEach(t=>{Object.values(t).forEach(e=>{const n=e.settingKey,i=document.querySelector("#custom".concat(n))?.closest(".custom-rules-section");if(i){const s=i.querySelector("textarea");s&&this.updateRuleCount(i,s)}const o=document.querySelector("#default".concat(n))?.closest(".default-rules-section");if(o){const s=o.querySelector(".default-rules-textarea"),a=o.querySelector(".default-rules-title h5");if(s&&a){const l=s.value.trim(),r=l?l.split("\n").filter(d=>d.trim()).length:0,u=a.textContent?.replace(/\s*\(\d+\)$/,"")||"Default Rules";a.textContent="".concat(u," (").concat(r,")")}}})})}showAncestryTree(t){const e=this.profileCollection.getGoroutineByID(t);if(!e){console.warn("Goroutine ".concat(t," not found"));return}const n=this.buildAncestryTree(t);this.createAncestryModal(n,e)}buildAncestryTree(t){const e=i=>{const o=this.profileCollection.getGoroutineByID(i);if(!o)return null;const s=this.profileCollection.getCategoryForGoroutine(i)||null,l={id:i,goroutine:o,category:s,isTarget:i===t,children:[]};for(const r of o.created){const u=e(r);u&&l.children.push(u)}return l};let n=t;for(;;){let i=this.profileCollection.getGoroutineByID(n);if(!i?.creatorExists)break;n=i.creator}return e(n)}createAncestryModal(t,e){const n=document.getElementById("ancestryModal");n&&n.remove();const o=this.templates.ancestryModal.content.cloneNode(!0).firstElementChild;o.querySelector(".ancestry-modal-close").addEventListener("click",()=>o.remove());const a=o.querySelector(".ancestry-tree-container");o.addEventListener("click",r=>{r.target===o&&o.remove()});const l=r=>{r.key==="Escape"&&o.remove()};document.addEventListener("keydown",l),this.container.appendChild(o),this.renderAncestryTree(a,t,e)}renderAncestryTree(t,e,n){if(!e){const k=this.templates.ancestryEmptyState.content.cloneNode(!0);t.appendChild(k);return}const i=t.querySelector(".ancestry-zoom-controls");t.innerHTML="",i&&t.appendChild(i);const o=t.getBoundingClientRect(),s=o.width,a=o.height,l=xt(e);Qe().nodeSize([120,720]).separation((k,E)=>k.parent===E.parent?1.2:2.5)(l);let m=1/0,p=-1/0,g=1/0,f=-1/0;l.descendants().forEach(k=>{k.x!==void 0&&k.y!==void 0&&(m=Math.min(m,k.x),p=Math.max(p,k.x),g=Math.min(g,k.y),f=Math.max(f,k.y))});const w=f-g,S=p-m,x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttribute("width","100%"),x.setAttribute("height","100%"),x.setAttribute("class","ancestry-tree-svg");const y=document.createElementNS("http://www.w3.org/2000/svg","g");y.id="zoomGroup";const v=document.createElementNS("http://www.w3.org/2000/svg","g");v.setAttribute("transform","translate(".concat(-g,", ").concat(-m,")")),l.links().forEach(k=>{const E=document.createElementNS("http://www.w3.org/2000/svg","line");E.setAttribute("x1",(k.source.y??0).toString()),E.setAttribute("y1",(k.source.x??0).toString()),E.setAttribute("x2",(k.target.y??0).toString()),E.setAttribute("y2",(k.target.x??0).toString()),E.setAttribute("stroke","var(--border-color, #666)"),E.setAttribute("stroke-width","2"),E.setAttribute("stroke-opacity","0.6"),v.appendChild(E)}),l.descendants().forEach(k=>{const E=document.createElementNS("http://www.w3.org/2000/svg","g");E.setAttribute("transform","translate(".concat(k.y??0,", ").concat(k.x??0,")"));const B=k.data.isTarget,P=document.createElementNS("http://www.w3.org/2000/svg","rect");if(P.setAttribute("x","-320"),P.setAttribute("y","-35"),P.setAttribute("width","640"),P.setAttribute("height","70"),P.setAttribute("rx","8"),P.setAttribute("fill",B?"var(--accent-primary, #007acc)":"var(--bg-tertiary, #444)"),P.setAttribute("stroke",B?"#fff":"var(--border-color, #666)"),P.setAttribute("stroke-width",B?"3":"2"),B){const F=document.createElementNS("http://www.w3.org/2000/svg","animateTransform");F.setAttribute("attributeName","transform"),F.setAttribute("type","scale"),F.setAttribute("values","1;1.05;1"),F.setAttribute("dur","2s"),F.setAttribute("repeatCount","indefinite"),P.appendChild(F)}E.appendChild(P);const N=k.data.category?.name||"",D=k.data.goroutine.stack?.name||"",_=k.data.goroutine.waitMinutes>0?" (".concat(k.data.goroutine.waitMinutes,"m)"):"",X="[".concat(k.data.goroutine.state,"]"),M=document.createElementNS("http://www.w3.org/2000/svg","text");M.setAttribute("text-anchor","middle"),M.setAttribute("dy","-8"),M.setAttribute("fill",B?"#000":"var(--text-primary, #fff)"),M.setAttribute("font-size",B?"15":"13"),M.setAttribute("font-weight",B?"bold":"normal");const R=document.createElementNS("http://www.w3.org/2000/svg","tspan");R.textContent=k.data.goroutine.id,R.setAttribute("class","ancestry-node-id");const A=document.createElementNS("http://www.w3.org/2000/svg","tspan");if(A.textContent=" ".concat(X).concat(_),M.appendChild(R),M.appendChild(A),E.appendChild(M),N||D){const F=N&&D?"".concat(N," → ").concat(D):N||D,L=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");L.setAttribute("x","-310"),L.setAttribute("y","0"),L.setAttribute("width","620"),L.setAttribute("height","30");const U=document.createElement("div");U.className="ancestry-node-label ".concat(B?"target":"normal"),U.textContent=F,L.appendChild(U),E.appendChild(L)}E.setAttribute("class","ancestry-node"),R.addEventListener("click",F=>{F.stopPropagation(),document.getElementById("ancestryModal")?.remove(),this.navigateToGoroutine(k.data.goroutine.id,n.id)}),E.addEventListener("click",F=>{F.stopPropagation(),this.centerAncestryTreeOnNode(k.data.goroutine.id)}),E.addEventListener("mouseenter",()=>{B||P.setAttribute("fill","var(--bg-secondary, #555)")}),E.addEventListener("mouseleave",()=>{B||P.setAttribute("fill","var(--bg-tertiary, #444)")}),v.appendChild(E)}),y.appendChild(v),x.appendChild(y),t.appendChild(x),this.centerOnTargetNode(y,l,n.id,s,a,m,g),this.addZoomPanControls(t,x,y,w,S,s,a),this.setupAncestryZoomControls(t,y,s,a,n.id)}addZoomPanControls(t,e,n,i,o,s,a){const l=n.__currentTransform;let r=l?.scale??1,u=l?.translateX??0,d=l?.translateY??0,m=!1,p=0,g=0;const f=()=>{const S=n.__currentTransform;S&&(r=S.scale,u=S.translateX,d=S.translateY),n.setAttribute("transform","translate(".concat(u,", ").concat(d,") scale(").concat(r,")"))};e.addEventListener("wheel",S=>{S.preventDefault();const x=S.deltaY>0?.97:1.03,y=Math.max(.1,Math.min(3,r*x));if(y!==r){const v=s/2,b=a/2,k=(v-u)/r,E=(b-d)/r;r=y,u=v-k*r,d=b-E*r;const B=n.__currentTransform;B&&(B.scale=r,B.translateX=u,B.translateY=d),f()}}),e.addEventListener("mousedown",S=>{(S.target===e||S.target.closest("#zoomGroup")===n)&&(m=!0,p=S.clientX,g=S.clientY,e.classList.add("grabbing"))}),document.addEventListener("mousemove",S=>{if(m){S.preventDefault(),document.getSelection()?.removeAllRanges();const x=S.clientX-p,y=S.clientY-g;u+=x,d+=y,p=S.clientX,g=S.clientY;const v=n.__currentTransform;v&&(v.translateX=u,v.translateY=d),f()}}),document.addEventListener("mouseup",()=>{m&&(m=!1,e.classList.remove("grabbing"))}),n.__currentTransform={scale:r,translateX:u,translateY:d},n.__updateTransform=f;const w=n.__currentTransform;w&&(r=w.scale,u=w.translateX,d=w.translateY)}setupAncestryZoomControls(t,e,n,i,o){const s=t.closest(".ancestry-modal");if(!s)return;const a=s.querySelector(".ancestry-zoom-in"),l=s.querySelector(".ancestry-zoom-out"),r=s.querySelector(".ancestry-fit-view"),u=e.__currentTransform,d=e.__updateTransform;a&&u&&d&&a.addEventListener("click",()=>{const m=Math.min(3,u.scale*1.2);if(m!==u.scale){const p=n/2,g=i/2,f=(p-u.translateX)/u.scale,w=(g-u.translateY)/u.scale;u.scale=m,u.translateX=p-f*u.scale,u.translateY=g-w*u.scale,d()}}),l&&u&&d&&l.addEventListener("click",()=>{const m=Math.max(.1,u.scale*.8);if(m!==u.scale){const p=n/2,g=i/2,f=(p-u.translateX)/u.scale,w=(g-u.translateY)/u.scale;u.scale=m,u.translateX=p-f*u.scale,u.translateY=g-w*u.scale,d()}}),r&&r.addEventListener("click",()=>{this.centerAncestryTreeOnNode(o,.8)})}centerOnTargetNode(t,e,n,i,o,s,a){const l=e.descendants().find(g=>g.data.goroutine.id===n);if(!l)return;const r=(l.y??0)-a,u=(l.x??0)-s,d=.8,m=i/2-r*d,p=o/2-u*d;t.setAttribute("transform","translate(".concat(m,", ").concat(p,") scale(").concat(d,")")),t.__currentTransform={scale:d,translateX:m,translateY:p}}centerAncestryTreeOnNode(t,e){const n=document.getElementById("ancestryModal");if(!n)return;const i=n.querySelector("#zoomGroup");if(!i)return;const o=n.querySelectorAll("tspan");let s=null;for(let S=0;S<o.length;S++){const x=o[S];if(x.textContent===t){let y=x.parentElement;for(;y&&y.tagName!=="g";)y=y.parentElement;if(y&&y.tagName==="g"&&y.getAttribute("transform")){s=y;break}}}if(!s)return;const a=s.getAttribute("transform");if(!a)return;const l=a.match(/translate\(([^,]+),\s*([^)]+)\)/);if(!l)return;const r=parseFloat(l[1]),u=parseFloat(l[2]),d=n.querySelector(".ancestry-tree-container");if(!d)return;const m=d.getBoundingClientRect(),p=m.width,g=m.height,f=i.__currentTransform,w=i.__updateTransform;if(f&&w){const y=(i.querySelector("g")?.getAttribute("transform")||"").match(/translate\(([^,]+),\s*([^)]+)\)/),v=y?parseFloat(y[1]):0,b=y?parseFloat(y[2]):0,k=r+v,E=u+b;e!==void 0?(f.scale=e,f.translateX=p/2-k*e,f.translateY=g/2-E*e):f.scale<.8?(f.scale=.8,f.translateX=p/2-k*.8,f.translateY=g/2-E*.8):(f.translateX=p/2-k*f.scale,f.translateY=g/2-E*f.scale),i.style.transition="transform 0.3s ease-out",w(),setTimeout(()=>{i.style.transition=""},300)}}}window.StackgazerApp=tn;</script>
  <style rel="stylesheet" crossorigin>#stackgazer{--bg-primary: #1e1e1e;--bg-secondary: #252526;--bg-tertiary: #2d2d30;--bg-quaternary: #3c3c3c;--bg-overlay: rgba(0, 0, 0, .5);--text-primary: #d4d4d4;--text-secondary: #bbb;--text-muted: #888;--text-link: #007acc;--text-link-hover: #4fc3f7;--border-primary: #3e3e42;--border-secondary: #555;--border-light: #464647;--accent-primary: #007acc;--accent-primary-hover: #0087d4;--header-hover-light: #4a4a4a;--accent-border: #007acc;--accent-danger: #d73a49;--accent-danger-hover: #e03e53;--accent-success: #4caf50;--code-function: #4ec9b0;--code-file: #9cdcfe;--code-line: #b5cea8;--code-keyword: #569cd6;--code-string: #d7ba7d;--code-bg: #2d2d30}#stackgazer[data-theme=light]{--bg-primary: #ffffff;--bg-secondary: #f8f9fa;--bg-tertiary: #f5f7fa;--bg-quaternary: #e9ecef;--bg-overlay: rgba(255, 255, 255, .7);--text-primary: #242a35;--text-secondary: #495057;--text-muted: #6c757d;--text-link: #6933ff;--text-link-hover: #5a2dd9;--border-primary: #d6dbe7;--border-secondary: #ced4da;--border-light: #dee2e6;--accent-primary: #6933ff;--accent-primary-hover: #5a2dd9;--header-hover-light: #e6f3ff;--accent-border: #c1c7d0;--accent-danger: #dc3545;--accent-danger-hover: #c82333;--accent-success: #28a745;--code-function: #0969da;--code-file: #098658;--code-line: #0451a5;--code-keyword: #0969da;--code-string: #032f62;--code-bg: #f8f9fa}#stackgazer *{margin:0;padding:0;box-sizing:border-box}#stackgazer{font-family:Monaco,Menlo,Ubuntu Mono,monospace;background:var(--bg-primary);color:var(--text-primary);height:100vh;width:100%;overflow:hidden;position:relative;margin:0;padding:0;border:none;outline:none;box-sizing:border-box;display:block}#stackgazer .btn{background:var(--accent-primary);border:none;color:#fff;padding:8px 12px;border-radius:4px;cursor:pointer;font-family:inherit;font-size:12px;transition:all .2s ease}#stackgazer .btn:hover{background:var(--accent-primary-hover)}#stackgazer .btn:disabled{background:var(--border-secondary);cursor:not-allowed;opacity:.5}#stackgazer .btn:disabled:hover{background:var(--border-secondary)}#stackgazer .btn-danger{background:var(--accent-danger)}#stackgazer .btn-danger:hover{background:var(--accent-danger-hover)}#stackgazer .modal{display:none;position:absolute;z-index:10000;left:0;top:0;width:100%;height:100%;background-color:var(--bg-overlay)}#stackgazer .modal-content{background-color:var(--bg-tertiary);margin:5% auto;border:1px solid var(--border-primary);border-radius:8px;width:90%;max-width:700px;max-height:80vh;box-shadow:0 4px 20px var(--bg-overlay);display:flex;flex-direction:column;position:relative;z-index:10001;overflow:visible}#stackgazer .modal-header{padding:20px 25px 15px;border-bottom:1px solid var(--border-primary);display:flex;justify-content:space-between;align-items:center;background:var(--bg-secondary);border-radius:8px 8px 0 0}#stackgazer .modal-close{background:none;border:none;color:var(--text-muted);font-size:24px;font-weight:700;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:all .2s ease}#stackgazer .modal-close:hover{background:var(--border-primary);color:var(--text-primary)}#stackgazer .modal-body{padding:25px;color:var(--text-primary);line-height:1.6;flex:1;overflow-y:auto;overflow-x:visible}#stackgazer .container{display:flex;height:100vh}#stackgazer .sidebar{width:300px;background:var(--bg-secondary);border-right:1px solid var(--border-primary);padding:20px;overflow-y:auto}#stackgazer .main-content{flex:1;display:flex;flex-direction:column;overflow:hidden}#stackgazer .view-controls-bar{background:var(--bg-secondary);border-bottom:1px solid var(--border-primary);padding:10px 20px;display:flex;align-items:center;gap:15px;flex-wrap:wrap;min-height:50px}#stackgazer .view-controls-bar .view-controls{display:flex;flex-direction:row;gap:10px;flex-wrap:wrap}#stackgazer .view-controls-bar .left-controls{display:flex;align-items:center;gap:15px;flex:1}#stackgazer .view-controls-bar .right-controls{display:flex;align-items:center;gap:10px}#stackgazer .view-controls-bar select{background:var(--bg-quaternary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);font-family:inherit;font-size:11px;padding:4px 8px}#stackgazer .view-controls-bar select:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .view-controls-bar .control-btn{padding:6px 12px;font-size:11px;min-width:80px}#stackgazer .view-controls-bar label{display:flex;align-items:center;gap:6px;color:var(--text-primary);font-size:11px;white-space:nowrap}#stackgazer .drop-zone{flex:1;display:flex;align-items:center;justify-content:center;border:2px dashed var(--accent-border);margin:20px;border-radius:8px;transition:all .3s ease;cursor:pointer}#stackgazer .drop-zone.dragover{border-color:var(--text-link-hover);background:color-mix(in srgb,var(--accent-primary) 10%,transparent)}#stackgazer .drop-zone.has-content{align-items:flex-start;justify-content:flex-start;padding:0;border:none;margin:0;border-radius:0;overflow-y:auto}#stackgazer .drop-message{text-align:center;color:var(--accent-primary);font-size:18px}#stackgazer .filter-section{margin-bottom:20px}#stackgazer .filter-section h3{color:var(--accent-primary);margin-bottom:10px;font-size:14px}#stackgazer .filter-input{width:100%;padding:8px;background:var(--bg-quaternary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);font-family:inherit;margin-bottom:10px}#stackgazer .filter-input:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .filter-input.error{border-color:var(--accent-danger);background:color-mix(in srgb,var(--accent-danger) 10%,transparent)}#stackgazer .filter-error{font-size:11px;color:var(--accent-danger);margin-top:4px;padding:4px 8px;background:color-mix(in srgb,var(--accent-danger) 10%,transparent);border-radius:4px;border:1px solid var(--accent-danger)}#stackgazer .stack-display{width:100%;height:100%;overflow-y:auto;padding:20px;white-space:pre-wrap;font-size:12px;line-height:1.4;box-sizing:border-box}#stackgazer .stack-group,#stackgazer .stack-section,#stackgazer .section.stack-section{margin-bottom:20px;border:2px solid var(--accent-border);border-radius:8px;cursor:text;-webkit-user-select:text;user-select:text;position:relative}#stackgazer .header{background:var(--accent-primary);color:#fff;padding:12px 15px;font-weight:700;cursor:pointer;-webkit-user-select:none;user-select:none;font-size:14px;display:flex;justify-content:space-between;align-items:center;gap:8px;position:relative}#stackgazer .header:hover{background:var(--accent-primary-hover)}#stackgazer .file-section .header{background:var(--bg-quaternary);color:var(--text-primary)}#stackgazer .file-section .header:hover{background:var(--header-hover-light)}#stackgazer .file-section.single-group>.header{display:none}#stackgazer .file-section .group-section .header{background:var(--bg-quaternary);color:var(--text-primary)}#stackgazer .file-section .group-section .header:hover{background:var(--header-hover-light)}#stackgazer .group-title,#stackgazer .stack-title,#stackgazer .category-title{cursor:text;-webkit-user-select:text;user-select:text;flex:0 1 auto;display:flex;align-items:center;gap:12px;min-width:0}#stackgazer .stack-title:before{content:"↳";margin-right:-4px;opacity:1;font-size:1.1em;position:relative;top:-3px}#stackgazer .group-title-text{font-weight:700;color:#fff}#stackgazer .group-title-summary{font-weight:400;color:color-mix(in srgb,var(--text-primary) 80%,transparent);font-size:13px;padding-left:12px;border-left:1px solid color-mix(in srgb,var(--text-primary) 30%,transparent)}#stackgazer .group-count,#stackgazer .stack-count{font-weight:400;font-size:13px;text-align:right}#stackgazer .group-controls{display:flex;gap:5px}#stackgazer .group-control-btn{background:color-mix(in srgb,var(--text-primary) 20%,transparent);border:none;color:#fff;padding:4px 8px;border-radius:3px;cursor:pointer;font-family:inherit;font-size:10px}#stackgazer .group-control-btn:hover{background:color-mix(in srgb,var(--text-primary) 30%,transparent)}#stackgazer .pin-button{--pin-size: 28px;--pin-font: 16px;--pin-top: -14px;--pin-right: -14px;--pin-z: 10;--pin-hover-size: 53px;--pin-hover-font: 26px;--pin-hover-offset: -26px;--pin-pinned-size: 36px;--pin-pinned-font: 18px;--pin-pinned-offset: -18px;--pin-target-size: 24px;position:absolute;background:var(--bg-quaternary);border:1px solid var(--border-secondary);color:var(--text-muted);border-radius:50%;cursor:pointer;font-family:inherit;transition:all .2s ease;opacity:0;display:flex;align-items:center;justify-content:center;font-weight:400;width:var(--pin-size);height:var(--pin-size);font-size:var(--pin-font);top:var(--pin-top);right:var(--pin-right);z-index:var(--pin-z)}#stackgazer .pin-button.size-small{--pin-size: 18px;--pin-font: 10px;--pin-top: 3px;--pin-right: -25px;--pin-z: 5;--pin-hover-size: 32px;--pin-hover-font: 16px;--pin-hover-offset: -30px;--pin-hover-top: -4px;--pin-pinned-size: 20px;--pin-pinned-font: 11px;--pin-pinned-top: 2px;--pin-pinned-offset: -27px;--pin-target-size: 16px}#stackgazer .section:hover>.header>.pin-button:not(.pinned),#stackgazer .goroutine-entry:hover>.pin-button:not(.pinned){opacity:.7}#stackgazer .pin-button:before{content:"";position:absolute;top:calc(var(--pin-target-size) * -1);left:calc(var(--pin-target-size) * -1);right:calc(var(--pin-target-size) * -1);bottom:calc(var(--pin-target-size) * -1);border-radius:50%}#stackgazer .pin-button:hover{background:var(--bg-quaternary);border-color:var(--border-primary);color:var(--text-primary);opacity:1!important;width:var(--pin-hover-size);height:var(--pin-hover-size);font-size:var(--pin-hover-font);top:calc(var(--pin-top) - (var(--pin-hover-size) - var(--pin-size)) / 2);right:calc(var(--pin-right) - (var(--pin-hover-size) - var(--pin-size)) / 2)}#stackgazer .pin-button.size-small:hover{top:calc(var(--pin-top) - (var(--pin-hover-size) - var(--pin-size)) / 2);right:calc(var(--pin-right) - (var(--pin-hover-size) - var(--pin-size)) / 2)}#stackgazer .pin-button.pinned{background:var(--bg-quaternary);opacity:1!important;border:2px solid var(--border-primary);color:var(--text-primary);width:var(--pin-pinned-size);height:var(--pin-pinned-size);font-size:var(--pin-pinned-font);top:var(--pin-top);right:var(--pin-right)}#stackgazer .pin-button.size-small.pinned{top:var(--pin-top)}#stackgazer .pin-button.pinned:hover{color:var(--text-primary);border:2px solid var(--text-primary);width:var(--pin-hover-size);height:var(--pin-hover-size);font-size:var(--pin-hover-font);top:calc(var(--pin-top) - (var(--pin-hover-size) - var(--pin-pinned-size)) / 2);right:calc(var(--pin-right) - (var(--pin-hover-size) - var(--pin-pinned-size)) / 2)}#stackgazer .pin-button.size-small.pinned:hover{top:calc(var(--pin-top) - (var(--pin-hover-size) - var(--pin-pinned-size)) / 2);right:calc(var(--pin-right) - (var(--pin-hover-size) - var(--pin-pinned-size)) / 2)}#stackgazer .header .counts{margin-right:36px;cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .header-right{display:flex;flex-direction:column;align-items:flex-end;gap:2px}#stackgazer .category-stats,#stackgazer .stack-stats{font-size:9px;color:color-mix(in srgb,white 60%,transparent);white-space:nowrap;text-align:right;margin-right:36px;cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .category-stats:empty,#stackgazer .stack-stats:empty{display:none}#stackgazer .group-content,#stackgazer .stack-content{background:var(--bg-tertiary);padding-bottom:1px}#stackgazer .group-content.collapsed-container,#stackgazer .stack-content.collapsed-container{display:none}#stackgazer .unique-stack-view{background:var(--bg-tertiary);border:1px solid var(--border-primary);border-radius:6px;margin:10px;cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .unique-stack-header{background:var(--bg-quaternary);color:var(--text-primary);padding:8px 15px;font-size:12px;font-weight:700;border-bottom:1px solid var(--border-primary);border-radius:6px 6px 0 0;cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .unique-stack-content{padding:15px;cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .state-group{background:var(--bg-quaternary);margin:10px;border-radius:4px;overflow:visible}#stackgazer .state-group-header{background:var(--bg-quaternary);color:var(--text-primary);padding:8px 12px;font-weight:700;font-size:11px;cursor:pointer;-webkit-user-select:none;user-select:none;display:flex;justify-content:space-between;align-items:center}#stackgazer .state-group-header:hover{background:var(--header-hover-light)}#stackgazer .state-group-content{display:block}#stackgazer .state-group-content.collapsed-section{display:none}#stackgazer .remaining-goroutines{display:block}#stackgazer .remaining-goroutines.collapsed-section{display:none}#stackgazer .show-more-link{padding:6px 12px;margin:0;background:transparent;border:none;cursor:pointer;text-align:center;color:var(--accent-primary);font-size:11px;transition:color .2s;border-bottom:1px dashed var(--border-primary)}#stackgazer .show-more-link:hover{color:var(--text-link-hover)}#stackgazer .show-more-text{-webkit-user-select:none;user-select:none}#stackgazer .goroutine-entry{background:transparent;border-bottom:1px dashed var(--border-primary);overflow:visible;cursor:text;-webkit-user-select:text;user-select:text;position:relative}#stackgazer .goroutine-entry:last-child{border-bottom:none}#stackgazer .goroutine-entry.highlighted{background:color-mix(in srgb,var(--accent-primary) 25%,transparent)!important;transition:background-color .3s ease}#stackgazer .goroutine-header{background:transparent;color:var(--text-primary);padding:6px 12px;font-size:11px;cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .goroutine-header-first-line{display:flex;justify-content:space-between;align-items:center}#stackgazer .goroutine-header-left{display:flex;align-items:center;gap:4px}#stackgazer .group-header-left{display:flex;align-items:center;gap:6px}#stackgazer .goroutine-header-second-line{margin-top:4px;font-size:10px;color:var(--text-secondary);font-style:italic}#stackgazer .created-goroutines-label,#stackgazer .created-goroutines-more{color:var(--text-muted)}#stackgazer .created-goroutines-more.clickable{color:var(--text-link);cursor:pointer;text-decoration:underline}#stackgazer .created-goroutines-more.clickable:hover{color:var(--text-link-hover)}#stackgazer .goroutine-header:hover{background:var(--bg-quaternary)}#stackgazer .goroutine-created-by{font-size:10px;color:var(--text-muted);font-style:italic}#stackgazer .goroutine-created-by .creator-link{color:var(--text-link);cursor:pointer;text-decoration:underline}#stackgazer .goroutine-created-by .creator-link:hover{color:var(--text-link-hover)}#stackgazer .goroutine-created-by .creator-missing{color:var(--text-muted);text-decoration:line-through}#stackgazer .goroutine-stack{padding:10px 15px;display:none}#stackgazer .goroutine-stack.expanded{display:block}#stackgazer .stack-line{margin-bottom:2px}#stackgazer .stack-trace{background:var(--code-bg);margin:10px;padding:10px;border-radius:4px;border:1px solid var(--border-secondary);cursor:text;-webkit-user-select:text;user-select:text}#stackgazer .trace-header{font-weight:700;color:var(--accent-primary);margin-bottom:8px;font-size:12px}#stackgazer .section{background:var(--bg-tertiary);margin:10px;border:1px solid var(--border-primary);border-radius:4px;position:relative}#stackgazer .file-section .group-section{margin:0 0 0 10px;border-radius:0;border-left:none;border-right:none}#stackgazer .file-section.single-group .group-section{margin-left:0}#stackgazer .file-section .group-section:first-child{border-top-left-radius:4px;border-top-right-radius:4px;border-top:1px solid var(--border-primary)}#stackgazer .file-section .group-section:last-child{border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-bottom:1px solid var(--border-primary)}#stackgazer .file-section .group-section:only-child{border:1px solid var(--border-primary);border-radius:4px}#stackgazer .category-section{border-radius:12px}#stackgazer .category-section>.header{position:sticky;top:-23px;z-index:100;border-radius:6px 6px 0 0}#stackgazer .stack-section>.header{position:sticky;top:20px;z-index:90}#stackgazer .category-section>.header .pin-button{--pin-top: 5px;--pin-hover-offset: -21px}#stackgazer .stack-section>.header .pin-button{--pin-top: 5px;--pin-hover-offset: -21px}#stackgazer .section-content{padding:10px;transition:all .2s ease}#stackgazer .file-section>.section-content{padding:0}#stackgazer .expandable.container-collapsed>.section-content{display:none}#stackgazer .expandable.section-collapsed>.section-content{display:none}#stackgazer .group-section .section-content:empty{display:none}#stackgazer .expandable .expand-icon:before{content:"▼";margin-right:6px}#stackgazer .expandable.container-collapsed .expand-icon:before,#stackgazer .expandable.section-collapsed .expand-icon:before{content:"▶"}#stackgazer .custom-rules-section .custom-rules-title h5:before{content:"▼";margin-right:6px;font-size:10px;color:var(--text-muted);transition:transform .2s ease}#stackgazer .custom-rules-section.settings-collapsed .custom-rules-title h5:before{content:"▶"}#stackgazer .group-labels{margin-top:8px;font-size:10px;color:var(--text-muted);font-style:italic}#stackgazer .function-name{color:var(--code-function);word-break:break-all;overflow-wrap:break-word}#stackgazer .file-path{color:var(--code-file);word-break:break-all;overflow-wrap:break-word}#stackgazer .line-number{color:var(--code-line)}#stackgazer .function-args-short{color:var(--text-secondary);font-size:10px;cursor:pointer}#stackgazer .function-args-short:hover{color:var(--text-muted)}#stackgazer .function-args-full{color:var(--text-primary);font-size:10px}#stackgazer .creator-link{color:var(--code-keyword);cursor:pointer;text-decoration:underline;transition:color .2s ease}#stackgazer .creator-link:hover{color:var(--text-link-hover);text-decoration:underline}#stackgazer .goroutine-tooltip{position:absolute;background:var(--bg-tertiary);border:1px solid var(--border-light);border-radius:4px;padding:8px 12px;font-size:12px;color:var(--text-primary);box-shadow:0 4px 8px var(--bg-overlay);z-index:1000;pointer-events:none;max-width:800px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}#stackgazer .goroutine-tooltip .tooltip-label{font-weight:700;color:var(--code-keyword)}#stackgazer .goroutine-tooltip .tooltip-value{color:var(--code-string)}#stackgazer .goroutine-tooltip .tooltip-stack{margin-top:4px;font-family:Courier New,monospace;font-size:11px;color:var(--code-file)}#stackgazer .creator-missing{text-decoration:line-through}#stackgazer .created-by-line{margin-top:5px;padding-top:5px;border-top:1px solid var(--border-primary)}#stackgazer .created-by-text{color:var(--text-muted)}#stackgazer .stats{background:var(--bg-tertiary);padding:15px;border-bottom:1px solid var(--border-primary);font-size:12px}#stackgazer .stats-item{margin-bottom:5px;display:flex;justify-content:space-between}#stackgazer .state-stats{margin-top:10px;padding-top:10px;border-top:1px solid var(--border-light)}#stackgazer .state-stats div{display:flex;justify-content:space-between;margin-bottom:2px;font-size:11px;color:var(--text-secondary)}#stackgazer .state-stat-item{margin-bottom:3px;font-size:11px;color:var(--text-secondary)}#stackgazer .state-item{cursor:pointer;padding:2px 4px;border-radius:2px;transition:background-color .2s}#stackgazer .state-item:hover{background-color:var(--border-primary)}#stackgazer .state-item.state-only{background-color:color-mix(in srgb,var(--accent-primary) 20%,transparent);color:var(--accent-primary);font-weight:700}#stackgazer .state-item.state-excluded{text-decoration:line-through;color:var(--accent-danger)}#stackgazer .state-item.state-grayed{opacity:.5;color:var(--text-secondary)}#stackgazer .sidebar .view-controls{display:none}#stackgazer .control-btn{background:var(--accent-primary);border:none;color:#fff;padding:8px 12px;border-radius:4px;cursor:pointer;font-family:inherit;font-size:12px;transition:all .2s ease}#stackgazer .control-btn:hover{background:var(--accent-primary-hover)}#stackgazer .control-btn:disabled{background:var(--border-secondary);cursor:not-allowed;opacity:.5}#stackgazer .control-btn:disabled:hover{background:var(--border-secondary)}#stackgazer .clear-btn{padding:8px 16px;width:100%;margin-top:10px}#stackgazer .file-section{margin-bottom:10px}#stackgazer .file-list-container{border:1px solid var(--border-secondary);border-radius:6px;background:var(--bg-tertiary);transition:all .3s ease;min-height:40px}#stackgazer .file-list-container.dragover{border-color:var(--accent-primary);background:color-mix(in srgb,var(--accent-primary) 10%,transparent)}#stackgazer .file-list{max-height:200px;overflow-y:auto;overflow-x:hidden}#stackgazer .file-item{display:flex;align-items:center;background:var(--bg-quaternary);padding:8px 10px;margin:5px 5px 0;border-radius:4px;font-size:12px;gap:8px}#stackgazer .file-item:last-child{margin-bottom:5px}#stackgazer .file-item.file-hidden{opacity:.5;background:var(--bg-secondary)}#stackgazer .file-item.file-hidden .file-name-text{color:var(--text-muted);text-decoration:line-through}#stackgazer .file-item:hover{background:var(--border-primary)}#stackgazer .file-item.file-hidden:hover{background:var(--bg-quaternary)}#stackgazer .file-name-text{flex:1;margin-right:8px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}#stackgazer .file-name-text{display:inline-block;cursor:pointer;border-radius:2px;padding:1px 2px;transition:all .2s;position:relative}#stackgazer .file-name-text:hover{background-color:color-mix(in srgb,var(--text-primary) 10%,transparent);transform:translateY(-1px)}#stackgazer .file-name-text:hover:after{content:"✏️";position:absolute;right:-16px;top:50%;transform:translateY(-50%);font-size:10px;opacity:.7}#stackgazer .file-name-text.editing{background-color:var(--accent-primary);color:#fff;outline:2px solid var(--text-link-hover);outline-offset:1px;cursor:text;border-radius:3px;padding:2px 4px;box-shadow:0 0 8px color-mix(in srgb,var(--text-link-hover) 40%,transparent)}#stackgazer .file-name-text.editing:focus{background-color:var(--accent-primary-hover);outline-color:var(--text-link-hover);box-shadow:0 0 12px color-mix(in srgb,var(--text-link-hover) 60%,transparent)}#stackgazer .file-remove-btn{background:var(--accent-danger);border:none;color:#fff;border-radius:50%;width:18px;height:18px;cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0;line-height:1;transition:all .2s ease}#stackgazer .file-remove-btn:hover{background:var(--accent-danger-hover);transform:scale(1.1)}#stackgazer .file-stats{font-size:10px;color:var(--text-muted);white-space:nowrap;flex-shrink:0}#stackgazer .file-drop-area{padding:8px;text-align:center;color:var(--text-muted);font-size:10px;opacity:.7;cursor:pointer;border-top:1px dashed var(--border-secondary);margin-top:5px;display:none}#stackgazer .file-list-container:hover .file-drop-area,#stackgazer .file-list-container.dragover .file-drop-area{opacity:1}#stackgazer .file-list-container.has-files .file-drop-area{display:block}#stackgazer .empty-state{padding:15px;text-align:center;color:var(--text-muted);font-size:11px}#stackgazer .add-file-btn{background:transparent;border:1px solid var(--border-secondary);color:var(--text-muted);border-radius:50%;width:14px;height:14px;font-size:8px;font-weight:400;cursor:pointer;margin-left:2px;vertical-align:middle;display:inline-flex;align-items:center;justify-content:center;line-height:1;opacity:.6}#stackgazer .add-file-btn:hover{background:var(--border-primary);color:var(--text-primary);border-color:var(--text-muted);opacity:1}#stackgazer .clear-all-btn{background:transparent;border:1px solid var(--accent-danger);color:var(--accent-danger);border-radius:50%;width:16px;height:16px;font-size:10px;font-weight:700;cursor:pointer;margin-left:8px;margin-bottom:10px;vertical-align:middle;display:inline-flex;align-items:center;justify-content:center;line-height:1;opacity:.7}#stackgazer .clear-all-btn:hover{background:var(--accent-danger);color:#fff;opacity:1}#stackgazer .files-header,#stackgazer .filter-header{display:flex;align-items:center;justify-content:space-between;width:100%}#stackgazer .files-title{display:flex;align-items:center}#stackgazer .filter-help-btn{background:transparent;border:1px solid var(--border-secondary);color:var(--text-secondary);border-radius:50%;width:14px;height:14px;font-size:8px;font-weight:400;cursor:pointer;margin-left:2px;vertical-align:middle;display:inline-flex;align-items:center;justify-content:center;line-height:1;opacity:.6}#stackgazer .filter-help-btn:hover{background:var(--border-primary);color:var(--text-primary);border-color:var(--text-secondary);opacity:1}#stackgazer .modal-header h3{color:var(--accent-primary);margin:0;font-size:18px}#stackgazer .modal-body h4{color:var(--accent-primary);margin:20px 0 10px;font-size:14px;border-bottom:1px solid var(--border-primary);padding-bottom:5px}#stackgazer .modal-body h4:first-child{margin-top:0}#stackgazer .modal-body ul{margin:10px 0 20px 20px;padding:0}#stackgazer .modal-body li{margin-bottom:8px;list-style-type:disc}#stackgazer .modal-body code{background:var(--bg-quaternary);border:1px solid var(--border-secondary);border-radius:3px;padding:2px 6px;font-family:Monaco,Menlo,Ubuntu Mono,monospace;font-size:11px;color:var(--code-function)}#stackgazer .modal-body p{margin:10px 0}#stackgazer .modal-body strong{color:var(--accent-success)}#stackgazer .side-by-side-container{width:100%}#stackgazer .side-by-side-headers{display:flex;gap:20px;margin-bottom:5px}#stackgazer .side-by-side-headers .column-header{flex:1;background:var(--bg-quaternary);color:var(--text-primary);padding:6px 10px;font-weight:700;font-size:11px;border-radius:4px 4px 0 0}#stackgazer .side-by-side-row{display:flex;gap:20px;margin-bottom:1px;align-items:flex-start}#stackgazer .function-side,#stackgazer .location-side{flex:1;padding:2px 10px;border-left:2px solid var(--accent-primary);min-height:20px;display:flex;align-items:flex-start;flex-wrap:wrap;word-break:break-all;overflow-wrap:break-word;min-width:0}#stackgazer .function-side{background:color-mix(in srgb,var(--code-function) 10%,transparent)}#stackgazer .location-side{background:color-mix(in srgb,var(--code-file) 10%,transparent)}#stackgazer .creator-function{color:var(--code-function);font-weight:700}#stackgazer .settings-container{position:absolute;bottom:15px;left:15px;display:flex;gap:10px}#stackgazer .settings-btn{background:transparent;border:1px solid var(--border-secondary);color:var(--text-muted);border-radius:50%;width:32px;height:32px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:.6;transition:all .2s ease}#stackgazer .settings-btn:hover{background:var(--border-primary);color:var(--text-primary);border-color:var(--text-muted);opacity:1;transform:rotate(90deg)}#stackgazer .theme-toggle-btn{background:transparent;border:1px solid var(--border-secondary);color:var(--text-muted);border-radius:50%;width:32px;height:32px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:.6;transition:all .2s ease}#stackgazer .theme-toggle-btn:hover{background:var(--border-primary);color:var(--text-primary);border-color:var(--text-muted);opacity:1}#stackgazer .github-btn{background:transparent;border:1px solid var(--border-secondary);color:var(--text-secondary);border-radius:50%;width:32px;height:32px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:.6;transition:all .2s ease;text-decoration:none;position:relative}#stackgazer .github-btn:after{content:"";width:16px;height:16px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23bbb'%3E%3Cpath d='M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z'/%3E%3C/svg%3E");background-size:16px 16px;background-repeat:no-repeat;background-position:center}#stackgazer .github-btn:hover{background:var(--border-primary);color:var(--text-primary);border-color:var(--text-muted);opacity:1}#stackgazer .setting-group{margin-bottom:20px;padding:15px;background:var(--bg-quaternary);border-radius:6px;border:1px solid var(--border-secondary)}#stackgazer .setting-title{display:flex;align-items:center;gap:6px;margin-bottom:8px;font-weight:700;color:var(--text-primary);font-size:14px}#stackgazer .setting-help-icon{background:transparent;border:1px solid var(--text-muted);color:var(--text-muted);border-radius:50%;width:16px;height:16px;font-size:10px;font-weight:700;cursor:help;display:flex;align-items:center;justify-content:center;position:relative;opacity:.8;transition:all .2s ease}#stackgazer .setting-help-icon:hover{background:var(--bg-quaternary);color:var(--text-primary);border-color:var(--text-secondary);opacity:1}#stackgazer .setting-help-icon[data-tooltip]:hover:after{content:attr(data-tooltip);position:absolute;left:0;top:24px;background:var(--bg-primary);color:var(--text-primary);padding:8px 12px;border-radius:6px;font-size:11px;font-weight:400;line-height:1.4;white-space:pre-line;width:320px;text-align:left;box-shadow:0 4px 12px color-mix(in srgb,var(--bg-overlay) 80%,transparent);border:1px solid var(--border-secondary);z-index:10002;pointer-events:none}#stackgazer .setting-help-icon[data-tooltip]:hover:before{content:"";position:absolute;left:8px;top:20px;border:4px solid transparent;border-bottom-color:var(--border-secondary);z-index:10003;pointer-events:none}#stackgazer .setting-label{display:block;cursor:pointer;color:var(--text-primary);font-size:13px}#stackgazer .setting-checkbox-label{display:flex;align-items:center;gap:8px;cursor:pointer;color:var(--text-primary);font-size:13px}#stackgazer .setting-checkbox-text{color:var(--text-primary)}#stackgazer .setting-text{font-weight:700;margin-left:8px}#stackgazer .setting-description{font-size:11px;color:var(--text-muted);margin-top:8px;line-height:1.4}#stackgazer .setting-checkbox{width:16px;height:16px;margin:0;vertical-align:middle}#stackgazer .setting-input{background:var(--bg-tertiary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);padding:6px 10px;font-family:inherit;font-size:12px;width:80px;margin-top:4px}#stackgazer .setting-input:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .setting-text-input{background:var(--bg-tertiary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);padding:6px 10px;font-family:inherit;font-size:12px;width:100%;margin-top:4px}#stackgazer .setting-text-input:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .setting-text-input::placeholder{color:var(--text-muted);font-style:italic}#stackgazer .setting-textarea{background:var(--bg-tertiary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);padding:8px 10px;font-family:SF Mono,Monaco,Inconsolata,Roboto Mono,monospace;font-size:11px;width:100%;margin-top:4px;resize:vertical;min-height:60px}#stackgazer .setting-textarea:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .setting-textarea::placeholder{color:var(--text-muted);font-style:italic}#stackgazer .rules-editor{border:1px solid var(--border-secondary);border-radius:4px;background:var(--bg-secondary);margin-bottom:8px;overflow:hidden;padding:0}#stackgazer .rules-list{border:none;border-radius:0;background:transparent;margin-bottom:0;overflow:hidden}#stackgazer .rule-item{background:transparent;border:none;border-bottom:1px solid var(--border-secondary);border-radius:0;padding:0 4px 0 0;margin-bottom:0;display:flex;align-items:flex-start;gap:8px;min-height:20px}#stackgazer .rule-item:last-child{border-bottom:none}#stackgazer .rule-item:hover{background:var(--bg-quaternary)}#stackgazer .rule-controls{display:flex;align-items:center;gap:8px;width:100%;flex-wrap:nowrap;margin:0;padding:0}#stackgazer .rule-type-select{background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--border-primary);border-radius:4px;padding:4px 8px;font-size:12px;min-width:80px}#stackgazer .rule-pattern,#stackgazer .rule-to,#stackgazer .rule-while-custom{background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--border-primary);border-radius:4px;padding:4px 8px;font-size:12px;flex:1;min-width:120px}#stackgazer .rule-pattern{min-width:180px}#stackgazer .rule-to{min-width:100px}#stackgazer .rule-while{background:var(--bg-secondary);color:var(--text-primary);border:1px solid var(--border-primary);border-radius:4px;padding:4px 8px;font-size:12px;min-width:90px}#stackgazer .rule-while-custom{min-width:100px}#stackgazer .remove-rule-btn{background:transparent;color:var(--text-muted);border:none;border-radius:0;width:20px;height:20px;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;opacity:.6}#stackgazer .remove-rule-btn:hover{color:var(--accent-danger);opacity:1}#stackgazer .footer-buttons{display:flex;gap:4px;padding:6px 12px;border-top:1px solid var(--border-secondary)}#stackgazer .rules-editor.collapsed-settings .rules-list,#stackgazer .rules-editor.collapsed-settings .footer-buttons{display:none}#stackgazer .add-rule-btn{background:transparent;color:var(--text-secondary);border:1px solid var(--border-secondary);border-radius:3px;padding:4px 8px;font-size:10px;cursor:pointer;transition:all .2s;flex:1}#stackgazer .add-rule-btn:hover{background:var(--accent-primary);color:#fff;border-color:var(--accent-primary)}#stackgazer .rule-input-container{position:relative;flex:1;min-width:120px;margin:0;padding:0}#stackgazer .rule-type-prefix{position:absolute;left:0;top:0;bottom:0;color:var(--text-muted);font-size:10px;font-weight:500;pointer-events:none;z-index:0;background:var(--bg-tertiary);border-right:1px solid var(--border-secondary);padding:0;margin:0;line-height:1;display:flex;align-items:center;min-width:48px;justify-content:center}#stackgazer .rule-replacement-line .rule-type-prefix,#stackgazer .rule-while-container .rule-type-prefix{min-width:60px}#stackgazer .rule-input{background:transparent;color:var(--text-primary);border:none;border-radius:0;padding:1px 4px;font-size:12px;width:100%;outline:none;height:18px;line-height:16px}#stackgazer .skip-rule .rule-input,#stackgazer .trim-rule .rule-input,#stackgazer .fold-rule .rule-pattern-input{padding-left:52px}#stackgazer .fold-rule .rule-replacement-input,#stackgazer .fold-rule .rule-while-input{padding-left:64px}#stackgazer .unknown-rule .rule-json-input{width:100%;padding:2px 4px;font-size:11px;font-family:monospace;resize:vertical;min-height:36px}#stackgazer .rule-replacement-line{margin-top:1px;display:flex;gap:8px}#stackgazer .rule-replacement-line .rule-input-container:first-child{flex:1;max-width:250px}#stackgazer .rule-while-container{flex:1;min-width:120px}#stackgazer .rule-category-container{flex:1;min-width:150px}#stackgazer .match-rule .rule-pattern-input{padding-left:64px}#stackgazer .match-rule .rule-category-input{padding-left:32px}#stackgazer .fold-rule-content{flex:1;display:flex;flex-direction:column;gap:0px}#stackgazer .fold-rule .rule-controls{flex-wrap:nowrap;width:100%}#stackgazer .find-rule-content{flex:1;display:flex;flex-direction:column;gap:0px}#stackgazer .ancestry-modal{position:absolute;top:0;left:0;width:100%;height:100%;background:#000c;z-index:1000;padding:20px;box-sizing:border-box}#stackgazer .ancestry-modal-content{background:var(--bg-primary);border:1px solid var(--border-primary);border-radius:8px;width:95%;height:90%;max-width:none;margin:2.5% auto;display:flex;flex-direction:column;overflow:visible;box-shadow:0 4px 20px #00000080;position:relative}#stackgazer .ancestry-modal-header{padding:1rem;border-bottom:1px solid var(--border-primary);display:flex;justify-content:space-between;align-items:center}#stackgazer .ancestry-modal-title{margin:0;color:var(--text-primary)}#stackgazer .ancestry-modal-close{position:absolute;top:-18px;right:-18px;background:var(--bg-tertiary);border:1px solid var(--border-primary);border-radius:50%;color:var(--text-primary);font-size:24px;cursor:pointer;padding:0;width:36px;height:36px;display:flex;align-items:center;justify-content:center;z-index:20;transition:all .2s ease}#stackgazer .ancestry-modal-close:hover{background:var(--bg-quaternary);border-color:var(--accent-primary);transform:scale(1.1)}#stackgazer .ancestry-tree-container{flex:1;overflow:auto;padding:20px;background:var(--bg-secondary);position:relative;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}#stackgazer .ancestry-zoom-controls{position:absolute;top:20px;right:20px;display:flex;flex-direction:column;gap:5px;z-index:10}#stackgazer .ancestry-zoom-controls button{background:var(--bg-tertiary);border:1px solid var(--border-primary);color:var(--text-primary);padding:8px 12px;cursor:pointer;border-radius:4px;font-size:14px}#stackgazer .ancestry-zoom-controls button:hover{background:var(--bg-quaternary)}#stackgazer .ancestry-tree-svg{display:block;background:var(--bg-secondary, #2a2a2a);cursor:grab;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}#stackgazer .ancestry-tree-svg.grabbing{cursor:grabbing}#stackgazer .ancestry-node{cursor:pointer}#stackgazer .ancestry-node-id{cursor:pointer;text-decoration:underline}#stackgazer .ancestry-node-label{font-size:11px;text-align:center;line-height:1.2;word-wrap:break-word;overflow-wrap:break-word;-webkit-hyphens:auto;hyphens:auto;max-height:30px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}#stackgazer .ancestry-node-label.target{color:#000}#stackgazer .ancestry-node-label.normal{color:var(--text-muted, #999)}#stackgazer .ancestry-empty-state{color:var(--text-primary, #fff);text-align:center;padding:2rem;margin:0}#stackgazer .find-rule .rule-controls{flex-wrap:nowrap;width:100%}#stackgazer .skipwhile-rule-content{flex:1;display:flex;flex-direction:column;gap:0px}#stackgazer .skipwhile-rule .rule-controls{flex-wrap:nowrap;width:100%}#stackgazer .collapsible-group{border:1px solid var(--border-secondary);border-radius:4px;margin-bottom:16px}#stackgazer .rules-editor-header.collapsible-header{cursor:pointer;display:flex;align-items:center;gap:6px;padding:4px 8px;background:var(--bg-tertiary);border-radius:0;border-bottom:1px solid var(--border-secondary);-webkit-user-select:none;user-select:none;font-size:11px;font-weight:500;color:var(--text-muted);margin:0}#stackgazer .rules-editor-header.collapsible-header:hover{background:var(--bg-secondary);color:var(--text-secondary)}#stackgazer .expand-icon{font-size:10px;color:var(--text-muted);transition:transform .2s ease}#stackgazer .collapsible-header.collapsed-settings .expand-icon{transform:rotate(-90deg)}#stackgazer .collapsible-content{padding:0}#stackgazer .collapsible-content.collapsed-settings{display:none}#stackgazer .setting-description-prose{margin-bottom:16px}#stackgazer .setting-description-prose p{margin:0;font-size:12px;line-height:1.4;color:var(--text-secondary)}#stackgazer .setting-description-prose strong{color:var(--text-primary);font-weight:600}@media (max-width: 768px){#stackgazer .footer-buttons{flex-direction:column}#stackgazer .rule-controls{flex-direction:column;align-items:stretch;gap:4px}#stackgazer .rule-type-label{min-width:auto}#stackgazer .rule-input{min-width:auto;width:100%}}#stackgazer .settings-actions{padding:20px 25px;border-top:1px solid var(--border-primary);background:var(--bg-secondary);display:flex;gap:10px;justify-content:flex-end;border-radius:0 0 8px 8px;flex-shrink:0}#stackgazer .settings-reset-btn,#stackgazer .settings-save-btn{padding:8px 16px}#stackgazer .demo-link{color:var(--code-keyword);text-decoration:none;cursor:pointer;transition:color .2s ease,text-decoration .2s ease;font-size:14px}#stackgazer .demo-link:hover{color:var(--text-link-hover);text-decoration:underline}#stackgazer .hidden{display:none!important}#stackgazer .cursor-pointer{cursor:pointer}#stackgazer .main-content.filtered .filtered{display:none!important}#stackgazer .modal-visible{display:block!important}#stackgazer .modal-hidden{display:none!important}#stackgazer .file-section .header{cursor:pointer;display:flex;justify-content:space-between}#stackgazer .file-section .header .title{font-weight:700;font-size:14px;display:flex;align-items:center;gap:6px}#stackgazer .group-sub-header{font-size:1em;color:var(--text-primary);font-weight:500;margin-bottom:8px;display:flex;justify-content:space-between;padding:6px 12px;background-color:var(--border-primary);border-radius:3px}#stackgazer .group-sub-header-label{font-weight:700;font-size:1.2em;color:var(--text-primary);margin-top:4px}#stackgazer .group-sub-header-label.unlabeled{font-style:italic;color:var(--text-muted)}#stackgazer .group-sub-header-count{color:var(--text-secondary);font-size:.95em;font-weight:500}#stackgazer .group-sub-section{margin-top:6px}#stackgazer .demo-add-files,#stackgazer .demo-try-demo{font-size:14px;color:var(--text-muted)}#stackgazer .demo-add-files{margin-top:10px}#stackgazer .demo-try-demo{margin:20px 0 10px}#stackgazer .demo-section-divider{margin-top:25px;padding-top:5px;border-top:1px solid var(--border-secondary)}#stackgazer .demo-buttons{text-align:center;margin-top:10px;gap:20px;display:flex;justify-content:center}#stackgazer .custom-rules-section,#stackgazer .default-rules-section{margin:12px 0}#stackgazer .custom-rules-section h5,#stackgazer .default-rules-section h5{font-size:12px;font-weight:600;color:var(--text-primary);margin:0 0 6px}#stackgazer .default-rules-header{display:flex;align-items:center;justify-content:space-between;cursor:pointer;padding:2px 0;margin-bottom:6px}#stackgazer .default-rules-title{display:flex;align-items:center;gap:6px}#stackgazer .default-rules-title .expand-icon{font-size:10px;color:var(--text-muted);transition:transform .2s ease}#stackgazer .default-rules-section:has(.default-rules-content.collapsed-settings) .expand-icon{transform:rotate(-90deg)}#stackgazer .default-rules-section.settings-collapsed .expand-icon{transform:rotate(-90deg)}#stackgazer .default-rules-header h5{margin:0;transition:color .2s ease}#stackgazer .default-rules-header.disabled h5{color:var(--text-muted)}#stackgazer .default-rules-content{transition:all .2s ease}#stackgazer .default-rules-content.collapsed-settings,#stackgazer .custom-rules-content.collapsed-settings{display:none}#stackgazer .default-rules-textarea{background:var(--bg-tertiary);color:var(--text-muted);border-color:var(--border-secondary)}#stackgazer .toggle-switch{position:relative;width:34px;height:18px;display:inline-block}#stackgazer .toggle-switch input{opacity:0;width:0;height:0}#stackgazer .toggle-slider{position:absolute;cursor:pointer;inset:0;background-color:var(--border-secondary);transition:.2s;border-radius:18px}#stackgazer .toggle-slider:before{position:absolute;content:"";height:14px;width:14px;left:2px;bottom:2px;background-color:var(--bg-primary);transition:.2s;border-radius:50%}#stackgazer input:checked+.toggle-slider{background-color:var(--accent-primary)}#stackgazer input:checked+.toggle-slider:before{transform:translate(16px)}#stackgazer .copy-button{--copy-size: 28px;--copy-font: 16px;--copy-top: 50px;--copy-right: -14px;--copy-z: 10;--copy-hover-size: 40px;--copy-hover-font: 20px;--copy-hover-top: 44px;--copy-hover-right: -20px;position:absolute;background:var(--bg-quaternary);border:1px solid var(--border-secondary);border-radius:50%;width:var(--copy-size);height:var(--copy-size);font-size:var(--copy-font);color:var(--text-muted);cursor:pointer;opacity:0;transition:all .2s ease;display:flex;align-items:center;justify-content:center;top:var(--copy-top);right:var(--copy-right);z-index:var(--copy-z)}#stackgazer .copy-button.size-small{--copy-size: 18px;--copy-font: 10px;--copy-top: 40px;--copy-right: -25px;--copy-z: 5;--copy-hover-size: 26px;--copy-hover-font: 14px;--copy-hover-top: 36px;--copy-hover-right: -29px}#stackgazer .section.container-collapsed>.header>.copy-button{display:none}#stackgazer .section:hover>.header>.copy-button:not(.pinned),#stackgazer .goroutine-entry:hover>.copy-button:not(.pinned){opacity:.7}#stackgazer .copy-button:hover{background:var(--bg-quaternary);border-color:var(--border-primary);color:var(--text-primary);opacity:1!important;width:var(--copy-hover-size);height:var(--copy-hover-size);font-size:var(--copy-hover-font);top:var(--copy-hover-top);right:var(--copy-hover-right)}#stackgazer .copy-button:before{content:"";position:absolute;inset:-16px;border-radius:50%}#stackgazer .copy-button.size-small:hover{top:var(--copy-hover-top);right:var(--copy-hover-right)}#stackgazer .narrow-menu-btn,#stackgazer .narrow-filter-container,#stackgazer .narrow-controls,#stackgazer .narrow-controls-header,#stackgazer .narrow-close-btn,#stackgazer .narrow-back-btn{display:none!important}@media (max-width: 900px){#stackgazer .narrow-menu-btn,#stackgazer .narrow-filter-container,#stackgazer .narrow-controls,#stackgazer .narrow-controls-header,#stackgazer .narrow-close-btn{display:flex!important}#stackgazer .narrow-controls-header,#stackgazer .narrow-close-btn{display:block!important}#stackgazer .narrow-back-btn:not(:disabled){display:flex!important}#stackgazer .container{position:relative}#stackgazer .sidebar{position:fixed;top:0;left:-300px;height:100vh;z-index:1000;transition:left .3s ease;box-shadow:2px 0 10px #0000004d;overflow-y:auto;padding:20px 20px 80px;box-sizing:border-box}#stackgazer .sidebar.narrow-open{left:0}#stackgazer .sidebar-overlay{position:fixed;inset:0;background:var(--bg-overlay);z-index:999;opacity:0;visibility:hidden;transition:opacity .3s ease,visibility .3s ease}#stackgazer .sidebar-overlay.active{opacity:1;visibility:visible}#stackgazer .main-content{width:100%}#stackgazer .view-controls-bar{flex-direction:column;gap:10px;padding:10px 15px}#stackgazer .narrow-filter-container{width:100%;order:-1;display:flex;gap:8px;align-items:center}#stackgazer .narrow-menu-btn{background:var(--accent-primary);border:none;border-radius:6px;color:#fff;font-size:16px;cursor:pointer;padding:8px 12px;transition:all .2s ease;flex-shrink:0}#stackgazer .narrow-menu-btn:hover{background:var(--accent-primary-hover);transform:scale(1.05)}#stackgazer .narrow-menu-btn.active{background:var(--accent-danger);transform:scale(.95)}#stackgazer .narrow-filter-input{flex:1;padding:8px 12px;background:var(--bg-quaternary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);font-family:inherit;font-size:14px}#stackgazer .narrow-filter-input:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .narrow-filter-input::placeholder{color:var(--text-muted)}#stackgazer .narrow-back-btn{position:fixed;bottom:20px;left:20px;width:44px;height:44px;background:var(--accent-primary);border:none;border-radius:50%;color:#fff;font-size:18px;cursor:pointer;box-shadow:0 4px 12px #0000004d;z-index:1002;transition:all .3s ease;display:flex;align-items:center;justify-content:center}#stackgazer .narrow-back-btn:hover:not(:disabled){background:var(--accent-primary-hover);transform:scale(1.1)}#stackgazer .narrow-back-btn:disabled{background:var(--border-secondary);cursor:not-allowed;opacity:.5}#stackgazer .view-controls-bar #expandAllBtn,#stackgazer .view-controls-bar #collapseAllBtn,#stackgazer .view-controls-bar #unpinAllBtn,#stackgazer .view-controls-bar #stackDisplayModeSelect,#stackgazer .view-controls-bar #backBtn{display:none}#stackgazer .view-controls-bar .left-controls,#stackgazer .view-controls-bar .right-controls{flex-wrap:wrap;gap:8px}#stackgazer .view-controls-bar .control-btn{font-size:12px;padding:6px 10px;min-width:auto}#stackgazer .view-controls-bar select{font-size:12px;padding:6px 8px}.narrow-controls{flex-direction:column;gap:10px;padding:15px;background:var(--bg-quaternary);border-radius:6px;margin-bottom:15px}#stackgazer .narrow-controls-row{display:flex;gap:8px;flex-wrap:wrap}#stackgazer .narrow-controls .control-btn{flex:1;min-width:80px;font-size:11px;padding:8px 12px}#stackgazer .narrow-select{width:100%;background:var(--bg-tertiary);border:1px solid var(--border-secondary);border-radius:4px;color:var(--text-primary);font-family:inherit;font-size:11px;padding:8px 12px}#stackgazer .narrow-select:focus{outline:none;border-color:var(--accent-primary)}#stackgazer .narrow-close-btn{position:fixed;top:20px;left:-18px;background:var(--bg-primary);border:2px solid var(--border-secondary);border-radius:50%;color:var(--text-secondary);font-size:20px;cursor:pointer;width:36px;height:36px;display:flex;align-items:center;justify-content:center;z-index:1002;transition:left .3s ease,opacity .2s ease;box-shadow:0 2px 8px #00000026;opacity:0;visibility:hidden}#stackgazer .narrow-close-btn.visible{opacity:1;visibility:visible;left:282px}#stackgazer .narrow-close-btn:hover{background:var(--bg-secondary);color:var(--text-primary);border-color:var(--accent-primary);transform:scale(1.1);box-shadow:0 4px 12px #0003}#stackgazer .drop-zone{margin:10px}#stackgazer .drop-zone.has-content{padding:10px}}@media (max-width: 400px){#stackgazer .header{flex-wrap:wrap;align-items:flex-start;gap:4px}#stackgazer .header-right{width:100%;align-items:flex-start;margin-top:4px}#stackgazer .header .counts{margin-right:0;font-size:12px}#stackgazer .state-summary{font-size:11px}}#stackgazer .rule-validation-feedback{margin-top:8px;font-size:12px;line-height:1.4}#stackgazer .rule-errors,#stackgazer .rule-warnings{margin-bottom:4px}#stackgazer .rule-error-item{color:var(--accent-error);margin:2px 0;padding:2px 4px;background-color:var(--accent-error-bg, rgba(220, 53, 69, .1));border-radius:3px}#stackgazer .rule-warning-item{color:var(--accent-warning, #fd7e14);margin:2px 0;padding:2px 4px;background-color:var(--accent-warning-bg, rgba(253, 126, 20, .1));border-radius:3px}#stackgazer textarea.rule-error{border-color:var(--accent-error)!important;box-shadow:0 0 0 2px #dc354533}#stackgazer textarea.rule-warning{border-color:var(--accent-warning, #fd7e14)!important;box-shadow:0 0 0 2px #fd7e1433}#stackgazer .copy-notification{position:absolute;top:20px;right:20px;background:var(--accent-success);color:#fff;padding:8px 16px;border-radius:4px;font-size:12px;z-index:10000;pointer-events:none;opacity:0;transition:opacity .3s ease}#stackgazer .copy-notification.show{opacity:1}#stackgazer .loading-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:#000000b3;display:flex;align-items:center;justify-content:center;z-index:10001;pointer-events:auto}#stackgazer .loading-spinner{width:60px;height:60px;border:4px solid var(--bg-tertiary);border-top:4px solid var(--accent-primary);border-radius:50%;animation:spin 1s linear infinite}#stackgazer .loading-content{display:flex;flex-direction:column;align-items:center;gap:20px;color:var(--text-primary);background:var(--bg-secondary);padding:30px;border-radius:12px;border:1px solid var(--border-color);min-width:300px;text-align:center}#stackgazer .loading-message{font-size:16px;font-weight:500}#stackgazer .loading-details{font-size:14px;color:var(--text-secondary);opacity:.8}#stackgazer .loading-progress{width:100%;max-width:250px;height:8px;background:var(--bg-tertiary);border-radius:4px;overflow:hidden}#stackgazer .loading-progress-bar{height:100%;background:var(--accent-primary);border-radius:4px;width:0%;transition:width .3s ease}#stackgazer .loading-progress-indeterminate{height:100%;background:linear-gradient(90deg,transparent,var(--accent-primary),transparent);border-radius:4px;width:50%;animation:loading-slide 2s ease-in-out infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes loading-slide{0%{transform:translate(-100%)}to{transform:translate(200%)}}</style>
</head>

<body>
    <div id="stackgazer"></div>
    <script>
        // Initialize the app (StackgazerApp is made available globally by the bundled code)
        document.addEventListener('DOMContentLoaded', function() {
            // Add custom settings here.
            const app = new window.StackgazerApp("stackgazer", defaults => {
                return {
                    ...defaults,
                functionTrimPrefixes: ['github.com/cockroachdb/cockroach/pkg/'],
                fileTrimPrefixes: [
                    'bazel-out/k8-opt/bin/pkg/.*_go_proto_/', 
                    'github.com/cockroachdb/cockroach/'
                ],
                categorySkipRules: [
                    ...defaults.categorySkipRules,
                        'google.golang.org/grpc',
                        'util/stop', 'util/ctxgroup',    
                        'jobs.(*Registry).resumeJob',
                        'jobs.(*Registry).runJob',
                        'jobs.(*Registry).stepThroughStateMachine',
                        'kv/kvclient/rangefeed.(*RangeFeed).run', 
                        'kv/kvpb._', 
                        'rpc.NewServerEx',  
                        'rpc.internalClientAdapter', 
                        'rpc.makeInternalClientAdapter', 
                        'rpc.serverStreamInterceptorsChain', 
                        'rpc.kvAuth', 
                        'sql/flowinfra.(*FlowBase).StartInternal.func', 
                        'sql/execinfra.(*ProcessorBaseNoHelper).Run', 
                        'sql/execinfra.Run'
                ],
                nameSkipRules: [
                    ...defaults.nameSkipRules,
                        'rpc.NewContext.ClientInterceptor.func8',
                        'kv/bulk.(*CPUPacer).Pace',
                        'util/cidr.metricsConn.Read',
                        'server.(*Node).batchInternal'
                    ],
                nameFoldRules: [
                    ...defaults.nameFoldRules,
                    's|util/ctxgroup.Group.Wait,|waitgroup|',
                    's|util/ctxgroup.GroupWorkers,|waitgroup|',
                    's|util/ctxgroup.GoAndWait,|waitgroup|',
                    's|util/admission.(*WorkQueue).Admit,^(util/admission|kv/kvserver/kvadmission)|AC|',
                ],
                nameFindRules: [
                    ...defaults.nameFindRules,
                    's|kv/kvclient/kvcoord.(*DistSender).Send,^(kv/kvclient/kvcoord|kv\\.)|DistSender|',
                ],
                nameExtractionPatterns: [
                    ...defaults.nameExtractionPatterns,
                    's|pgwire\\.\\(\\*Server\\)\\.serveImpl.*?\\{0x1,\\s*0x2,\\s*\\{0x([0-9a-fA-F]+),|hex:n$1|',
                    's|pgwire\\.\\(\\*Server\\)\\.serveImpl.*?\\{0x0,\\s*0x4,\\s*\\{0x([0-9a-fA-F]+),|hex:n$1|',
                    's|# labels:.*?"n":"([0-9]+)"|n$1|',
                    's|tags=([^,\\s]+)|$1|',
                ]
                };
            });
            window.app = app;
            console.log('Stackgazer loaded: go ahead, gaze into the abyss.');

            // Listen for stack data from parent window
            console.log('Stackgazer: Ready to receive messages');
            window.addEventListener('message', async function(event) {
                console.log('Stackgazer: Received message:', event.data);

                if (event.data && event.data.type === 'PING') {
                    console.log('Stackgazer: Received PING, sending PONG');
                    event.source.postMessage({ type: 'PONG', message: 'Communication working!' }, '*');
                    return;
                }

                if (event.data && event.data.type === 'LOAD_STACK_FILE') {
                    console.log('Stackgazer: Received stack file:', event.data.path);

                    try {
                        // Convert to File object and process immediately
                        const file = new File([event.data.content], event.data.path, { type: 'text/plain' });
                        await app.handleFiles([file]);
                        console.log('Stackgazer: Processed stack file:', event.data.path);
                    } catch (error) {
                        console.error('Stackgazer: Error processing stack file:', event.data.path, error);
                    }
                }
            });
        });
    </script>
</body>

</html>